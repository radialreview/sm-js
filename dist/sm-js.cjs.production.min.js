"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@apollo/client/core"),r=e(require("chance")),n=require("lodash"),o=require("mobx"),a=e(require("react")),i=require("@apollo/client/link/ws"),u=require("@apollo/client/link/http"),s=require("@apollo/client/utilities"),l=e(require("isomorphic-ws")),c=require("@apollo/client");function d(e,t,r,n,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){d(a,n,o,i,u,"next",e)}function u(e){d(a,n,o,i,u,"throw",e)}i(void 0)}))}}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function y(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,g(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function b(e,t,r){return(b=v()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&g(o,r.prototype),o}).apply(null,arguments)}function m(e){var t="function"==typeof Map?new Map:void 0;return(m=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return b(e,arguments,h(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),g(r,e)})(e)}function E(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||(o[r]=e[r]);return o}var S,P,R,x,q,I,O,D,T=function(e){function t(t){var r;return(r=e.call(this,'NotUpToDate exception - The property "'+t.propName+'" on the DO for the node type '+t.nodeType+" was read but is not guaranteed to be up to date. Add that property to the query with the id "+t.queryId)||this).propName=void 0,r.propName=t.propName,r}return y(t,e),t}(m(Error)),w=function(e){function t(t){return e.call(this,'NotUpToDateInComputed exception - The property "'+t.propName+'" on the DO for the node type "'+t.nodeType+'" was read for the computed property "'+t.computedPropName+'" but is not guaranteed to be up to date. Add that property to the query with the id '+t.queryId)||this}return y(t,e),t}(m(Error)),_=function(e){function t(t){return e.call(this,"FilterPropertyNotDefinedInQueryException exception - The filter property '"+t.filterPropName+"' is not defined in the 'map' function of the queryDefinition. Add that property to the queryDefinition 'map' function.")||this}return y(t,e),t}(m(Error)),N=function(e){function t(t){return e.call(this,"SortPropertyNotDefinedInQueryException exception - The sort property '"+t.sortPropName+"' is not defined in the 'map' function of the queryDefinition. Add that property to the queryDefinition 'map' function.")||this}return y(t,e),t}(m(Error)),C=function(e){function t(t){return e.call(this,'ImpliedPropertyException exception - The property "'+t.propName+'" is implied and cannot be customized within a node definition.')||this}return y(t,e),t}(m(Error)),k=function(e){function t(t){return e.call(this,'NotCached exception - Attempted to get the node with the type "'+t.nodeType+'" and id "'+t.id+'" but it was not cached.')||this}return y(t,e),t}(m(Error)),A=function(e){function t(t){return e.call(this,"NodesCollectionPageOutOfBoundsException - "+t)||this}return y(t,e),t}(m(Error)),Q=function(e){function t(t){return e.call(this,"DataType exception - the data type "+t.dataType+' received a bad value. Value: "'+t.value+'"')||this}return y(t,e),t}(m(Error)),j=function(e){function t(t){return e.call(this,"DataTypeExplicitDefaultException - the data type "+t.dataType+" requires setting an explicit default value for non-optional properties")||this}return y(t,e),t}(m(Error)),F=function(e){function t(t){return e.call(this,"DataParsing exception - "+t.message+"\nData: "+JSON.stringify(t.receivedData,null,2)+".")||this}return y(t,e),t}(m(Error)),L=function(e){function t(t){return e.call(this,"FilterOperatorNotImplementedException - '"+t.operator+"' operator not implemented.")||this}return y(t,e),t}(m(Error)),M=function(e){function t(t){return e.call(this,"Unreachable case: "+("object"==typeof t?JSON.stringify(t,null,2):t))||this}return y(t,e),t}(m(Error));(S=exports.QueryState||(exports.QueryState={})).IDLE="IDLE",S.LOADING="LOADING",S.ERROR="ERROR",(P=exports.EPaginationFilteringSortingInstance||(exports.EPaginationFilteringSortingInstance={}))[P.SERVER=0]="SERVER",P[P.CLIENT=1]="CLIENT",(R=exports.DATA_TYPES||(exports.DATA_TYPES={})).string="s",R.maybeString="mS",R.stringEnum="sE",R.maybeStringEnum="mSE",R.number="n",R.maybeNumber="mN",R.stringOrNumber="sON",R.maybeStringOrNumber="mSON",R.boolean="b",R.maybeBoolean="mB",R.object="o",R.maybeObject="mO",R.record="r",R.maybeRecord="mR",R.array="a",R.maybeArray="mA",(x=exports.RELATIONAL_TYPES||(exports.RELATIONAL_TYPES={})).oneToOne="oTO",x.oneToMany="oTM",x.nonPaginatedOneToMany="nPOTM",(q=exports.EStringFilterOperator||(exports.EStringFilterOperator={})).eq="eq",q.neq="neq",q.contains="contains",q.ncontains="ncontains",q.startsWith="startsWith",q.nstartsWith="nstartsWith",q.endsWith="endsWith",q.nendsWith="nendsWith",(I=exports.ENumberFilterOperator||(exports.ENumberFilterOperator={})).eq="eq",I.neq="neq",I.gt="gt",I.ngt="ngt",I.gte="gte",I.ngte="ngte",I.lt="lt",I.nlt="nlt",I.lte="lte",I.nlte="nlte",(O=exports.EStringOrNumberFilterOperator||(exports.EStringOrNumberFilterOperator={})).eq="eq",O.neq="neq",O.contains="contains",O.ncontains="ncontains",O.startsWith="startsWith",O.nstartsWith="nstartsWith",O.endsWith="endsWith",O.nendsWith="nendsWith",O.gt="gt",O.ngt="ngt",O.gte="gte",O.ngte="ngte",O.lt="lt",O.nlt="nlt",O.lte="lte",O.nlte="nlte",(D=exports.EBooleanFilterOperator||(exports.EBooleanFilterOperator={})).eq="eq",D.neq="neq";var U=function(e){var t;this.type=void 0,this.parser=void 0,this.boxedValue=void 0,this.defaultValue=void 0,this.isOptional=void 0,this.acceptableValues=void 0,this.type=e.type,this.parser=e.parser,this.boxedValue=e.boxedValue,this.defaultValue=null!=(t=e.defaultValue)?t:null,this.isOptional=e.isOptional,this.acceptableValues=e.acceptableValues},V=function(e){return new U({type:exports.DATA_TYPES.string,parser:function(e){return null!=e?String(e):e},defaultValue:e,isOptional:!1})};V._default=V(""),V.optional=new U({type:exports.DATA_TYPES.maybeString,parser:function(e){return null!=e?String(e):e},isOptional:!0});var B=function(e){return new U({type:exports.DATA_TYPES.stringEnum,parser:function(e){return null!=e?String(e):e},defaultValue:e[0],isOptional:!1,acceptableValues:e})};B.optional=function(e){return new U({type:exports.DATA_TYPES.maybeStringEnum,parser:function(e){return null!=e?String(e):null},defaultValue:e[0],isOptional:!0,acceptableValues:e})};var G=function e(t){return new U({type:exports.DATA_TYPES.number,parser:function(t){var r=Number(t);return isNaN(r)?(function(e){var t,r;if("production"!==(null==(t=process)||null==(r=t.env)?void 0:r.NODE_ENV))throw e;console.error(e)}(new Q({dataType:exports.DATA_TYPES.number,value:t})),e._default.defaultValue):r},defaultValue:t,isOptional:!1})};G._default=G(0),G.optional=new U({type:exports.DATA_TYPES.maybeNumber,parser:function(e){return null!=e?Number(e):e},isOptional:!0});var Y=function(e){return new U({type:exports.DATA_TYPES.stringOrNumber,parser:function(e){return e},defaultValue:e,isOptional:!1})};Y._default=Y(""),Y.optional=new U({type:exports.DATA_TYPES.maybeStringOrNumber,parser:function(e){return e},isOptional:!0});var K=function(e){return void 0===e?new j({dataType:exports.DATA_TYPES.boolean}):new U({type:exports.DATA_TYPES.boolean,parser:function(e){if("true"===e||!0===e)return!0;if("false"===e||!1===e)return!1;throw new Q({dataType:exports.DATA_TYPES.boolean,value:e})},defaultValue:e,isOptional:!1})};K._default=K(),K.optional=new U({type:exports.DATA_TYPES.maybeBoolean,parser:function(e){return null==e?e:"true"===e||!0===e},isOptional:!0});var W=function(e){return new U({type:exports.DATA_TYPES.object,parser:function(e){return e},boxedValue:e,isOptional:!1})};W._default=null,W.optional=function(e){return new U({type:exports.DATA_TYPES.maybeObject,parser:function(e){return e},boxedValue:e,isOptional:!0})};var z=function(e){return new U({type:exports.DATA_TYPES.record,parser:function(e){return e},boxedValue:e,isOptional:!1,defaultValue:{}})};z.optional=function(e){return new U({type:exports.DATA_TYPES.maybeRecord,parser:function(e){return e},boxedValue:"function"==typeof e?e._default:e,isOptional:!0,defaultValue:null})},z._default=null;var H={id:Y,version:G,lastUpdatedBy:V,type:V},J=f({},E(H,["type"]),{dateCreated:G,dateLastModified:G,lastUpdatedClientTimestamp:G}),$=["condition"];function X(e){var t,r=f({},e.properties,(t=e.relational)?Object.keys(t).reduce((function(e,r){var n=t[r]();return e[r]=function(e){return f({},n(e),{_relationshipName:r})},e}),{}):{});return Object.keys(e.properties).forEach((function(t){var n=e.properties[t];n.type!==exports.DATA_TYPES.object&&n.type!==exports.DATA_TYPES.maybeObject||(r[t]=function(e){return e.map})})),e.mapFn?e.mapFn(r):e.properties}function Z(e){var t=X({mapFn:e.mapFn,properties:e.data,relational:e.relational});return Object.keys(t||e.data).reduce((function(r,n){if(!e.data[n])return r;if(e.isRootLevel&&Object.keys(H).includes(n))return r;var o=e.data[n];return o.type===exports.DATA_TYPES.object||o.type===exports.DATA_TYPES.maybeObject?(r.push.apply(r,Z({queryId:e.queryId,mapFn:t&&"function"==typeof t[n]?t[n]:void 0,data:o.boxedValue}).map((function(e){return n+"__dot__"+e}))),r):[].concat(r,[n])}),e.isRootLevel?[].concat(Object.keys(H)):[])}function ee(e){return Object.keys(e.nodeProperties).reduce((function(t,r){if(e.isRootLevel&&Object.keys(H).includes(r))return t;var n=e.nodeProperties[r];return n.type===exports.DATA_TYPES.object||n.type===exports.DATA_TYPES.maybeObject?(t.push.apply(t,ee({nodeProperties:e.nodeProperties[r].boxedValue,isRootLevel:!1}).map((function(e){return r+"__dot__"+e}))),t):[].concat(t,[r])}),e.isRootLevel?[].concat(Object.keys(H)):[])}function te(e){var t={};return Object.keys(e.queryDefinitions).forEach((function(r){var n,o,a,i,u,s=e.queryDefinitions[r];if(s){var l;"_isNodeDef"in s?n=ee({nodeProperties:(o=s).data,isRootLevel:!0}):(o=s.def,i=null==(l=s.target)?void 0:l.allowNullResult,u=s.tokenName,s.map?(n=Z({mapFn:s.map,queryId:e.queryId,data:s.def.data,computed:s.def.computed,relational:s.def.relational,isRootLevel:!0}),a=function e(t){var r=X({mapFn:t.mapFn,properties:t.data,relational:t.relational}),n=Object.keys(r).reduce((function(n,o){if(t.data[o]||t.computed&&t.computed[o])return n;var a=function(r){var o={def:r.def,_relationshipName:r._relationshipName,properties:Z({queryId:t.queryId,mapFn:r.mapFn,data:r.def.data,computed:r.def.computed,relational:r.def.relational,isRootLevel:!0})},a=e({queryId:t.queryId,mapFn:r.mapFn,data:r.def.data,computed:r.def.computed,relational:r.def.relational});a&&(o.relational=a);var u=r._relational;if(u===exports.RELATIONAL_TYPES.oneToOne)o.oneToOne=!0;else if(u===exports.RELATIONAL_TYPES.oneToMany)o.oneToMany=!0,i.queryBuilderOpts&&i.queryBuilderOpts.filter&&(o.filter=i.queryBuilderOpts.filter),i.queryBuilderOpts&&i.queryBuilderOpts.pagination&&(o.pagination=i.queryBuilderOpts.pagination),i.queryBuilderOpts&&i.queryBuilderOpts.sort&&(o.sort=i.queryBuilderOpts.sort);else{if(u!==exports.RELATIONAL_TYPES.nonPaginatedOneToMany)throw Error('relationalType "'+u+'" is not valid.');o.nonPaginatedOneToMany=!0,i.queryBuilderOpts&&i.queryBuilderOpts.filter&&(o.filter=i.queryBuilderOpts.filter),i.queryBuilderOpts&&i.queryBuilderOpts.sort&&(o.sort=i.queryBuilderOpts.sort)}n[r.alias]=o},i=r[o];if("function"==typeof i)return n;if(null==i._relational)throw Error('getRelationalQueries - the key "'+o+'" is not a data property, not a computed property and does not contain a relational query.');if(i._relational!==exports.RELATIONAL_TYPES.oneToOne&&i._relational!==exports.RELATIONAL_TYPES.oneToMany&&i._relational!==exports.RELATIONAL_TYPES.nonPaginatedOneToMany)throw Error("The relational query type "+i._relational+" is not valid");if(!("map"in i.queryBuilderOpts)||"function"!=typeof i.queryBuilderOpts.map&&void 0!==i.queryBuilderOpts.map){var u=i.queryBuilderOpts;Object.keys(u).forEach((function(e){a({_relational:i._relational,_relationshipName:i._relationshipName,alias:o+"__rU__"+e,def:i.def[e],mapFn:u[e].map})}))}else a({_relational:i._relational,_relationshipName:i._relationshipName,alias:o,def:i.def,mapFn:i.queryBuilderOpts.map});return n}),{});if(0!==Object.keys(n).length)return n}({mapFn:s.map,queryId:e.queryId,data:o.data,computed:o.computed,relational:o.relational})):n=ee({nodeProperties:o.data,isRootLevel:!0}));var c={def:o,properties:n,relational:a,allowNullResult:i,tokenName:u||null};if("target"in s&&null!=s.target){if("ids"in s.target&&null!=s.target.ids){if(s.target.ids.some((function(e){return"string"!=typeof e&&"number"!=typeof e})))throw Error("Invalid id in target.ids");c.ids=s.target.ids,c.filter={id:{in:s.target.ids}}}if("id"in s.target){if("string"!=typeof s.target.id&&"number"!=typeof s.target.id)throw Error("Invalid id in target.id");c.id=s.target.id}}"filter"in s&&null!=s.filter&&(c.filter=s.filter),"pagination"in s&&null!=s.pagination&&(c.pagination=s.pagination),"sort"in s&&null!=s.sort&&(c.sort=s.sort),t[r]=c}else t[r]=null})),t}function re(e){if(!e.useServerSidePaginationFilteringSorting)return"";var t=[];if(null!=e.queryRecordEntry.filter&&t.push("where: "+function e(t){var r=Object.keys(t.filter).reduce((function(e,r){var n,o,a=r;if(void 0===t.filter[a])return e;if(null===t.filter[a]||"string"==typeof t.filter[a]||"number"==typeof t.filter[a]||"boolean"==typeof t.filter[a])o={key:a,operatorValueCombos:[{operator:exports.EStringFilterOperator.eq,value:t.filter[a]}]};else if(t.relational&&a in t.relational)o={key:a,operatorValueCombos:[{operator:exports.EStringFilterOperator.eq,value:t.filter[a]}]};else{var i=E(t.filter[a],$);o={key:a,operatorValueCombos:Object.keys(i).reduce((function(e,t){return e.push({operator:t,value:i[t]}),e}),[])}}var u=(null==(n=t.filter[a])?void 0:n.condition)||(t.isCollectionFilter?"some":"and"),s=e[u]||[];return s.push(o),e[u]=s,e}),{});return Object.keys(r).forEach((function(e){var t;0===(null==(t=r[e])?void 0:t.length)&&delete r[e]})),Object.entries(r).reduce((function(r,n,o){var a=n[0];o>0&&(r+=", ");var i=n[1].reduce((function(r,n,o){if(o>0&&(r+=", "),n.key in t.def.data){var a=t.def.data[n.key].type===exports.DATA_TYPES.stringEnum||t.def.data[n.key].type===exports.DATA_TYPES.maybeStringEnum,i=n.operatorValueCombos.reduce((function(e,t,r){r>0&&(e+=", ");var n=a?t.value:JSON.stringify(t.value);return Array.isArray(t.value)?e+=t.operator+": ["+n.map(JSON.stringify).join(",")+"]":e+=t.operator+": "+n}),"");r+="{"+n.key+": {"+i+"}}"}else{if(!t.relational||!(n.key in t.relational))throw Error("Invalid filter key: "+n.key);if(n.operatorValueCombos.length>1)throw Error("Invalid filter for relational query: "+n.key+", more than 1 operatorValue combo found");var u=le({queryRecordEntry:t.relational[n.key]}),s=t.relational[n.key].def;if(u)r+="{"+n.key+": "+e({filter:n.operatorValueCombos[0].value,def:s,relational:t.relational[n.key].relational,isCollectionFilter:!0})+"}";else{var l=n.operatorValueCombos.reduce((function(e,t,r){return r>0&&(e+=", "),Object.keys(t.value).forEach((function(r){var n=t.value[r],o=s.data[r].type===exports.DATA_TYPES.stringEnum||s.data[r].type===exports.DATA_TYPES.maybeStringEnum?n:JSON.stringify(n);e+=r+": {"+t.operator+": "+o+"}"})),e}),"");r+="{"+n.key+": {"+l+"}}"}}return r}),"");return r+(a+": ")+function(e){return t.isCollectionFilter?e:"["+e+"]"}(i)}),"{")+"}"}({filter:e.queryRecordEntry.filter,def:e.queryRecordEntry.def,relational:e.queryRecordEntry.relational,isCollectionFilter:!1})),null!=e.queryRecordEntry.sort){var r=function e(t){return Object.keys(t).reduce((function(r,n,o,a){var i,u=t[n];if(null==u)return r;if("string"==typeof u)r[i=a.length+o]="{"+n+": "+("asc"===u?"ASC":"DESC")+"}";else{var s=u;if("direction"in s)r[i=null!=s.priority?s.priority:a.length+o]="{"+n+": "+("asc"===s.direction?"ASC":"DESC")+"}";else{i=null!=s.priority?s.priority:a.length+o;var l=e(s);r[i]="{"+n+": "+l+"}"}}return r}),[]).filter((function(e){return null!=e})).join(", ")}(e.queryRecordEntry.sort);""!==r&&t.push("order: ["+r+"]")}return null!=e.queryRecordEntry.pagination&&(e.queryRecordEntry.pagination.endCursor&&t.push('before: "'+e.queryRecordEntry.pagination.endCursor+'"'),e.queryRecordEntry.pagination.startCursor&&t.push('after: "'+e.queryRecordEntry.pagination.startCursor+'"'),e.queryRecordEntry.pagination.itemsPerPage&&t.push((e.queryRecordEntry.pagination.endCursor?"last":"first")+": "+e.queryRecordEntry.pagination.itemsPerPage)),t.join(", ")}function ne(e){return" ".repeat(e)}function oe(e){var t=e.previousRoots,r=e.root,n=e.allQueriedProps,o=e.baseSpacing,a=(t.length?"\n":"")+ne(o)+r+" {",i=t.join("__dot__"),u=(i.length?i+"__dot__":"")+r,s=[];return n.reduce((function(t,a){if(!a.startsWith(u+"__dot__"))return t;var i=a.replace(u+"__dot__","");if(i.includes("__dot__")){var l=i.split("__dot__")[0];if(s.includes(l))return t;s.push(l),t+=oe({previousRoots:[].concat(e.previousRoots,[r]),root:l,allQueriedProps:n,baseSpacing:o+2})}else t+="\n"+ne(o+2)+i;return t}),a)+"\n"+ne(o)+"}"}function ae(e){var t=[],r=""+ne(2*e.nestLevel);return r+=e.queryRecordEntry.properties.reduce((function(r,n){if(n.includes("__dot__")){var o=n.split("__dot__")[0];return t.includes(o)?r:(t.push(o),r+="\n"+oe({previousRoots:[],root:o,allQueriedProps:e.queryRecordEntry.properties,baseSpacing:2*e.nestLevel}))}return r+"\n"+ne(2*e.nestLevel)+n}),""),e.queryRecordEntry.relational&&(r+=function(e){return Object.keys(e.relationalQueryRecord).reduce((function(t,r){var n,o=e.relationalQueryRecord[r];if(!o._relationshipName)throw Error("relationalQueryRecordEntry is invalid\n"+JSON.stringify(o,null,2));var a=""+o._relationshipName,i=re({queryRecordEntry:o,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting}),u=a+(""!==i?"("+i+")":"");return t+"\n"+ne(2*e.nestLevel)+r+": "+u+" {"+("oneToMany"in o?ue({propertiesString:ae({queryRecordEntry:o,nestLevel:e.nestLevel+2,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting})+"\n",nestLevel:e.nestLevel+1,includeTotalCount:(null==(n=o.pagination)?void 0:n.includeTotalCount)||!1}):ae({queryRecordEntry:o,nestLevel:e.nestLevel+1,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting}))+"\n"+ne(2*e.nestLevel)+"}"}),"")}({relationalQueryRecord:e.queryRecordEntry.relational,nestLevel:e.nestLevel,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting})),r}function ie(e){var t,r=e.def.type;if("ids"in e&&null!=e.ids){var n=re({queryRecordEntry:e,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting});t=r+"s"+(""!==n?"("+n+")":"")}else if("id"in e&&null!=e.id)t=r+"(id: "+JSON.stringify(e.id)+")";else{var o=re({queryRecordEntry:e,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting});t=r+"s"+(""!==o?"("+o+")":"")}return t}function ue(e){var t="\n"+ne(2*e.nestLevel)+"nodes {",r=ne(2*e.nestLevel)+"}";return""+t+e.propertiesString+r+(e.includeTotalCount?"\n"+ne(2*e.nestLevel)+"totalCount":"")+"\n"+ne(2*e.nestLevel)+"pageInfo {\n"+["endCursor","startCursor","hasNextPage","hasPreviousPage"].map((function(t){return""+ne(2*(e.nestLevel+1))+t})).join("\n")+"\n"+r}function se(e){if(!Object.values(e.queryRecord).some((function(e){return null!=e})))return null;var r=("query "+ve({queryId:e.queryId})+" {\n"+Object.keys(e.queryRecord).map((function(t){var r=e.queryRecord[t];return r?function(e){var t,r=ie(e);return"  "+e.alias+": "+r+" {"+(null==e.id?ue({propertiesString:ae({queryRecordEntry:e,nestLevel:3,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting})+"\n",nestLevel:2,includeTotalCount:(null==(t=e.pagination)?void 0:t.includeTotalCount)||!1}):ae({queryRecordEntry:e,nestLevel:2,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting}))+"\n  }"}(f({},r,{alias:t,useServerSidePaginationFilteringSorting:e.useServerSidePaginationFilteringSorting})):""})).join("\n    ")+"\n}").trim();return t.gql(r)}function le(e){return!(!e.queryRecordEntry||"id"in e.queryRecordEntry&&null!=e.queryRecordEntry.id||"oneToOne"in e.queryRecordEntry)}function ce(e){return e.queryRecordEntry&&le(e)&&!("nonPaginatedOneToMany"in e.queryRecordEntry)}function de(e){return e.queryRecordEntry?ce(e)&&e.collectionsIncludePagingInfo?e.queryResponsePartial.nodes:e.queryResponsePartial:null}function pe(e){return Object.keys(e.queryRecord).reduce((function(r,n){var o,a=e.queryRecord[n];if(!a)return r;var i=function(e){var t=ie(f({},e.queryRecordEntry,{useServerSidePaginationFilteringSorting:!1}));return e.alias+": "+t+" {"+function(e){var t=fe({ownProps:e.queryRecordEntry.properties,relational:e.queryRecordEntry.relational}),r="...on Updated_"+ge(e.queryRecordEntry.def.type)+" {\n      __typename\n      id\n      targets {\n        id\n        property\n      }\n      value {"+t+"}\n  }\n  ";return"\n    ...on Created_"+ge(e.queryRecordEntry.def.type)+" {\n      __typename\n      id\n      value {"+t+"}\n  }\n  \n    "+r+" \n    ...on Deleted_"+ge(e.queryRecordEntry.def.type)+" {\n      __typename\n      id\n  }\n  \n    "+function(e){var t={};e.relationalSubscriptionMetadatas.forEach((function(e){var r,n,o;if(t[e.nodeType]||(t[e.nodeType]={_allProperties:[],_allRelationships:{}}),null!=(r=t[e.nodeType])&&r[e.parentNodeType]||(t[e.nodeType][e.parentNodeType]={_allProperties:[]}),null!=(n=t[e.nodeType])&&null!=(o=n[e.parentNodeType])&&o[e.relationalType]||(t[e.nodeType][e.parentNodeType][e.relationalType]={properties:[],relational:void 0}),e.properties.forEach((function(r){t[e.nodeType]._allProperties.includes(r)||t[e.nodeType]._allProperties.push(r),t[e.nodeType][e.parentNodeType][e.relationalType].properties.includes(r)||t[e.nodeType][e.parentNodeType][e.relationalType].properties.push(r)})),e.relational){var a=t[e.nodeType][e.parentNodeType][e.relationalType].relational;t[e.nodeType][e.parentNodeType][e.relationalType].relational=he(a?[a,e.relational]:[e.relational]);var i=t[e.nodeType]._allRelationships;t[e.nodeType]._allRelationships=he(i?[i,e.relational]:[e.relational])}}));var r="";return Object.keys(t).forEach((function(e){r+="\n      ...on Updated_"+ge(e)+" {\n        __typename\n        id\n        targets {\n          id\n          property\n        }\n        value {"+fe({ownProps:t[e]._allProperties,relational:t[e]._allRelationships})+"}\n      }\n    ",Object.keys(t[e]).forEach((function(n){"_allProperties"!==n&&Object.keys(t[e][n]).forEach((function(o){"_allProperties"!==o&&(r+=function(e){var t="",r=e.isOneToMany,n=e.isOneToOne,o=e.parentNodeType,a=e.nodeType,i=fe({ownProps:e.ownProps,relational:e.relational});return r?(t+="\n      ...on Inserted_"+ge(o)+"_"+ge(a)+" {\n        __typename\n        target {\n          id\n          property\n        }\n        value {"+i+"}\n      }\n    ",t+="\n      ...on Removed_"+ge(o)+"_"+ge(a)+" {\n        __typename\n        target {\n          id\n          property\n        }\n        id\n      }\n    "):n&&(t+="\n      ...on UpdatedAssociation_"+ge(o)+"_"+ge(a)+" {\n        __typename\n        target {\n          id\n          property\n        }\n        value {"+i+"}\n      }\n    "),t}({isOneToMany:"oneToMany"===o,isOneToOne:"oneToOne"===o,parentNodeType:n,nodeType:e,ownProps:t[e][n][o].properties,relational:t[e][n][o].relational}))}))}))})),r}({relationalSubscriptionMetadatas:ye({queryRecordEntry:e.queryRecordEntry})})}({queryRecordEntry:e.queryRecordEntry})+"}"}({queryId:e.queryId,queryRecordEntry:a,alias:n}),u="\n      subscription "+ve({queryId:e.queryId+"_"+n})+" {\n        "+i+"\n      }",s=t.gql(u);return f({},r,((o={})[n]=s,o))}),{})}function fe(e){return function(e){var t="",r=[];return""!==(t+=e.ownProps.reduce((function(t,n){if(n.includes("__dot__")){var o=n.split("__dot__")[0];return r.includes(o)?t:(r.push(o),t+="\n"+oe({previousRoots:[],root:o,allQueriedProps:e.ownProps,baseSpacing:1}))}return t+"\n"+n}),""))?t+"\n":""}({ownProps:e.ownProps})+(e.relational?function(e){return Object.keys(e.relational).reduce((function(t,r,n){var o=e.relational[r];if(!o._relationshipName)throw Error("relationalQueryRecordEntry is invalid\n"+JSON.stringify(o,null,2));return t+(n>0?"\n":"")+o._relationshipName+" {"+fe({ownProps:o.properties,relational:o.relational})+"}\n"}),"")}({relational:he([e.relational])}):"")}function ye(e){var t=e.queryRecordEntry.relational;if(!t)return[];var r=e.queryRecordEntry.def.type;return Object.keys(t).reduce((function(e,n){var o=t[n];if(!o)return e;if(e.push({relationalType:"oneToOne"in o&&o.oneToOne?"oneToOne":"oneToMany",nodeType:o.def.type,properties:o.properties,relational:o.relational,parentNodeType:r}),o.relational){var a=ye({queryRecordEntry:o});e.push.apply(e,a)}return e}),[])}function he(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(r){!function(e){var r=e._relationshipName;if(t[r]){var n=t[r].relational||{},o=[].concat(t[r].properties||[]);e.properties.forEach((function(e){o.includes(e)||o.push(e)})),t[r]=f({},t[r],{properties:o,relational:e.relational?he([e.relational,n]):n})}else t[r]=f({},e,{relational:e.relational?he([e.relational]):void 0})}(e[r])}))})),t}function ge(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ve(e){return e.queryId.replace(/\W/g,"_")}function be(e){if("object"!=typeof e||null==e)return e;if(Array.isArray(e)){var t=[];return e.forEach((function(e){return t.push(be(e))})),t}var r={};for(var n in e)r[n]=be(e[n]);return r}function me(e){var t=[];Object.keys(e.object).forEach((function(r){var n=e.extension[r];if(void 0===n){if(!e.deleteKeysNotInExtension)return;null!=e.object[r]&&"object"==typeof e.object[r]?function e(t){Object.keys(t.object).forEach((function(r){"object"==typeof t.object[r]?e({object:t.object[r]}):delete t.object[r]}))}({object:e.object[r]}):delete e.object[r]}else t.push(r),null==n||"object"!=typeof n||Array.isArray(n)?e.object[r]=n:e.extendNestedObjects?(e.object[r]=e.object[r]||{},me({object:e.object[r]||{},extension:n,deleteKeysNotInExtension:e.deleteKeysNotInExtension,extendNestedObjects:!0})):e.object[r]=n})),Object.keys(e.extension).filter((function(e){return!t.includes(e)})).forEach((function(t){var r=e.extension[t];null==r||"object"!=typeof r||Array.isArray(r)?e.object[t]=r:e.extendNestedObjects?(e.object[t]=e.object[t]||{},me({object:e.object[t],extension:r,deleteKeysNotInExtension:e.deleteKeysNotInExtension,extendNestedObjects:!0})):e.object[t]=r}))}var Ee,Se=function(){function e(){var e=this;this.DOsById={},this.lastKnownPersistedDataById={},this.inFlightRequestsById={},this.onDOConstructed=function(t){if(!t.id)throw Error("No id found in DO");e.DOsById[t.id]=t},this.onDODeleted=function(t){if(!t.id)throw Error("No id found in DO");delete e.DOsById[t.id],delete e.lastKnownPersistedDataById[t.id]},this.onPersistedDataReceived=function(t){var r=t.data.id;e.inFlightRequestsById[r]?e.lastKnownPersistedDataById[r]=t.data:t.applyUpdateToDO()},this.onUpdateRequested=function(t){var r=e.getDOById(t.id);if(!r)return{onUpdateSuccessful:function(){},onUpdateFailed:function(){}};var n=f({},be(r.persistedData),{version:r.version,lastUpdatedBy:r.lastUpdatedBy});e.inFlightRequestsById[t.id]?e.inFlightRequestsById[t.id].push({rollbackState:n}):(e.lastKnownPersistedDataById[t.id]=n,e.inFlightRequestsById[t.id]=[{rollbackState:n}]);var o=e.inFlightRequestsById[t.id].length-1,a=Number(r.version);return r.onDataReceived(f({},t.payload,{version:a+1})),{onUpdateFailed:function(){e.handleUpdateFailed({updateIdx:o,id:t.id})},onUpdateSuccessful:function(){e.handleUpdateSuccessful({updateIdx:o,id:t.id})}}}}var t=e.prototype;return t.handleUpdateFailed=function(e){var t=this.inFlightRequestsById[e.id];if(t.length===e.updateIdx+1){var r=this.getDOById(e.id);if(!r)return;t.length>1?r.onDataReceived(t[t.length-1].rollbackState,{__unsafeIgnoreVersion:!0}):(r.onDataReceived(this.lastKnownPersistedDataById[e.id],{__unsafeIgnoreVersion:!0}),t.splice(e.updateIdx,1))}t.splice(e.updateIdx,1),this.cleanupIfNoInFlightRequests(e.id)},t.handleUpdateSuccessful=function(e){this.inFlightRequestsById[e.id].splice(e.updateIdx,1),this.cleanupIfNoInFlightRequests(e.id)},t.getDOById=function(e){return this.DOsById[e]},t.cleanupIfNoInFlightRequests=function(e){this.inFlightRequestsById[e].length||(delete this.lastKnownPersistedDataById[e],delete this.inFlightRequestsById[e])},e}(),Pe=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=Object.create((t&&t.prototype instanceof d?t:d).prototype),a=new R(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var u=E(i,r);if(u){if(u===c)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===c)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(e,r,a),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var c={};function d(){}function p(){}function f(){}var y={};u(y,o,(function(){return this}));var h=Object.getPrototypeOf,g=h&&h(h(x([])));g&&g!==t&&r.call(g,o)&&(y=g);var v=f.prototype=d.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function m(e,t){var n;this._invoke=function(o,a){function i(){return new t((function(n,i){!function n(o,a,i,u){var s=l(e[o],e,a);if("throw"!==s.type){var c=s.arg,d=c.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,u)}),(function(e){n("throw",e,i,u)})):t.resolve(d).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,u)}))}u(s.arg)}(o,a,n,i)}))}return n=n?n.then(i,i):i()}}function E(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,c;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function x(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:q}}function q(){return{value:void 0,done:!0}}return p.prototype=f,u(v,"constructor",f),u(f,"constructor",p),p.displayName=u(f,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(m.prototype),u(m.prototype,a,(function(){return this})),e.AsyncIterator=m,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new m(s(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(v),u(v,i,"Generator"),u(v,o,(function(){return this})),u(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=x,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(Ee={exports:{}}),Ee.exports),Re=0,xe=function(){function e(e){var t=this;this.onLoadMoreResults=void 0,this.onGoToNextPage=void 0,this.onGoToPreviousPage=void 0,this.onPaginationRequestStateChanged=void 0,this.items=void 0,this.pageInfoFromResults=void 0,this.clientSidePageInfo=void 0,this.useServerSidePaginationFilteringSorting=void 0,this.pagesBeingDisplayed=void 0,this.loadingState=exports.QueryState.IDLE,this.loadingError=null,this.totalCount=void 0,this.nodes=void 0,this.items=e.items,this.totalCount=e.totalCount,this.pageInfoFromResults=e.pageInfoFromResults,this.clientSidePageInfo=e.clientSidePageInfo,this.useServerSidePaginationFilteringSorting=e.useServerSidePaginationFilteringSorting,this.pagesBeingDisplayed=[e.clientSidePageInfo.lastQueriedPage],this.onLoadMoreResults=e.onLoadMoreResults,this.onGoToNextPage=e.onGoToNextPage,this.onGoToPreviousPage=e.onGoToPreviousPage,this.onPaginationRequestStateChanged=e.onPaginationRequestStateChanged,this.nodes=[],Object.defineProperty(this,"nodes",{enumerable:!0,get:function(){return t.useServerSidePaginationFilteringSorting?t.items:function(e){var t=qe(e.items,e.itemsPerPage);return e.pages.map((function(e){return t[e-1]})).flat()}({items:t.items,pages:t.pagesBeingDisplayed,itemsPerPage:t.clientSidePageInfo.pageSize})}})}var t,r=e.prototype;return r.loadMore=function(){var e=p(Pe.mark((function e(){var t=this;return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new A("No more results available - check results.hasNextPage before calling loadMore");case 2:return e.next=4,this.withPaginationEventLoadingState(p(Pe.mark((function e(){return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onLoadMoreResults();case 2:t.clientSidePageInfo.lastQueriedPage++,t.pagesBeingDisplayed=[].concat(t.pagesBeingDisplayed,[t.clientSidePageInfo.lastQueriedPage]);case 4:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.goToNextPage=function(){var e=p(Pe.mark((function e(){var t=this;return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new A("No next page available - check results.hasNextPage before calling goToNextPage");case 2:return e.next=4,this.withPaginationEventLoadingState(p(Pe.mark((function e(){return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onGoToNextPage();case 2:t.clientSidePageInfo.lastQueriedPage++,t.pagesBeingDisplayed=[t.clientSidePageInfo.lastQueriedPage];case 4:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.goToPreviousPage=function(){var e=p(Pe.mark((function e(){var t=this;return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPreviousPage){e.next=2;break}throw new A("No previous page available - check results.hasPreviousPage before calling goToPreviousPage");case 2:return e.next=4,this.withPaginationEventLoadingState(p(Pe.mark((function e(){return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.onGoToPreviousPage();case 2:t.clientSidePageInfo.lastQueriedPage--,t.pagesBeingDisplayed=[t.clientSidePageInfo.lastQueriedPage];case 4:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.withPaginationEventLoadingState=function(){var e=p(Pe.mark((function e(t){return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingState=exports.QueryState.LOADING,this.loadingError=null,e.prev=2,this.onPaginationRequestStateChanged(),e.next=6,t();case 6:this.loadingState=exports.QueryState.IDLE,e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(2),this.loadingState=exports.QueryState.ERROR,this.loadingError=e.t0,e.t0;case 14:return e.prev=14,this.useServerSidePaginationFilteringSorting||this.setNewClientSidePageInfoAfterClientSidePaginationRequest(),this.onPaginationRequestStateChanged(),e.finish(14);case 18:case"end":return e.stop()}}),e,this,[[2,9,14,18]])})));return function(t){return e.apply(this,arguments)}}(),r.goToPage=function(){var e=p(Pe.mark((function e(t){return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.setNewClientSidePageInfoAfterClientSidePaginationRequest=function(){this.pageInfoFromResults={totalPages:this.pageInfoFromResults.totalPages,hasNextPage:this.pageInfoFromResults.totalPages>this.clientSidePageInfo.lastQueriedPage,hasPreviousPage:this.clientSidePageInfo.lastQueriedPage>1,endCursor:this.pageInfoFromResults.endCursor,startCursor:this.pageInfoFromResults.startCursor}},(t=[{key:"hasNextPage",get:function(){return this.pageInfoFromResults.hasNextPage}},{key:"hasPreviousPage",get:function(){return this.pageInfoFromResults.hasPreviousPage}},{key:"totalPages",get:function(){return this.pageInfoFromResults.totalPages}},{key:"page",get:function(){return this.clientSidePageInfo.lastQueriedPage}}])&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,t),e}(),qe=function e(t,r){return t.length>r?[t.slice(0,r)].concat(e(t.slice(r),r)):[t]},Ie=new r;function Oe(){return Ie.word()}function De(){return Ie.bool()}function Te(e,t){return Ie.integer({min:e,max:t})}function we(){return Ie.guid()}var _e=["condition"];function Ne(e){switch(e.type){case exports.DATA_TYPES.string:return Oe();case exports.DATA_TYPES.maybeString:return Qe([Oe(),null]);case exports.DATA_TYPES.stringEnum:return Qe(e.acceptableValues);case exports.DATA_TYPES.maybeStringEnum:return Qe([Qe(e.acceptableValues),null]);case exports.DATA_TYPES.number:return Te(1,100);case exports.DATA_TYPES.maybeNumber:return Qe([Te(1,100),null]);case exports.DATA_TYPES.boolean:return De();case exports.DATA_TYPES.maybeBoolean:return Qe([De(),null]);case exports.DATA_TYPES.object:return Ce(e.boxedValue);case exports.DATA_TYPES.maybeObject:return Qe([Ce(e.boxedValue),null]);case exports.DATA_TYPES.array:return new Array(Te(1,10)).fill("").map((function(t){return Ne("function"==typeof e.boxedValue?e.boxedValue._default:e.boxedValue)}));case exports.DATA_TYPES.maybeArray:return Qe([new Array(Te(1,10)).fill("").map((function(t){return Ne("function"==typeof e.boxedValue?e.boxedValue._default:e.boxedValue)})),null]);case exports.DATA_TYPES.record:var t;return(t={})[Oe()]=Ne("function"==typeof e.boxedValue?e.boxedValue._default:e.boxedValue),t;case exports.DATA_TYPES.maybeRecord:var r;return Qe([(r={},r[Oe()]=Ne("function"==typeof e.boxedValue?e.boxedValue._default:e.boxedValue),r),null]);default:throw new M(e.type)}}function Ce(e){return Object.entries(e).reduce((function(e,t){var r=t[1];return e[t[0]]=Ne("function"==typeof r?r._default:r),e}),{})}function ke(e){var t=e.queryRecordEntry,r=f({},Ce(Object.keys(t.def.data).filter((function(e){return t.properties.some((function(t){return t.startsWith(e)}))})).reduce((function(e,r){return e[r]=t.def.data[r],e}),{})),{type:e.queryRecordEntry.def.type,id:we(),version:"1"});if(t.def.generateMockData){var n=t.def.generateMockData();me({object:r,extension:Object.keys(n).reduce((function(e,r){return t.properties.some((function(e){return e.startsWith(r)}))&&(e[r]=n[r]),e}),{}),extendNestedObjects:!0,deleteKeysNotInExtension:!1})}return t.filter&&me({object:r,extension:function e(t){var r=t.data,n={};return Object.entries(t.filter).forEach((function(t){var o=t[0],a=t[1],i=null!=r[o]?"function"==typeof r[o]?r[o]._default:r[o]:null,u=i?i.type:null;if(i)if(null!==a&&"object"==typeof a){if(u===exports.DATA_TYPES.object||u===exports.DATA_TYPES.maybeObject)return void(n[o]=e({filter:a,data:i.boxedValue}));var s=E(a,_e),l=Object.keys(s)[0],c=s[l];switch(l){case"eq":n[o]=c;break;case"neq":var d=!1;do{var p=Ne(i);p!==c&&(d=!0,n[o]=p)}while(!d);break;case"gt":case"nlte":n[o]=c+Te(1,1e3);break;case"ngt":case"lte":n[o]=c-Te(0,c>0?c:1e3);break;case"gte":case"nlt":n[o]=c+Te(0,1e3);break;case"ngte":case"lt":n[o]=c-Te(1,c>0?c:1e3);break;case"contains":var f=!1;do{var y=Ne(i);if(null!=y&&"string"==typeof y){if(y.includes(c))n[o]=y;else{var h=Te(0,y.length-1);n[o]=""+y.slice(0,h)+c+y.slice(h)}f=!0}}while(!f);break;case"ncontains":var g=!1;do{var v=Ne(i);(null==v||"string"==typeof v&&!v.includes(c))&&(g=!0,n[o]=v)}while(!g);break;case"startsWith":var b=Ne(i);n[o]=c+b;break;case"nstartsWith":var m=!1;do{var S=Ne(i);(null==S||"string"==typeof S&&!S.startsWith(c))&&(m=!0,n[o]=S)}while(!m);break;case"endsWith":var P=Ne(i);n[o]=P+c;break;case"nendsWith":var R=!1;do{var x=Ne(i);(null==x||"string"==typeof x&&!x.endsWith(c))&&(R=!0,n[o]=x)}while(!R)}}else void 0!==a&&(n[o]=a)})),n}({data:t.def.data,filter:t.filter}),extendNestedObjects:!0,deleteKeysNotInExtension:!1}),r}function Ae(e){var t=e.queryRecord,r={};return Object.keys(t).forEach((function(e){var n=t[e];if(n){var o,a=le({queryRecordEntry:n}),i=ce({queryRecordEntry:n}),u=Object.entries(n.relational||{}).reduce((function(e,t){var r=t[0];return e[r]=be(t[1]),n.filter&&Object.keys(n.filter).includes(r)&&(e[r].filter=f({},e[r].filter||{},be(n.filter[r]))),e}),{});if(a){for(var s,l=(null==(s=n.pagination)?void 0:s.itemsPerPage)||2e3,c=Te(1,5*l),d=[],p=0;p<c;p++){var y=ke({queryRecordEntry:n}),h=Ae({queryRecord:u});d.push(f({},y,h))}var g,v={endCursor:"xyz",startCursor:"yzx",hasPreviousPage:!1,hasNextPage:l<d.length,totalPages:Math.ceil(d.length/l)};i?((g={}).nodes=d,g.totalCount=d.length,g.pageInfo=v,o=g):o=d}else{var b=ke({queryRecordEntry:n});o=f({},b,Ae({queryRecord:u}),{id:"id"in n?n.id:b.id})}r[e]=o}else r[e]=null})),r}function Qe(e){return e[Math.floor(Math.random()*e.length)]}function je(e){var t=e.operator,r=e.itemValue,n=e.filterValue;switch(t){case"contains":return-1!==String(r).toLowerCase().indexOf(String(n).toLowerCase());case"ncontains":return-1===String(r).toLowerCase().indexOf(String(n).toLowerCase());case"eq":return String(r).toLowerCase()===String(n).toLowerCase();case"neq":return String(r).toLowerCase()!==String(n).toLowerCase();case"gt":case"nlte":return r>n;case"gte":case"nlt":return r>=n;case"lt":case"ngte":return r<n;case"lte":case"ngt":return r<=n;case"startsWith":return String(r).toLowerCase().startsWith(String(n).toLowerCase());case"nstartsWith":return!String(r).toLowerCase().startsWith(String(n).toLowerCase());case"endsWith":return String(r).toLowerCase().endsWith(String(n).toLowerCase());case"nendsWith":return!String(r).toLowerCase().endsWith(String(n).toLowerCase());default:throw new L({operator:t})}}function Fe(e){var t=e.operator,r=e.filterValue,n=e.underscoreSeparatedPropName;return e.relationalItems.some((function(e){var o=Ye({item:e,underscoreSeparatedPropName:n});return je({operator:t,filterValue:r,itemValue:o})}))}function Le(e,t,r){return e===t?0:null===e?1:null===t?-1:r?e<t?-1:1:e<t?1:-1}function Me(e){var t=e.isRelational&&e.relationalKey?e.oneToMany?e.node[e.relationalKey].nodes||[]:e.nonPaginatedOneToMany?e.node[e.relationalKey]||[]:e.node[e.relationalKey]:e.node;return Array.isArray(t)?t.sort((function(t,r){return Le(Ue(t,e.underscoreSeparatedPropName),Ue(r,e.underscoreSeparatedPropName),"asc"===e.direction)})).map((function(t){return t[e.underscoreSeparatedPropName]})).join(""):Ue(t,e.underscoreSeparatedPropName)}function Ue(e,t){var r=Ye({item:e,underscoreSeparatedPropName:t});return null===r?null:Number(r)||r}function Ve(e,t){Object.keys(e).forEach((function(r){var o=e[r];null!=o&&o.filter&&function(e){var t=e.queryRecordEntry,r=e.data,o=e.alias,a=Be({queryRecordEntry:t,skipRelationalFilters:!1});if(a&&r[o]){var i=Object.keys(a).map((function(e){var r=String(e).split("."),n=r[0],o=r.slice(1),i=n&&t.relational&&t.relational[n],u=a[e],s=Object.keys(u).filter((function(e){return"condition"!==e})).map((function(e){return{operator:e,value:u[e]}})),l=!!i,c=l?o.join("__dot__"):e.replaceAll(".","__dot__");return{dotSeparatedPropName:e,underscoreSeparatedPropName:c,propNotInQuery:l?!1===i.properties.includes(c):!1===t.properties.includes(c),operators:s,condition:u.condition,isRelational:l,relationalKey:n,oneToOne:i&&"oneToOne"in i||void 0,oneToMany:i&&"oneToMany"in i||void 0,nonPaginatedOneToMany:i&&"nonPaginatedOneToMany"in i||void 0}}));if(i.length>0){var u=""+o;ce({queryRecordEntry:t})&&(u+=".nodes"),n.update(r,u,(function(e){return n.isArray(e)?e.filter((function(e){var t=i.find((function(e){return e.propNotInQuery}));if(t)throw new _({filterPropName:t.dotSeparatedPropName});var r=i.filter((function(e){return"or"===e.condition})),n=i.filter((function(e){return"and"===e.condition||"some"===e.condition})),o=n.every((function(t){if(t.isRelational)return t.operators.every((function(r){var n=r.operator,o=r.value;if(t.oneToOne)return je({operator:n,filterValue:o,itemValue:t.relationalKey?Ye({item:e[t.relationalKey],underscoreSeparatedPropName:t.underscoreSeparatedPropName}):""});if(t.nonPaginatedOneToMany)return Fe({relationalItems:t.relationalKey&&e[t.relationalKey]||[],operator:n,filterValue:o,underscoreSeparatedPropName:t.underscoreSeparatedPropName});if(t.oneToMany)return Fe({relationalItems:t.relationalKey&&e[t.relationalKey].nodes||[],operator:n,filterValue:o,underscoreSeparatedPropName:t.underscoreSeparatedPropName});throw new Error("Unrecognized relational filter type.")}));var r=Ye({item:e,underscoreSeparatedPropName:t.underscoreSeparatedPropName});return t.operators.every((function(e){return je({operator:e.operator,filterValue:e.value,itemValue:r})}))}))||0===n.length;if(!o)return!1;var a=r.some((function(t){if(t.isRelational)return t.operators.some((function(r){var n=r.operator,o=r.value;if(t.oneToOne)return je({operator:n,filterValue:o,itemValue:t.relationalKey?Ye({item:e[t.relationalKey],underscoreSeparatedPropName:t.underscoreSeparatedPropName}):""});if(t.nonPaginatedOneToMany)return Fe({relationalItems:t.relationalKey&&e[t.relationalKey]||[],operator:n,filterValue:o,underscoreSeparatedPropName:t.underscoreSeparatedPropName});if(t.oneToMany)return Fe({relationalItems:t.relationalKey&&e[t.relationalKey].nodes||[],operator:n,filterValue:o,underscoreSeparatedPropName:t.underscoreSeparatedPropName});throw new Error("Unrecognized relational filter type.")}));var r=t.relationalKey?Ye({item:e,underscoreSeparatedPropName:t.underscoreSeparatedPropName}):"";return t.operators.some((function(e){return je({operator:e.operator,filterValue:e.value,itemValue:r})}))}))||0===r.length;return o&&a})):e}))}}}({queryRecordEntry:o,data:t,alias:r}),null!=o&&o.sort&&function(e){var t=e.queryRecordEntry,r=e.data,o=e.alias,a=Ge({queryRecordEntry:t,skipRelationalSorts:!1});if(a&&r[o]){var i=n.orderBy(Object.keys(a).map((function(e,r){var n=String(e).split("."),o=n[0],i=n.slice(1),u=o&&t.relational&&t.relational[o],s=!!u,l=s?i.join("__dot__"):e.replaceAll(".","__dot__");return{dotSeparatedPropName:e,underscoreSeparatedPropName:l,propNotInQuery:s?!1===u.properties.includes(l):!1===t.properties.includes(l),isRelational:s,relationalKey:o,oneToOne:u&&"oneToOne"in u||void 0,oneToMany:u&&"oneToMany"in u||void 0,nonPaginatedOneToMany:u&&"nonPaginatedOneToMany"in u||void 0,priority:a[e].priority||1e4*(r+1),direction:a[e].direction||"asc"}})),(function(e){return e.priority}),"asc"),u=i.filter((function(e){return e.propNotInQuery}));if(u.length>0)throw new N({sortPropName:u[0].dotSeparatedPropName});var s=""+o;ce({queryRecordEntry:t})&&(s+=".nodes"),n.update(r,s,(function(e){return n.isArray(e)?e.sort((function(e,t){return i.map((function(r){return Le(Me({node:e,direction:r.direction,isRelational:r.isRelational,oneToMany:r.oneToMany,nonPaginatedOneToMany:r.nonPaginatedOneToMany,underscoreSeparatedPropName:r.underscoreSeparatedPropName,relationalKey:r.relationalKey}),Me({node:t,direction:r.direction,isRelational:r.isRelational,oneToMany:r.oneToMany,underscoreSeparatedPropName:r.underscoreSeparatedPropName,relationalKey:r.relationalKey}),"asc"===r.direction)})).reduce((function(e,t){return e||t}),void 0)})):e}))}}({queryRecordEntry:o,data:t,alias:r});var a=null==o?void 0:o.relational;if(null!=a){var i=de({queryResponsePartial:t[r],queryRecordEntry:o,collectionsIncludePagingInfo:!0});Array.isArray(i)?i.forEach((function(e){Ve(a,e)})):Ve(a,i)}}))}function Be(e){var t={},r=e.queryRecordEntry.filter;if(!r)return t;var o=e.queryRecordEntry.relational,a=e.queryRecordEntry.def.data,i=function(i){var u=r[i],s=a[i]&&(a[i].type===exports.DATA_TYPES.object||a[i].type===exports.DATA_TYPES.maybeObject),l=!!o&&null!=o[i],c=n.isObject(u)&&(l||s);if(c&&e.skipRelationalFilters)return"continue";if("object"==typeof u&&null!==u&&c){var d=Be({queryRecordEntry:f({},e.queryRecordEntry,{def:s?f({},e.queryRecordEntry.def,{data:a[i].boxedValue}):o[i].def,properties:s?e.queryRecordEntry.properties.filter((function(e){return e.startsWith(i)})).map((function(e){return e.split("__dot__").slice(1).join("__dot__")})):o[i].properties,filter:u}),skipRelationalFilters:e.skipRelationalFilters});Object.keys(d).forEach((function(e){t[i+"."+e]=d[e]}))}else if(n.isObject(u))t[i]=f({},u,{condition:u.condition||"and"});else if(void 0!==u){var p;t[i]=((p={})[exports.EStringFilterOperator.eq]=u,p.condition="and",p)}};for(var u in r)i(u);return t}function Ge(e){var t=e.queryRecordEntry,r={},o=t.sort,a=t.def.data,i=t.relational;if(!o)return r;var u=function(t){var u=o,s=u[t],l=n.isObject(s)&&!Object.keys(s).includes("direction"),c=a[t]&&(a[t].type===exports.DATA_TYPES.object||a[t].type===exports.DATA_TYPES.maybeObject),d=!!i&&null!=i[t];if(n.isObject(s)&&(d||c)&&e.skipRelationalSorts)return"continue";if("object"==typeof u[t]&&null!==u[t]&&l){var p=Ge({queryRecordEntry:f({},e.queryRecordEntry,{def:c?f({},e.queryRecordEntry.def,{data:a[t].boxedValue}):i[t].def,properties:c?e.queryRecordEntry.properties.filter((function(e){return e.startsWith(t)})).map((function(e){return e.split("__dot__").slice(1).join("__dot__")})):i[t].properties,sort:s}),skipRelationalSorts:e.skipRelationalSorts});for(var y in p)p.hasOwnProperty(y)&&(r[t+"."+y]=p[y])}else n.isObject(s)?r[t]=s:void 0!==s&&(r[t]={direction:s})};for(var s in o)u(s);return r}function Ye(e){var t=e.item,r=e.underscoreSeparatedPropName.split("__dot__"),n=r[0],o=r.slice(1);return 0===o.length?t[n]:Ye({item:t[n],underscoreSeparatedPropName:o.join("__dot__")})}function Ke(e){return e.endsWith("}")&&!e.includes("{")||e.endsWith("]")&&!e.includes("[")||e.endsWith(")")&&!e.includes("(")||e.startsWith(")")}function We(e){return e.endsWith("{")||e.endsWith("[")||e.endsWith("(")}function ze(e){var t,r,n=null==(t=e.loc)?void 0:t.source.body;if(!n)throw Error("No source on the document node");return r=0,n.split("\n").map((function(e){return e.trim()})).map((function(e,t,n){var o=r;if(We(e))r++;else if(Ke(e)){o--;var a=n[t+1];a&&We(a)&&Ke(a)?r-=2:r--}return""+(o>0?new Array(2*o).fill(null).join(" "):"")+e})).join("\n")}function He(e){var t=e.queryRecord,r=e.staticData,n={};return Object.keys(t).forEach((function(e){var o=t[e];if(o){var a=o.id,i=o.ids,u=o.relational,s=o.def.type;if(!r[s])throw new Error("No static data for type "+s);if(null==a){if(null==i){var l,c,d,p=Object.values(r[s]).map(g),y=((c={})[e]=((l={}).nodes=p,l),c);return Ve(((d={})[e]=o,d),y),void(n[e]=Je({filteredNodes:y[e].nodes,queryRecordEntry:o}))}var h=i.map((function(e){if(!r[s][e])throw new Error("No static data for node of type "+s+' with id "'+e+'"');return g(r[s][e])}));n[e]=Je({filteredNodes:h,queryRecordEntry:o})}else{if(!r[s][a])throw new Error("No static data for node of type "+s+' with id "'+a+'"');n[e]=g(r[s][a])}}else n[e]=null;function g(e){return e?u?function(e){var t=e.dataToAugment,r=e.allStaticData,n=e.relational,o={};return Object.keys(n).forEach((function(e){var a,i=n[e],u=i.def,s=i._relationshipName,l=i.properties,c=i.relational;if(!t[s]||!t[s][$e])throw Error("The relationship "+s+" was queried for the node with the id "+t.id+" but it was not included in the static data.");var d=t[s][$e];if(!t[d])throw Error("The relationship "+s+" was queried for the node with the id "+t.id+" but the static relational property "+d+" was not included in the static data.");var p=t[d],f={def:u,id:"string"==typeof p||"number"==typeof p?p:void 0,ids:Array.isArray(p)?p:void 0,properties:l,relational:c,tokenName:""},y=He({queryRecord:(a={},a[e]=f,a),staticData:r});if("oneToMany"in n[e]){var h,g,v=((h={})[e]=y[e],h);Ve(((g={})[e]=n[e],g),v),o[e]=Je({filteredNodes:v[e].nodes,queryRecordEntry:n[e]})}else if("oneToOne"in n[e])o[e]=y[e];else{if(!("nonPaginatedOneToMany"in n[e]))throw new M(n[e]);var b,m,E=((b={})[e]=y[e].nodes||[],b);Ve(((m={})[e]=n[e],m),E),o[e]=E[e]}})),f({},t,o)}({dataToAugment:e,allStaticData:r,relational:u}):e:null}})),n}function Je(e){var t,r,n,o=e.filteredNodes,a=e.queryRecordEntry,i=(null==(t=a.pagination)?void 0:t.itemsPerPage)||2e3,u=null!=(r=a.pagination)&&r.startCursor?Number(a.pagination.startCursor):1,s=Math.ceil(o.length/i),l={totalPages:Math.ceil(o.length/i),hasNextPage:s>u,hasPreviousPage:u>1,endCursor:String(u+1),startCursor:String(u)},c=o.slice((u-1)*i,u*i);return(n={}).nodes=c,n.pageInfo=l,n.totalCount=o.length,n}var $e="__staticRelational";function Xe(e){return Object.entries(e).reduce((function(e,t){var r=t[0],n=t[1],o=n&&"tokenName"in n&&null!=n.tokenName?n.tokenName:"default";return e[o]=e[o]||{},e[o][r]=n,e}),{})}function Ze(e){return Object.entries(e).reduce((function(e,t){var r=t[1];return r?(e[t[0]]=r,e):e}),{})}function et(e){return Object.entries(e).reduce((function(e,t){return null==t[1]&&(e[t[0]]=null),e}),{})}function tt(e){return rt.apply(this,arguments)}function rt(){return(rt=p(Pe.mark((function e(t){var r,n,o,a,i;return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(e){return t.mmGQLInstance.getToken({tokenName:e})},t.mmGQLInstance.logging.gqlQueries&&console.log("performing query",ze(t.queryGQL)),!t.mmGQLInstance.generateMockData){e.next=12;break}if("static"!==t.mmGQLInstance.mockDataType){e.next=9;break}if(t.mmGQLInstance.staticData){e.next=6;break}throw Error("Expected staticData to be defined when using static mock data");case 6:n=He({queryRecord:t.queryRecord,staticData:t.mmGQLInstance.staticData}),e.next=10;break;case 9:n=Ae({queryRecord:t.queryRecord});case 10:e.next=22;break;case 12:if(!t.mmGQLInstance.enableQuerySlimming){e.next=18;break}return e.next=15,t.mmGQLInstance.QuerySlimmer.query({queryId:t.queryId,queryRecord:t.queryRecord,useServerSidePaginationFilteringSorting:t.mmGQLInstance.paginationFilteringSortingInstance===exports.EPaginationFilteringSortingInstance.SERVER,tokenName:r(t.tokenName||"default"),batchKey:t.batchKey||void 0});case 15:n=e.sent,e.next=22;break;case 18:return a=[{gql:t.queryGQL,token:r(t.tokenName||"default"),batchKey:t.batchKey||void 0}],e.next=21,(o=t.mmGQLInstance.gqlClient).query.apply(o,a);case 21:n=e.sent;case 22:if(t.mmGQLInstance.paginationFilteringSortingInstance!==exports.EPaginationFilteringSortingInstance.CLIENT||t.mmGQLInstance.generateMockData&&"static"===t.mmGQLInstance.mockDataType){e.next=27;break}return Ve(t.queryRecord,i=n),e.abrupt("return",i);case 27:if(!t.mmGQLInstance.generateMockData){e.next=30;break}return e.next=30,new Promise((function(e){return setTimeout(e,(null==t.getMockDataDelay?void 0:t.getMockDataDelay())||0)}));case 30:return t.mmGQLInstance.logging.gqlQueries&&console.log("query response",JSON.stringify(n,null,2)),e.abrupt("return",n);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e){var t=e.previousQueryRecord,r={},n=[];return Object.entries(e.nextQueryRecord).forEach((function(e){var o=e[0],a=e[1];if(a){var i=t[o];if(!i)return n.push([o]),void(r[o]=a);if(at({previousQueryRecordEntry:i,nextQueryRecordEntry:a}))return r[o]=a,void n.push([o]);if(le({queryRecordEntry:a})&&ot({previousQueryRecordEntry:i,nextQueryRecordEntry:a}))return r[o]=a,void n.push([o]);var u=function(e){var t=e.previousQueryRecordEntry,r=e.nextQueryRecordEntry;if(null==r.relational||null==t.relational)return r.relational;var n=t.relational,o=Object.entries(r.relational).reduce((function(e,t){var r=t[0],o=t[1],a=n[r];return a?at({previousQueryRecordEntry:a,nextQueryRecordEntry:o})||ot({previousQueryRecordEntry:a,nextQueryRecordEntry:o})?(e[r]=o,e):e:(e[r]=o,e)}),{});return Object.keys(o).length?o:void 0}({previousQueryRecordEntry:i,nextQueryRecordEntry:a});u&&(r[o]=f({},a,{relational:u}),Object.keys(u).forEach((function(e){var t=a.id;if(!t)throw Error("Expected a node id");n.push([ut({aliasPathEntry:o,id:t}),e])})))}})),{minimalQueryRecord:r,aliasPathsToUpdate:n}}function ot(e){var t=e.previousQueryRecordEntry,r=e.nextQueryRecordEntry;if(null==r.relational)return!1;if(null==t.relational)return!0;var n=t.relational;return Object.entries(r.relational).some((function(e){var t=e[1],r=n[e[0]];return!r||JSON.stringify({filter:r.filter,sort:r.sort,pagination:r.pagination})!==JSON.stringify({filter:t.filter,sort:t.sort,pagination:t.pagination})||ot({previousQueryRecordEntry:r,nextQueryRecordEntry:t})}))}function at(e){var t=e.nextQueryRecordEntry;return it({queryRecordEntry:e.previousQueryRecordEntry})!==it({queryRecordEntry:t})}function it(e){return JSON.stringify({filter:e.queryRecordEntry.filter,sort:e.queryRecordEntry.sort,pagination:e.queryRecordEntry.pagination,targeting:{id:"id"in e.queryRecordEntry?e.queryRecordEntry.id:null,ids:"ids"in e.queryRecordEntry?e.queryRecordEntry.ids:null}})}function ut(e){return e.aliasPathEntry+"["+e.id+"]"}function st(e){return e.charAt(0).toLowerCase()+e.slice(1)}function lt(e){if(e===e.toLowerCase())return e;var t=e.split("_");return 1===t.length?e.toLowerCase():t.reduce((function(e,t,r){return 0===r?t.toLowerCase():""+e+t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}),"")}var ct=function(){function e(e){this.mmGQLInstance=void 0,this.queriesByContext={},this.inFlightQueryRecords=o.observable({}),this.mmGQLInstance=e}var t=e.prototype;return t.query=function(){var e=p(Pe.mark((function e(t){var r,n,o;return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=this.getSlimmedQueryAgainstCache(t.queryRecord))){e.next=7;break}return n=this.getDataForQueryFromCache(t.queryRecord),this.log("[QuerySlimmer] query fully cached.",{originalQuery:t.queryRecord,cache:this.queriesByContext,dataReturned:n}),e.abrupt("return",n);case 7:return e.next=9,this.sendQueryRequest({queryId:t.queryId,queryRecord:r,useServerSidePaginationFilteringSorting:t.useServerSidePaginationFilteringSorting,tokenName:t.tokenName,batchKey:t.batchKey});case 9:return o=this.getDataForQueryFromCache(t.queryRecord),this.log("[QuerySlimmer] query partially cached.",{originalQuery:t.queryRecord,slimmedQuery:r,cache:this.queriesByContext,dataReturned:o}),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.cacheNewData=function(e,t,r){var n=this;Object.keys(e).forEach((function(o){var a=e[o];if(a){var i=n.createContextKeyForQueryRecordEntry(a,r),u=n.queriesByContext[i],s=null!=u&&u.subscriptionsByProperty?f({},null==u?void 0:u.subscriptionsByProperty):{},l=void 0!==r,c={byParentId:l};if(l)Object.keys(t).forEach((function(e,r){c[e]={};var n=c[e],i=t[e][o];null!=i&&"nodes"in i?(n[o]={nodes:[]},"pageInfo"in i&&(n[o].pageInfo=i.pageInfo),i.nodes.forEach((function(e,t){var i={};a.properties.forEach((function(n){i[n]=e[n],0===t&&0===r&&(s[n]?s[n]+=1:s[n]=1)})),n[o].nodes.push(i)}))):null==i?(n[o]=null,a.properties.forEach((function(e){0===r&&(s[e]?s[e]+=1:s[e]=1)}))):(n[o]={},a.properties.forEach((function(e){n[o][e]=i[e],0===r&&(s[e]?s[e]+=1:s[e]=1)})))}));else{c[o]={};var d=c[o];null!=t[o]&&"nodes"in t[o]?("pageInfo"in t[o]&&(d.pageInfo=t[o].pageInfo),d.nodes=t[o].nodes.map((function(e,t){var r={};return a.properties.forEach((function(n){r[n]=e[n],0===t&&(s[n]?s[n]+=1:s[n]=1)})),r}))):a.properties.forEach((function(e){d[e]=t[o][e],s[e]?s[e]+=1:s[e]=1}))}var p=n.mergeQueryResults({cachedResult:null==u?void 0:u.results,newResult:c});if(n.queriesByContext[i]={subscriptionsByProperty:s,results:p},void 0!==a.relational){var y=a.relational,h=Object.keys(y);if(l)h.forEach((function(e){var r,a=Object.keys(t),u={};a.forEach((function(r){var n,a=t[r][o];null!=a&&("nodes"in a?a.nodes.forEach((function(t){u[t.id]||(u[t.id]={}),u[t.id][e]=t[e]})):u[a.id]=((n={})[e]=a[e],n))}));var s=((r={})[e]=y[e],r);0!==Object.keys(u).length&&n.cacheNewData(s,u,i)}));else{var g={};null!=t[o]&&"nodes"in t[o]?(t[o].nodes.forEach((function(e){g[e.id]={},h.forEach((function(t){g[e.id][t]=e[t]}))})),n.cacheNewData(y,g,i)):h.forEach((function(e){var r,a,u,s=((a={})[t[o].id]=((r={})[e]=t[o][e],r),a),l=((u={})[e]=y[e],u);n.cacheNewData(l,s,i)}))}}}}))},t.getSlimmedQueryAgainstCache=function(e,t){var r=this,n={},o={},a=void 0===t;Object.keys(e).forEach((function(i){var u=e[i],s=u,l=u;if(u){var c=r.createContextKeyForQueryRecordEntry(u,t);if(void 0===r.queriesByContext[c])a?n[i]=s:o[i]=l;else{var d=r.getPropertiesNotAlreadyCached({newQueryProps:u.properties,cachedQuerySubsByProperty:r.queriesByContext[c].subscriptionsByProperty});if(null!==d&&void 0===u.relational&&(a?n[i]=f({},s,{properties:d}):o[i]=f({},l,{properties:d})),void 0!==u.relational){var p=r.getSlimmedQueryAgainstCache(u.relational,c);null!==p&&(a?n[i]=f({},s,{properties:null!=d?d:Object.keys(H),relational:f({},p)}):o[i]=f({},l,{properties:null!=d?d:[],relational:f({},p)}))}}}}));var i=a?n:o;return 0===Object.keys(i).length?null:i},t.getDataForQueryFromCache=function(e,t){var r=this,n={};return Object.keys(e).forEach((function(o){var a=e[o];if(a){var i=r.createContextKeyForQueryRecordEntry(a,t),u=r.queriesByContext[i],s={};if(null!=u)if(u.results.byParentId)Object.entries(u.results).forEach((function(e){var t=e[0],r=e[1];"byParentId"!==t&&(s[t]=t in s?f({},s[t],r):f({},r))}));else{var l=u.results[o];if(null!=l&&"nodes"in l){var c=[];l.nodes.forEach((function(e){var t={};a.properties.forEach((function(r){t[r]=e[r]})),c.push(t)})),s={nodes:c},"pageInfo"in l&&(s.pageInfo=l.pageInfo)}else a.properties.forEach((function(e){s[e]=l[e]}))}if(void 0!==a.relational){var d=r.getDataForQueryFromCache(a.relational,i);0!==Object.keys(d).length&&(t?Object.entries(s).forEach((function(e){var t=e[0],r=e[1],n=r[o];null!=n&&"nodes"in n?n.nodes=n.nodes.map((function(e){return e.id in d?f({},e,d[e.id]):e})):s[t][o]=f({},r[o],d[n.id])})):null!=s&&"nodes"in s?s.nodes=s.nodes.map((function(e){return e.id in d?f({},e,d[e.id]):e})):s=f({},s,d[s.id]))}t?Object.entries(s).forEach((function(e){var t=e[0],r=e[1];n[t]=n[t]?f({},n[t],r):r})):n[o]=f({},s)}})),n},t.onSubscriptionCancelled=function(e,t){var r=this;Object.keys(e).forEach((function(n){var o=e[n];if(o){var a=r.createContextKeyForQueryRecordEntry(o,t);if(void 0!==o.relational&&r.onSubscriptionCancelled(o.relational,a),a in r.queriesByContext){var i=r.queriesByContext[a].subscriptionsByProperty;o.properties.forEach((function(e){var t=i[e];t>=1&&(i[e]=t-1)}))}}}))},t.getRelationalDepthOfQueryRecordEntry=function(e){var t=this,r=0;return void 0!==e.relational&&(r+=1,Object.values(e.relational).forEach((function(e){r+=t.getRelationalDepthOfQueryRecordEntry(e)}))),r},t.createContextKeyForQueryRecordEntry=function(e,t){return(t?t+".":"")+(e._relationshipName?e._relationshipName:e.def.type+("id"in e&&e.id?"":"s"))+"("+this.stringifyQueryParams(e)+")"},t.getPropertiesNotAlreadyCached=function(e){var t=e.newQueryProps.filter((function(t){return t in H||!(t in e.cachedQuerySubsByProperty)||0===e.cachedQuerySubsByProperty[t]}));return null!=t&&t.some((function(e){return!(e in H)}))?t:null},t.mergeQueryResults=function(e){var t=this;if(null==e.cachedResult)return e.newResult;var r=f({},e.cachedResult);return Object.entries(e.newResult).forEach((function(e){var n=e[0],o=e[1];if("byParentId"!==n)if(null!=o&&"object"==typeof o)if("nodes"in o){var a=[];o.nodes.forEach((function(e){if(null==r[n])a.push(e);else{var o=r[n].nodes.find((function(t){return t.id===e.id}));if(o){var i=f({},o);Object.entries(e).forEach((function(e){var r=e[0],n=e[1];if("object"==typeof n){var o,a,u={cachedResult:(o={},o[r]=i[r],o),newResult:(a={},a[r]=n,a)},s=t.mergeQueryResults(u);i[r]=s[r]}else r in i||(i[r]=n)})),a.push(i)}}})),null==r[n]&&(r[n]={pageInfo:o.pageInfo}),r[n].nodes=a}else Object.entries(o).forEach((function(e){var o,a=e[0],i=e[1];if(n in r)if("object"==typeof i){var u,s;console.log("mergedResult",r,n,a);var l={cachedResult:(u={},u[a]=r[n][a],u),newResult:(s={},s[a]=i,s)},c=t.mergeQueryResults(l);r[n][a]=c[a]}else null==r[n]?(r[n]={},r[n][a]=i):a in r[n]||(r[n][a]=i);else r[n]=((o={})[a]=i,o)}));else r[n]=o})),r},t.stringifyQueryParams=function(e){var t={ids:"ids"in e?e.ids:void 0,id:"id"in e?e.id:void 0};return Object.values(t).some((function(e){return null!=e}))?JSON.stringify(t):"NO_PARAMS"},t.sendQueryRequest=function(){var e=p(Pe.mark((function e(t){var r,n,o;return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=se({queryId:t.queryId,queryRecord:t.queryRecord,useServerSidePaginationFilteringSorting:t.useServerSidePaginationFilteringSorting})){e.next=3;break}return e.abrupt("return");case 3:return n={gql:r,token:t.tokenName},"batchKey"in t&&void 0!==t.batchKey&&(n.batchKey=t.batchKey),e.prev=5,e.next=8,this.mmGQLInstance.gqlClient.query(n);case 8:this.log("[QuerySlimmer]: Query request response recieved",{queryId:t.queryId,queryRecord:t.queryRecord,queryResponse:o=e.sent}),this.cacheNewData(t.queryRecord,o),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(5),this.log("QuerySlimmer: Error sending query request",{queryId:t.queryId,queryRecord:t.queryRecord,error:e.t0}),new Error("[QuerySlimmer] sendQueryRequest error: "+e.t0);case 17:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(t){return e.apply(this,arguments)}}(),t.log=function(e){if(this.mmGQLInstance.logging.querySlimming){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=console).log.apply(t,[e].concat(n))}},e}(),dt=a.createContext(void 0),pt=a.createContext({unsafe__silenceDuplicateSubIdErrors:!1}),ft={suspendEnabled:"suspendEnabled",suspendDisabled:"suspendDisabled"};function yt(e){var r={credentials:"include"};e.getCookie&&(r.headers={cookie:e.getCookie()});var n=new t.ApolloLink((function(t){return new i.WebSocketLink({uri:e.wsUrl,options:{reconnect:!0,wsOptionArguments:[r],inactivityTimeout:1},webSocketImpl:l}).request(t)})),o=new u.HttpLink({uri:e.httpUrl,credentials:"include"}),a=t.split((function(e){var t=s.getMainDefinition(e.query);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),n,o);function c(e){var t={};return null!=e.cookie&&""!==e.cookie?t.Cookie=e.cookie:null!=e.token&&""!==e.token&&(t.Authorization="Bearer "+e.token),{headers:t}}var d,y,h=new t.ApolloLink((function(e,r){return new t.Observable((function(t){var n;return Promise.resolve(e).then((function(){n=r(e).subscribe({next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)})})).catch(t.error.bind(t)),function(){n&&n.unsubscribe()}}))})),g=new t.ApolloClient({link:t.ApolloLink.from([h,a]),cache:new t.InMemoryCache,defaultOptions:{watchQuery:{fetchPolicy:"no-cache",errorPolicy:"ignore"},query:{fetchPolicy:"no-cache",errorPolicy:"all"}}}),v={query:(y=p(Pe.mark((function e(t){return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.query({query:t.gql,context:f({batchKey:"batchKey"in t?t.batchKey:"default"},c({token:t.token,cookie:t.cookie}))});case 2:return e.abrupt("return",e.sent.data);case 5:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)}),subscribe:function(t){e.logging.gqlSubscriptions&&console.log("subscribing",ze(t.gql));var r=g.subscribe({query:t.gql}).subscribe({next:function(r){t.retryAttempts=0,e.logging.gqlSubscriptions&&console.log("subscription message",JSON.stringify(r,null,2)),r.data?t.onMessage(r):t.onError(new Error("Unexpected message structure.\n"+r))},error:function(e){null==t.retryAttempts||t.retryAttempts<3?(n&&n(),n=v.subscribe(f({},t,{retryAttempts:(t.retryAttempts||0)+1}))):(console.error("Failed to initialize subscription after 3 attempts"),console.error(ze(t.gql))),t.onError(e)}}),n=r.unsubscribe.bind(r);return function(){return n()}},mutate:(d=p(Pe.mark((function t(r){return Pe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.logging.gqlMutations&&console.log("mutations",r.mutations.map((function(e){var t;return null==(t=e.loc)?void 0:t.source.body}))),t.next=3,Promise.all(r.mutations.map((function(e){return g.mutate({mutation:e,context:f({batchedMutation:!0},c({token:r.token,cookie:r.cookie}))})})));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)}))),function(e){return d.apply(this,arguments)})};return v}require("isomorphic-fetch");var ht=function(){function e(e){var t;if(this.gqlClient=void 0,this.generateMockData=void 0,this.mockDataType=void 0,this.staticData=void 0,this.getMockDataDelay=void 0,this.enableQuerySlimming=void 0,this.paginationFilteringSortingInstance=void 0,this.plugins=void 0,this.query=void 0,this.subscribe=void 0,this.QueryManager=void 0,this.QuerySlimmer=void 0,this.tokens={},this.DOFactory=void 0,this.DOProxyGenerator=void 0,this.logging=void 0,this.optimisticUpdatesOrchestrator=void 0,this.gqlClient=e.gqlClient,this.generateMockData=e.generateMockData,this.getMockDataDelay=e.getMockDataDelay,this.enableQuerySlimming=e.enableQuerySlimming,this.logging=e.logging,this.paginationFilteringSortingInstance=e.paginationFilteringSortingInstance,this.plugins=e.plugins,this.mockDataType=e.mockDataType,this.staticData=e.staticData,this.query=(t=this,function(){var e=p(Pe.mark((function e(r,n){var o,a,i;return Pe.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e,t){return e.stack="\n"+(t||e.stack)+"\n"+o.substring(o.indexOf("\n")+1),e},o=(new Error).stack,a=(null==n?void 0:n.queryId)||o.split("\n")[1]||"query"+Re++,e.abrupt("return",new Promise((function(e,o){var u={};try{new t.QueryManager(r,{subscribe:!1,resultsObject:u,onResultsUpdated:function(){e({data:u,error:void 0}),(null==n?void 0:n.onData)&&n.onData({results:u})},onQueryError:function(t){var r=i(new Error("Error querying data"),t.stack);if(null!=n&&n.onError)return n.onError(r),void e({data:u,error:r});o(r)},onSubscriptionError:function(){throw new Error("Should neven happen, query method does not subscribe")},queryId:a,useServerSidePaginationFilteringSorting:t.paginationFilteringSortingInstance===exports.EPaginationFilteringSortingInstance.SERVER,batchKey:(null==n?void 0:n.batchKey)||null})}catch(t){var s=i(new Error("Error initializing query manager"),t.stack);if(null!=n&&n.onError)return n.onError(s),void e({data:u,error:s});o(s)}})));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),this.subscribe=function(e){return function(){var t=p(Pe.mark((function t(r,n){var o,a,i;return Pe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=function(e,t){return e.stack="\n"+(t||e.stack)+"\n"+o.substring(o.indexOf("\n")+1),e},o=(new Error).stack,a=(null==n?void 0:n.queryId)||o.split("\n")[1]||"query"+Re++,t.abrupt("return",new Promise((function(t,o){var u={},s={onQueryDefinitionsUpdated:function(e){throw Error("onQueryDefinitionsUpdated not initialized")}};try{var l=new e.QueryManager(r,{resultsObject:u,subscribe:!0,onResultsUpdated:function(){t({data:u,unsub:function(){return l.unsub()},onQueryDefinitionsUpdated:function(e){return s.onQueryDefinitionsUpdated(e)},error:void 0}),n.onData({results:u})},onQueryError:function(e){var r=i(new Error("Error querying data"),e.stack);if(n.onError)return n.onError(r),void t({data:u,unsub:function(){return l.unsub()},onQueryDefinitionsUpdated:function(e){return s.onQueryDefinitionsUpdated(e)},error:e});o(r)},onSubscriptionError:function(e){var r=i(new Error("Error subscribing to data"),e.stack);if(n.onError)return n.onError(r),void t({data:u,unsub:function(){return l.unsub()},onQueryDefinitionsUpdated:function(e){return s.onQueryDefinitionsUpdated(e)},error:e});o(r)},queryId:a,useServerSidePaginationFilteringSorting:e.paginationFilteringSortingInstance===exports.EPaginationFilteringSortingInstance.SERVER,batchKey:(null==n?void 0:n.batchKey)||null,onQueryStateChange:n.onQueryManagerQueryStateChange});s.onQueryDefinitionsUpdated=l.onQueryDefinitionsUpdated}catch(e){var c=i(new Error("Error initializing query manager"),e.stack);if(n.onError)return n.onError(c),void t({data:u,unsub:function(){throw i(new Error("unsub called when there was an error initializing query manager"),e.stack)},onQueryDefinitionsUpdated:function(){throw i(new Error("onQueryDefinitionsUpdated called when there was an error initializing query manager"),e.stack)},error:e});o(c)}})));case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}(this),this.DOProxyGenerator=function(e){return function(t){var r=t.relationalResults,n=t.node.computed,o=n?Object.keys(n).reduce((function(t,r){var o,i=function(){return n[r](a)};return null==(o=e.plugins)||o.forEach((function(e){var t;null!=(t=e.DOProxy)&&t.computedDecorator&&(i=e.DOProxy.computedDecorator({ProxyInstance:a,computedFn:i}))})),t[r]=i,t}),{}):{},a=new Proxy(t.do,{getOwnPropertyDescriptor:function(e,r){var a;if(t.allPropertiesQueried.some((function(e){return e.startsWith(r)}))||null!=(a=t.relationalResults)&&a.hasOwnProperty(r)||Object.keys(H).includes(r))return f({},Object.getOwnPropertyDescriptor(e,r),{enumerable:!0});if(n&&Object.keys(n).includes(r))try{return o[r](),f({},Object.getOwnPropertyDescriptor(e,r),{enumerable:!0})}catch(t){if(!(t instanceof T))throw t;return f({},Object.getOwnPropertyDescriptor(e,r),{enumerable:!1})}return f({},Object.getOwnPropertyDescriptor(e,r),{enumerable:!1})},get:function(e,n){if("updateRelationalResults"===n)return function(e){e&&(r&&Object.keys(r).forEach((function(e){Object.defineProperty(a,e,{enumerable:!1,get:function(){throw new T({propName:e,queryId:t.queryId,nodeType:t.node.type})}})})),Object.keys(e).forEach((function(e){Object.defineProperty(a,e,{enumerable:!0,configurable:!0})}))),r=f({},r,e)};if(r&&t.relationalQueries&&Object.keys(r).includes(n))return r[n];if(Object.keys(t.node.data).includes(n)){if(!t.allPropertiesQueried.some((function(e){return e.startsWith(n)})))throw new T({propName:n,queryId:t.queryId,nodeType:t.node.type});var i=t.node.data[n];return i.type===exports.DATA_TYPES.object||i.type===exports.DATA_TYPES.maybeObject?null==t.do[n]?t.do[n]:function e(t){var r={};return Object.keys(t.dataForThisObject).forEach((function(n){var o=t.parentObjectKey?t.parentObjectKey+"__dot__"+n:n,a=t.dataForThisObject[n],i=t.allPropertiesQueried.includes(o)||t.allPropertiesQueried.some((function(e){return e.startsWith(o)}));Object.defineProperty(r,n,{enumerable:i,get:function(){if(a.type===exports.DATA_TYPES.object||a.type===exports.DATA_TYPES.maybeObject)return null==t.allCachedData[n]?t.allCachedData[n]:e({nodeType:t.nodeType,queryId:t.queryId,allCachedData:t.allCachedData[n],dataForThisObject:a.boxedValue,allPropertiesQueried:t.allPropertiesQueried,parentObjectKey:o});if(!i)throw new T({propName:o,nodeType:t.nodeType,queryId:t.queryId});return t.allCachedData?t.allCachedData[n]:void 0}})})),r}({nodeType:t.node.type,queryId:t.queryId,allCachedData:t.do[n],dataForThisObject:i.boxedValue,allPropertiesQueried:t.allPropertiesQueried,parentObjectKey:n}):t.do[n]}if(o[n])try{return o[n]()}catch(e){if(e instanceof T)throw new w({computedPropName:n,propName:e.propName,nodeType:t.node.type,queryId:t.queryId});throw e}return e[n]}});return t.relationalResults&&Object.keys(t.relationalResults).forEach((function(e){Object.defineProperty(a,e,{enumerable:!0,configurable:!0})})),a}}(this),this.DOFactory=function(e){return function(t){return function(){function r(r){var n,o=this;this.parsedData=void 0,this.version=-1,this.id=void 0,this.lastUpdatedBy=void 0,this.persistedData={},this._defaults=void 0,this.type=t.type,this.getDefaultData=function(e){if(e instanceof U)return o.isObjectType(e.type)?o.getDefaultData(e.boxedValue):e.defaultValue;var t=function(t,r){var n=r||e[t]._default;if(n instanceof Error)throw n;return o.isArrayType(n.type)?o.isObjectType(n.boxedValue.type)?[o.getDefaultData(n.boxedValue.boxedValue)]:[n.boxedValue.defaultValue]:n.defaultValue};return"function"==typeof e?t(void 0,e._default):Object.keys(e).reduce((function(r,n){var a=e[n];if(o.isObjectType(a.type)||o.isRecordType(a.type))r[n]=o.getDefaultData(a.boxedValue);else if("function"==typeof a){var i=t(n);r[n]=i}else r[n]=e[n].defaultValue;return r}),{})},this.onDataReceived=function(e,r){if(null==e.version)throw Error("Message received for a node was missing a version");var n=Number(e.version);if(null!=r&&r.__unsafeIgnoreVersion||n>=o.version){o.version=n,o.lastUpdatedBy=e.lastUpdatedBy;var a=o.parseReceivedData({initialData:e,nodeProperties:t.properties});o.extendPersistedWithNewlyReceivedData({data:t.properties,object:o.persistedData,extension:a}),o.parsedData=o.getParsedData({data:t.properties,persistedData:o.persistedData,defaultData:o._defaults})}},this.setObjectProp=function(e){Object.defineProperty(o,e,{configurable:!0,enumerable:!0,get:function(){return o.parsedData[e]}})},this.setPrimitiveValueProp=function(e){Object.defineProperty(o,e,{configurable:!0,enumerable:!0,get:function(){return o.parsedData[e]}})},this.setArrayProp=function(e){Object.defineProperty(o,e,{configurable:!0,enumerable:!0,get:function(){return o.parsedData[e]}})},this._defaults=this.getDefaultData(t.properties),this.id=r.id,this.lastUpdatedBy=r.lastUpdatedBy,null!=r.version&&(this.version=Number(r.version)),r&&(this.persistedData=this.parseReceivedData({initialData:r,nodeProperties:t.properties})),this.parsedData=this.getParsedData({data:t.properties,persistedData:this.persistedData,defaultData:this._defaults}),null==(n=e.plugins)||n.forEach((function(e){var t;null!=(t=e.DO)&&t.onConstruct&&e.DO.onConstruct({DOInstance:o,parsedDataKey:"parsedData"})})),this.initializeNodePropGetters(),this.initializeNodeComputedGetters(),this.initializeNodeRelationalGetters()}var n=r.prototype;return n.parseReceivedData=function(e){var t=this,r=e.initialData;return Object.entries(e.nodeProperties).reduce((function(e,n){var o=n[0],a=t.getData(n[1]),i=o in r&&null!=r[o];return t.isObjectType(a.type)&&i?e[o]=t.parseReceivedData({initialData:r[o],nodeProperties:a.boxedValue}):t.isArrayType(a.type)&&i?e[o]=r[o].map(a.boxedValue.parser):o in r&&null===r[o]?e[o]=null:i&&(e[o]=a.parser(r[o])),e}),{})},n.getParsedData=function(e){var t=this;if(e.data instanceof U&&e.data.isOptional&&null==e.persistedData)return null;var r=this.getData(e.data);return r instanceof U&&r.boxedValue?this.isArrayType(r.type)?e.persistedData?(e.persistedData||[]).map((function(n){var o;return t.getParsedData({data:r.boxedValue,persistedData:n,defaultData:r.type===exports.DATA_TYPES.array&&(null==(o=e.defaultData)?void 0:o[0])||null})})):e.defaultData:(e.persistedData||(e.persistedData={}),this.getData(r.boxedValue)instanceof U?Object.keys(e.persistedData).reduce((function(n,o){return n[o]=t.getParsedData({data:r.boxedValue,persistedData:e.persistedData[o],defaultData:e.defaultData}),n}),{}):Object.keys(r.boxedValue).reduce((function(n,o){var a;return n[o]=t.getParsedData({data:r.boxedValue[o],persistedData:e.persistedData[o],defaultData:null==(a=e.defaultData)?void 0:a[o]}),n}),{})):r instanceof U?null!=e.persistedData?r.parser(e.persistedData):e.defaultData:Object.keys(r).reduce((function(n,o){return n[o]=t.getParsedData({data:r[o],persistedData:e.persistedData[o],defaultData:e.defaultData[o]}),n}),{})},n.extendPersistedWithNewlyReceivedData=function(e){var t=this;Object.entries(e.extension).forEach((function(r){var n=r[0],o=r[1],a=t.getData(e.data[n]);t.isRecordType(a.type)?e.object[n]=o:t.isObjectType(a.type)?null==o?e.object[n]=null:(e.object[n]=e.object[n]||{},t.extendPersistedWithNewlyReceivedData({data:a.boxedValue,object:e.object[n],extension:o})):e.object[n]=o}))},n.initializeNodePropGetters=function(){var e=this;Object.keys(t.properties).forEach((function(r){if(!Object.keys(H).includes(r)){var n=e.getData(t.properties[r]);e.isObjectType(n.type)?e.setObjectProp(r):e.isArrayType(n.type)?e.setArrayProp(r):e.setPrimitiveValueProp(r)}}))},n.initializeNodeComputedGetters=function(){var e=this,r=t.computed;r&&Object.keys(r).forEach((function(t){e.setComputedProp({propName:t,computedFn:r[t]})}))},n.initializeNodeRelationalGetters=function(){var e=this,r=t.relational;r&&Object.keys(r).forEach((function(t){e.setRelationalProp({relationshipName:t,relationalQueryGetter:r[t]})}))},n.setComputedProp=function(t){var r,n=this,o=function(){return t.computedFn(n)};null==(r=e.plugins)||r.forEach((function(e){var t;null!=(t=e.DO)&&t.computedDecorator&&(o=e.DO.computedDecorator({computedFn:o,DOInstance:n}))})),Object.defineProperty(this,t.propName,{get:function(){return o()},configurable:!0,enumerable:!0})},n.setRelationalProp=function(e){Object.defineProperty(this,e.relationshipName,{configurable:!0,get:function(){return e.relationalQueryGetter()}})},n.getData=function(e){return"function"==typeof e?e._default:e},n.isArrayType=function(e){return e===exports.DATA_TYPES.array||e===exports.DATA_TYPES.maybeArray},n.isObjectType=function(e){return e===exports.DATA_TYPES.object||e===exports.DATA_TYPES.maybeObject},n.isRecordType=function(e){return e===exports.DATA_TYPES.record||e===exports.DATA_TYPES.maybeRecord},r}()}}(this),this.QueryManager=function(e){return function(){function t(t,r){var o=this;this.state={},this.queryDefinitions=void 0,this.opts=void 0,this.queryRecord=null,this.queryIdx=0,this.subscriptionMessageHandlers={},this.unsubRecord={},this.onSubscriptionMessage=function(e){if(!o.queryRecord)throw Error("No query record initialized");Object.keys(e.data).forEach((function(t){var r=o.subscriptionMessageHandlers[t];if(!r)throw Error("No subscription message handler found for "+t);r(e),o.opts.resultsObject[t]=o.getResultsFromState({state:o.state,aliasPath:[]})[t]})),o.opts.onResultsUpdated()},this.logSubscriptionError=function(t){e.logging.gqlSubscriptionErrors&&console.error(t)},this.applyClientSideFilterAndSortToState=function(e){Object.keys(e.stateWhichMayRequireUpdate).forEach((function(t){var r=e.queryRecord[t];r&&o.applyClientSideFilterAndSortToStateEntry({stateEntryWhichMayRequireUpdate:e.stateWhichMayRequireUpdate[t],queryRecordEntry:r})}))},this.applyClientSideFilterAndSortToStateEntry=function(e){var t=e.stateEntryWhichMayRequireUpdate,r=e.queryRecordEntry,o=t.idsOrIdInCurrentResult;if(Array.isArray(o)){var a=function(e){var t=e.queryRecordEntry,r=e.data,n=Be({queryRecordEntry:t,skipRelationalFilters:!0}),o=Object.keys(n).map((function(e){var r=n[e],o=Object.keys(r).filter((function(e){return"condition"!==e})).map((function(e){return{operator:e,value:r[e]}})),a=e.replaceAll(".","__dot__");return{dotSeparatedPropName:e,underscoreSeparatedPropName:a,propNotInQuery:!t.properties.includes(a),operators:o,condition:r.condition}}));return o.length?r.filter((function(e){var t=o.find((function(e){return e.propNotInQuery}));if(t)throw new _({filterPropName:t.dotSeparatedPropName});var r=o.filter((function(e){return"and"===e.condition||"some"===e.condition})),n=r.every((function(t){var r=Ye({item:e,underscoreSeparatedPropName:t.underscoreSeparatedPropName});return t.operators.every((function(e){return je({operator:e.operator,filterValue:e.value,itemValue:r})}))}))||0===r.length;if(!n)return!1;var a=o.filter((function(e){return"or"===e.condition})),i=a.some((function(t){var r=Ye({item:e,underscoreSeparatedPropName:t.underscoreSeparatedPropName});return t.operators.some((function(e){return je({operator:e.operator,filterValue:e.value,itemValue:r})}))}))||0===a.length;return n&&i})).map((function(e){return e.id})):r.map((function(e){return e.id}))}({queryRecordEntry:r,data:o.map((function(e){return f({},t.proxyCache[e].proxy,{id:e})}))}),i=function(e){var t=e.queryRecordEntry,r=e.data;if(!t.sort)return r.map((function(e){return e.id}));var o=Ge({queryRecordEntry:t,skipRelationalSorts:!0}),a=n.orderBy(Object.keys(o).map((function(e,r){var n=e.replaceAll(".","__dot__");return{dotSeparatedPropName:e,underscoreSeparatedPropName:n,propNotInQuery:!1===t.properties.includes(n),priority:o[e].priority||1e4*(r+1),direction:o[e].direction||"asc"}})),(function(e){return e.priority}),"asc"),i=a.filter((function(e){return e.propNotInQuery}));if(i.length>0)throw new N({sortPropName:i[0].dotSeparatedPropName});return r.sort((function(e,t){return a.map((function(r){return Le(Me({node:e,direction:r.direction,underscoreSeparatedPropName:r.underscoreSeparatedPropName,isRelational:!1,oneToMany:!1,nonPaginatedOneToMany:!1}),Me({node:t,direction:r.direction,underscoreSeparatedPropName:r.underscoreSeparatedPropName,isRelational:!1,oneToMany:!1}),"asc"===r.direction)})).reduce((function(e,t){return e||t}),void 0)})).map((function(e){return e.id}))}({queryRecordEntry:r,data:a.map((function(e){return f({},t.proxyCache[e].proxy,{id:e})}))});t.idsOrIdInCurrentResult=i,t.totalCount=i.length}},this.onQueryDefinitionsUpdated=function(){var t=p(Pe.mark((function t(r){var n,a,i,u,s,l,c,d,y,h,g,v;return Pe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=function(){return n?nt({nextQueryRecord:a,previousQueryRecord:n}):{minimalQueryRecord:a}},n=o.queryRecord,a=te({queryDefinitions:r,queryId:o.opts.queryId}),o.queryRecord=a,i=Ze(r),u=et(r),Object.keys(i).length){t.next=13;break}if(!n){t.next=11;break}if(Object.keys(n).filter((function(e){return null==n[e]})).length!==Object.keys(u).length){t.next=11;break}return t.abrupt("return");case 11:return o.onQueryDefinitionUpdatedResult({queryResult:u,minimalQueryRecord:o.queryRecord}),t.abrupt("return");case 13:if(l=s(),c=l.minimalQueryRecord,d=l.aliasPathsToUpdate,Object.keys(c).length){t.next=16;break}return t.abrupt("return");case 16:return o.opts.subscribe&&(o.subscriptionMessageHandlers=o.getSubscriptionMessageHandlers({queryRecord:o.queryRecord}),y=pe({queryId:o.opts.queryId,queryRecord:o.queryRecord,useServerSidePaginationFilteringSorting:o.opts.useServerSidePaginationFilteringSorting}),Object.keys(c).forEach((function(t){if(!y[t])return o.logSubscriptionError("No subscription GQL document found for root level alias "+t);if(!o.subscriptionMessageHandlers[t])return o.logSubscriptionError("No subscription message handler found for root level alias "+t);var r,n=o.unsubRecord[t];o.unsubRecord[t]=(r={queryGQL:y[t],onError:function(e){o.logSubscriptionError(e)},onMessage:o.onSubscriptionMessage,mmGQLInstance:e}).mmGQLInstance.generateMockData?function(){}:r.mmGQLInstance.gqlClient.subscribe({gql:r.queryGQL,onMessage:r.onMessage,onError:r.onError}),n&&setTimeout((function(){n()}),5e3)}))),h=o.queryIdx++,null==o.opts.onQueryStateChange||o.opts.onQueryStateChange({queryIdx:h,queryState:exports.QueryState.LOADING}),g=Xe(c),t.prev=20,t.next=23,Promise.all(Object.entries(g).map(function(){var t=p(Pe.mark((function t(r){var n,a,i;return Pe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r[0],!(i=se({queryId:o.opts.queryId,queryRecord:a=r[1],useServerSidePaginationFilteringSorting:o.opts.useServerSidePaginationFilteringSorting}))){t.next=6;break}return t.next=5,tt({queryRecord:a,queryGQL:i,queryId:o.opts.queryId,batchKey:o.opts.batchKey,getMockDataDelay:e.getMockDataDelay||function(){return 0},tokenName:n,mmGQLInstance:e});case 5:return t.abrupt("return",t.sent);case 6:return t.abrupt("return",{});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 23:v=t.sent.reduce((function(e,t){return f({},e,t)}),f({},u)),o.onQueryDefinitionUpdatedResult({queryResult:v,minimalQueryRecord:c,aliasPathsToUpdate:d}),null==o.opts.onQueryStateChange||o.opts.onQueryStateChange({queryIdx:h,queryState:exports.QueryState.IDLE}),t.next=33;break;case 29:throw t.prev=29,t.t0=t.catch(20),null==o.opts.onQueryStateChange||o.opts.onQueryStateChange({queryIdx:h,queryState:exports.QueryState.ERROR,error:t.t0}),t.t0;case 33:case"end":return t.stop()}}),t,null,[[20,29]])})));return function(e){return t.apply(this,arguments)}}(),this.queryDefinitions=t,this.opts=r,this.onQueryDefinitionsUpdated(this.queryDefinitions).catch((function(e){o.opts.onQueryError(e)}))}var r=t.prototype;return r.getSubscriptionMessageHandlers=function(e){var t=this,r={};return Object.keys(e.queryRecord).forEach((function(n){var o=e.queryRecord[n];if(o){var a=t.getSubscriptionEventToCachePathRecords({aliasPath:[n],queryRecordEntry:o,parentQueryRecordEntry:null}),i=a.nodeUpdatePaths,u=a.nodeCreatePaths,s=a.nodeDeletePaths,l=a.nodeInsertPaths,c=a.nodeRemovePaths,d=a.nodeUpdateAssociationPaths;r[n]=function(r){var o,a,p=null==(o=r.data)||null==(a=o[n])?void 0:a.__typename;if(!p)return t.logSubscriptionError("Invalid subscription message\n"+JSON.stringify(r,null,2));var y=function(e){var t,r=!1,n=!1;if(e.startsWith("Updated_"))t="Updated",r=!0;else if(e.startsWith("Created_"))t="Created",r=!0;else if(e.startsWith("Deleted_"))t="Deleted",r=!0;else if(e.startsWith("Inserted_"))t="Inserted",n=!0;else if(e.startsWith("Removed_"))t="Removed",n=!0;else{if(!e.startsWith("UpdatedAssociation_"))throw new M(e);t="UpdatedAssociation",n=!0}if(r)return{type:t,nodeType:st(e.split("_")[1])};if(n)return f({type:t},function(e){var t=e.split("_");if(3!==t.length)throw Error('Invalid inserted subscription message "'+e+'"');return{parentNodeType:st(t[1]),childNodeType:st(t[2])}}(e));throw new M(e)}(p);if("Updated"===y.type){var h=y.nodeType;if(!i[h])return t.logSubscriptionError("No node update handler found for "+h);var g=r.data[n].value;if(!g)return t.logSubscriptionError("No node data found for "+p);var v=r.data[n].targets;i[h].forEach((function(e,r){var o=e.queryRecordEntry;if(!o)return t.logSubscriptionError("No queryRecordEntry found for "+e.aliasPath[0]);0===r&&o.def.repository.onDataReceived(g),t.getStateCacheEntriesForAliasPath({aliasPath:e.aliasPath,pathEndQueryRecordEntry:o,parentFilters:v||[]}).forEach((function(r){var o,a=r.parentStateEntry,i=r.idOfAffectedParent,u=r.relationalAlias,s=r.relationalStateEntry,l=s||a;e.queryRecordEntry.relational&&t.notifyRepositories({data:g,queryRecord:e.queryRecordEntry.relational,collectionsIncludePagingInfo:!1});var c,d=!0;if(l.proxyCache[g.id]?o=l:(d=!1,o=t.buildCacheEntry({nodeData:g,queryAlias:u||n,queryRecord:s?null==(c=e.parentQueryRecordEntry)?void 0:c.relational:t.queryRecord,aliasPath:e.aliasPath,pageInfoFromResults:null,totalCount:null,clientSidePageInfo:null,collectionsIncludePagingInfo:!1})),!o)return t.logSubscriptionError("No new cache entry found");if(l.proxyCache[g.id]=o.proxyCache[g.id],Array.isArray(l.idsOrIdInCurrentResult)&&!l.idsOrIdInCurrentResult.includes(g.id)&&l.idsOrIdInCurrentResult.push(g.id),t.applyClientSideFilterAndSortToStateEntry({stateEntryWhichMayRequireUpdate:l,queryRecordEntry:e.queryRecordEntry}),d){var p=e.queryRecordEntry.relational;if(p){var f=l.proxyCache[g.id].relationalState=t.getQueryManagerStateFromData({data:g,queryRecord:p,collectionsIncludePagingInfo:!1});t.applyClientSideFilterAndSortToState({stateWhichMayRequireUpdate:f,queryRecord:p}),l.proxyCache[g.id].proxy.updateRelationalResults(t.getResultsFromState({state:f,aliasPath:e.aliasPath}))}}if(null!=i&&u&&s){var y,h,v=null==(y=a.proxyCache[i])?void 0:y.proxy;v&&v.updateRelationalResults(t.getResultsFromState({state:(h={},h[u]=s,h),aliasPath:e.aliasPath}))}}))}))}else if("Created"===y.type){var b=y.nodeType;if(!u[b])return t.logSubscriptionError("No node create handler found for "+b);u[b].forEach((function(o,a){var i=t.state[o.aliasPath[0]];if(!i)return t.logSubscriptionError("No state entry found for "+o.aliasPath[0]);var u=r.data[n].value;if(!u)return t.logSubscriptionError("No node data found for "+p);var s=o.queryRecordEntry;if(!s)return t.logSubscriptionError("No queryRecordEntry found for "+o.aliasPath[0]);0===a&&s.def.repository.onDataReceived(u),o.queryRecordEntry.relational&&t.notifyRepositories({data:u,queryRecord:o.queryRecordEntry.relational,collectionsIncludePagingInfo:!1});var l=t.buildCacheEntry({aliasPath:o.aliasPath,nodeData:u,queryAlias:n,queryRecord:e.queryRecord,pageInfoFromResults:null,totalCount:null,clientSidePageInfo:null,collectionsIncludePagingInfo:!1});if(!l)return t.logSubscriptionError("No new cache entry found");if(!i.idsOrIdInCurrentResult)return t.logSubscriptionError("No idsOrIdInCurrentResult found on state entry");if(i.proxyCache[u.id]=l.proxyCache[u.id],le({queryRecordEntry:s})){if(!Array.isArray(i.idsOrIdInCurrentResult))return t.logSubscriptionError("idsOrIdInCurrentResult is not an array");i.idsOrIdInCurrentResult.push(u.id),null!=i.totalCount&&i.totalCount++,t.applyClientSideFilterAndSortToStateEntry({stateEntryWhichMayRequireUpdate:i,queryRecordEntry:o.queryRecordEntry})}else i.idsOrIdInCurrentResult=u.id}))}else if("Deleted"===y.type){var m=y.nodeType;if(!s[m])return t.logSubscriptionError("No node delete handler found for "+m);s[m].forEach((function(e){var o=t.state[e.aliasPath[0]];if(!o)return t.logSubscriptionError("No state entry found for "+e.aliasPath[0]);var a=r.data[n].id;if(null==a)return t.logSubscriptionError("Node deleted message did not include an id");if(!Array.isArray(o.idsOrIdInCurrentResult))return t.logSubscriptionError("idsOrIdInCurrentResult is not an array");var i=o.idsOrIdInCurrentResult.indexOf(a);-1!==i&&(o.idsOrIdInCurrentResult.splice(i,1),delete o.proxyCache[a],null!=o.totalCount&&o.totalCount--)}))}else if("Inserted"===y.type){var E,S,P=y.parentNodeType,R=y.childNodeType;if(!l[P+"."+R])return t.logSubscriptionError("No node insert handler found for "+P+"."+R);var x=null==(E=r.data[n].target)?void 0:E.id,q=null==(S=r.data[n].target)?void 0:S.property,I=q?lt(q):null;if(!x)return t.logSubscriptionError("No parentId found");if(!I||!q)return t.logSubscriptionError("No parentRelationshipWhichWasUpdated found");l[P+"."+R].forEach((function(e,o){var a=e.parentQueryRecordEntry;if(!a)return t.logSubscriptionError("No parentQueryRecord found for "+p);if(!a.relational)return t.logSubscriptionError("No parentQueryRecordEntry.relational found for "+p);var i=r.data[n].value;if(!i)return t.logSubscriptionError("No node inserted data found for "+p);0===o&&e.queryRecordEntry.def.repository.onDataReceived(i),e.queryRecordEntry.relational&&t.notifyRepositories({data:i,queryRecord:e.queryRecordEntry.relational,collectionsIncludePagingInfo:!1});var u=e.aliasPath[e.aliasPath.length-1],s=t.buildCacheEntry({nodeData:i,queryAlias:u,queryRecord:a.relational,aliasPath:e.aliasPath,pageInfoFromResults:null,totalCount:null,clientSidePageInfo:null,collectionsIncludePagingInfo:!1});if(!s)return t.logSubscriptionError("No new cache entry found");var l=t.getStateCacheEntriesForAliasPath({aliasPath:e.aliasPath,pathEndQueryRecordEntry:e.queryRecordEntry,parentFilters:[{id:x,property:q}]});if(!l||0===l.length)return t.logSubscriptionError("No parent cache entries found");l.forEach((function(r){var n,o=r.relationalStateEntry,a=r.parentStateEntry.proxyCache[x].proxy;return o?Array.isArray(o.idsOrIdInCurrentResult)?(o.idsOrIdInCurrentResult.includes(i.id)||(o.idsOrIdInCurrentResult.push(i.id),o.proxyCache[i.id]=s.proxyCache[i.id]),t.applyClientSideFilterAndSortToStateEntry({stateEntryWhichMayRequireUpdate:o,queryRecordEntry:e.queryRecordEntry}),a?void a.updateRelationalResults(t.getResultsFromState({state:(n={},n[u]=o,n),aliasPath:e.aliasPath})):t.logSubscriptionError("No parent proxy found")):t.logSubscriptionError("idsOrIdInCurrentResult is not an array"):t.logSubscriptionError("No state entry found")}))}))}else if("Removed"===y.type){var O,D,T=y.parentNodeType,w=y.childNodeType;if(!c[T+"."+w])return t.logSubscriptionError("No node remove handler found for "+T+"."+w);var _=null==(O=r.data[n].target)?void 0:O.id,N=null==(D=r.data[n].target)?void 0:D.property,C=N?lt(N):null;if(!_)return t.logSubscriptionError("No parentId found");if(!C||!N)return t.logSubscriptionError("No parentRelationshipWhichWasUpdated found");c[T+"."+w].forEach((function(e){var o=e.parentQueryRecordEntry;if(!o)return t.logSubscriptionError("No parentQueryRecord found for "+p);if(!o.relational)return t.logSubscriptionError("No parentQueryRecordEntry.relational found for "+p);var a=r.data[n].id,i=e.aliasPath[e.aliasPath.length-1],u=t.getStateCacheEntriesForAliasPath({aliasPath:e.aliasPath,pathEndQueryRecordEntry:e.queryRecordEntry,parentFilters:[{id:_,property:N}]});if(!u||0===u.length)return t.logSubscriptionError("No parent cache entries found");u.forEach((function(r){var n,o=r.relationalStateEntry,u=r.parentStateEntry.proxyCache[_].proxy;if(!o)return t.logSubscriptionError("No state entry found");if(!Array.isArray(o.idsOrIdInCurrentResult))return t.logSubscriptionError("idsOrIdInCurrentResult is not an array");var s=o.idsOrIdInCurrentResult.findIndex((function(e){return e===a}));return-1===s?t.logSubscriptionError("Could not find index of removed id "+a):(o.idsOrIdInCurrentResult.splice(s,1),delete o.proxyCache[a],null!=o.totalCount&&o.totalCount--,u?void u.updateRelationalResults(t.getResultsFromState({state:(n={},n[i]=o,n),aliasPath:e.aliasPath})):t.logSubscriptionError("No parent proxy found"))}))}))}else{if("UpdatedAssociation"!==y.type)throw new M(r.data[n].__typename);var k,A,Q=y.parentNodeType,j=y.childNodeType;if(!d[Q+"."+j])return t.logSubscriptionError("No node update association handler found for "+Q+"."+j);var F=null==(k=r.data[n].target)?void 0:k.id,L=null==(A=r.data[n].target)?void 0:A.property,U=L?lt(L):null;if(!F)return t.logSubscriptionError("No parentId found");if(!U||!L)return t.logSubscriptionError("No parentRelationshipWhichWasUpdated found");d[Q+"."+j].forEach((function(e,o){var a=e.parentQueryRecordEntry;if(!a)return t.logSubscriptionError("No parentQueryRecord found for "+p);if(!a.relational)return t.logSubscriptionError("No parentQueryRecordEntry.relational found for "+p);var i=r.data[n].value,u=e.aliasPath[e.aliasPath.length-1],s=void 0;if(i){0===o&&e.queryRecordEntry.def.repository.onDataReceived(i),e.queryRecordEntry.relational&&t.notifyRepositories({data:i,queryRecord:e.queryRecordEntry.relational,collectionsIncludePagingInfo:!1});var l=t.buildCacheEntry({nodeData:i,queryAlias:u,queryRecord:a.relational,aliasPath:e.aliasPath,pageInfoFromResults:null,totalCount:null,clientSidePageInfo:null,collectionsIncludePagingInfo:!1});if(!l)return t.logSubscriptionError("No new cache entry found");s=l}else null===i&&(s=null);if(void 0!==s){var c=t.getStateCacheEntriesForAliasPath({aliasPath:e.aliasPath,pathEndQueryRecordEntry:e.queryRecordEntry,parentFilters:[{id:F,property:L}]});if(!c||0===c.length)return t.logSubscriptionError("No parent cache entries found");c.forEach((function(r){var n,o=r.relationalStateEntry,a=r.parentStateEntry.proxyCache[F].proxy;return o?(o.idsOrIdInCurrentResult=i?i.id:null,i&&s&&(o.proxyCache[i.id]=s.proxyCache[i.id]),a?void a.updateRelationalResults(t.getResultsFromState({state:(n={},n[u]=o,n),aliasPath:e.aliasPath})):t.logSubscriptionError("No parent proxy found")):t.logSubscriptionError("No state entry found")}))}}))}}}})),r},r.getSubscriptionEventToCachePathRecords=function(e){var t=this,r=e.aliasPath,n=e.queryRecordEntry,o=e.parentQueryRecordEntry,a={};a[n.def.type]=[{aliasPath:r,queryRecordEntry:n,parentQueryRecordEntry:o}];var i={};i[n.def.type]=[{aliasPath:r,queryRecordEntry:n,parentQueryRecordEntry:o}];var u={};u[n.def.type]=[{aliasPath:r,queryRecordEntry:n,parentQueryRecordEntry:o}];var s={},l={},c={};o&&("oneToMany"in n&&n.oneToMany||"nonPaginatedOneToMany"in n&&n.nonPaginatedOneToMany)?(s[o.def.type+"."+n.def.type]=[{aliasPath:r,queryRecordEntry:n,parentQueryRecordEntry:o}],l[o.def.type+"."+n.def.type]=[{aliasPath:r,queryRecordEntry:n,parentQueryRecordEntry:o}]):o&&(c[o.def.type+"."+n.def.type]=[{aliasPath:r,queryRecordEntry:n,parentQueryRecordEntry:o}]);var d=n.relational,p={nodeUpdatePaths:a,nodeCreatePaths:i,nodeDeletePaths:u,nodeInsertPaths:s,nodeRemovePaths:l,nodeUpdateAssociationPaths:c};return d&&Object.keys(d).forEach((function(e){var o=t.getSubscriptionEventToCachePathRecords({aliasPath:[].concat(r,[e]),queryRecordEntry:d[e],parentQueryRecordEntry:n});Object.keys(o).forEach((function(e){var t=e,r=o[t];Object.keys(r).forEach((function(e){var n;p[t][e]?(n=p[t][e]).push.apply(n,r[e]):p[t][e]=r[e]}))}))})),p},r.getStateCacheEntriesForAliasPath=function(e){var t=this,r=e.aliasPath,n=e.pathEndQueryRecordEntry,o=e.parentFilters,a=e.previousStateEntries,i=r[0],u=r.slice(1);if(!a&&0===u.length)return[{parentStateEntry:this.state[i],idOfAffectedParent:null,relationalAlias:null,relationalStateEntry:null}];if(!o)throw Error("parentFilters must be provided for non root level events");if(!("_relationshipName"in n))throw Error("parentFilters provided but no relationship found in pathEndQueryRecordEntry");if(!o.some((function(e){return lt(e.property)===n._relationshipName})))return[];var s=function(){if(a)return a.reduce((function(e,t){var r=t.relationalStateEntry||t.parentStateEntry;if(!r)return e;var n=0===u.length;return Object.keys(r.proxyCache).forEach((function(t){var a;if(!n||o.find((function(e){return t===e.id}))){var u=null==(a=r.proxyCache[t].relationalState)?void 0:a[i];if(!u)throw Error('No relational state found for alias path "'+i+'"');e.push({parentStateEntry:r,idOfAffectedParent:t,relationalAlias:i,relationalStateEntry:u})}})),e}),[]);if(!t.state[i])throw Error('No state entry found for alias path "'+i);return[{parentStateEntry:t.state[i],idOfAffectedParent:null,relationalAlias:null,relationalStateEntry:null}]}();return 0===u.length?s:this.getStateCacheEntriesForAliasPath({aliasPath:u,previousStateEntries:s,pathEndQueryRecordEntry:n,parentFilters:o})},r.unsub=function(){var e=this;Object.keys(this.unsubRecord).forEach((function(t){e.unsubRecord[t]()}))},r.getResultsFromState=function(e){var t=this;return Object.keys(e.state).reduce((function(r,n){var o=e.state[n],a=o.idsOrIdInCurrentResult,i=o.pageInfoFromResults,u=o.totalCount,s=o.clientSidePageInfo,l=t.removeUnionSuffix(n);if(Array.isArray(a)){if(!s)throw Error("No client side page info found for the alias "+n);var c=a.map((function(e){return o.proxyCache[e].proxy})),d=[].concat(e.aliasPath||[],[l]);r[l]=i?new xe({items:c,clientSidePageInfo:s,pageInfoFromResults:i,totalCount:u,onPaginationRequestStateChanged:t.opts.onResultsUpdated,onLoadMoreResults:function(){return t.onLoadMoreResults({aliasPath:d,previousEndCursor:i.endCursor})},onGoToNextPage:function(){return t.onGoToNextPage({aliasPath:d,previousEndCursor:i.endCursor})},onGoToPreviousPage:function(){return t.onGoToPreviousPage({aliasPath:d,previousStartCursor:i.startCursor})},useServerSidePaginationFilteringSorting:t.opts.useServerSidePaginationFilteringSorting}):c}else r[l]=null!=a?o.proxyCache[a].proxy:null;return r}),{})},r.notifyRepositories=function(e){var t=this;Object.keys(e.queryRecord).forEach((function(r){var n=e.queryRecord[r];if(n){var o=de({queryRecordEntry:n,queryResponsePartial:e.data[r],collectionsIncludePagingInfo:e.collectionsIncludePagingInfo});if(null!=o){var a=n.def.repository;Array.isArray(o)?o.forEach((function(e){return a.onDataReceived(e)})):a.onDataReceived(o);var i=n.relational;i&&Object.keys(i).forEach((function(r){var n=Array.isArray(o)?o.flatMap((function(e){return e[r]})):o[r];Array.isArray(n)||(n=[n]),n.forEach((function(n){var o,a,u=i[r];r.includes("__rU__")&&n&&n.type!==u.def.type||t.notifyRepositories({data:(o={},o[r]=n,o),queryRecord:(a={},a[r]=u,a),collectionsIncludePagingInfo:e.collectionsIncludePagingInfo})}))}))}}}))},r.getQueryManagerStateFromData=function(e){var t=this;return Object.keys(e.queryRecord).reduce((function(r,n){var o=e.queryRecord[n];if(null==e.data[n]||!o)return r[n]={idsOrIdInCurrentResult:null,proxyCache:{},pageInfoFromResults:null,totalCount:null,clientSidePageInfo:null},r;var a=t.buildCacheEntry({nodeData:de({queryResponsePartial:e.data[n],queryRecordEntry:e.queryRecord[n],collectionsIncludePagingInfo:e.collectionsIncludePagingInfo}),pageInfoFromResults:t.getPageInfoFromResponse({dataForThisAlias:e.data[n],queryRecordEntry:o,collectionsIncludePagingInfo:e.collectionsIncludePagingInfo}),totalCount:t.getTotalCountFromResponse({dataForThisAlias:e.data[n]}),clientSidePageInfo:t.getInitialClientSidePageInfo({queryRecordEntry:e.queryRecord[n]}),queryRecord:e.queryRecord,queryAlias:n,aliasPath:[n],collectionsIncludePagingInfo:e.collectionsIncludePagingInfo});return a?(r[n]=a,r):r}),{})},r.buildCacheEntry=function(t){var r=this,n=t.nodeData,o=t.collectionsIncludePagingInfo,a=t.queryRecord[t.queryAlias];if(!a||!n)return{idsOrIdInCurrentResult:null,proxyCache:{},pageInfoFromResults:null,totalCount:null,clientSidePageInfo:null};var i=a.relational;if(t.queryAlias.includes("__rU__")){var u=t.nodeData[0];if(u&&u.type!==a.def.type)return null}var s,l=function(n){var u=function(e){return i?Object.keys(i).reduce((function(n,a){var u,s,l=i[a],c=de({queryResponsePartial:e[a],queryRecordEntry:l,collectionsIncludePagingInfo:o});if(!c)return n[a]={idsOrIdInCurrentResult:null,proxyCache:{},pageInfoFromResults:null,totalCount:null,clientSidePageInfo:null},n;var d=r.addIdToLastEntryInAliasPath({aliasPath:t.aliasPath,id:e.id}),p=o?r.getPageInfoFromResponse({dataForThisAlias:e[a],queryRecordEntry:l,collectionsIncludePagingInfo:o}):{hasNextPage:!1,hasPreviousPage:!1,startCursor:"mock-start-cursor-should-not-be-used",endCursor:"mock-end-cursor-should-not-be-used",totalPages:Math.ceil(c.length/((null==(u=i[a].pagination)?void 0:u.itemsPerPage)||2e3))},y=o?r.getTotalCountFromResponse({dataForThisAlias:e[a]}):c.length,h=r.buildCacheEntry({nodeData:c,pageInfoFromResults:p,totalCount:y,clientSidePageInfo:r.getInitialClientSidePageInfo({queryRecordEntry:i[a]}),queryAlias:a,queryRecord:i,aliasPath:[].concat(d,[a]),collectionsIncludePagingInfo:o});return h?f({},n,((s={})[r.removeUnionSuffix(a)]=h,s)):n}),{}):null}(n.node),s=a.def.repository,l=i?r.getApplicableRelationalQueries({relationalQueries:i,nodeData:n.node}):null,c=r.addIdToLastEntryInAliasPath({aliasPath:t.aliasPath,id:n.node.id});return{proxy:e.DOProxyGenerator({node:a.def,allPropertiesQueried:a.properties,relationalQueries:l,queryId:r.opts.queryId,relationalResults:u?r.getResultsFromState({state:u,aliasPath:c}):null,do:s.byId(n.node.id)}),relationalState:u}};if(Array.isArray(t.nodeData)){if("id"in a){if(null==t.nodeData[0]){if(!a.allowNullResult)throw new F({receivedData:t.nodeData,message:'Queried a node by id for the query with the id "'+this.opts.queryId+'" but received back an empty array'});return{idsOrIdInCurrentResult:null,proxyCache:{},pageInfoFromResults:null,totalCount:null,clientSidePageInfo:null}}return{idsOrIdInCurrentResult:t.nodeData[0].id,proxyCache:t.nodeData.reduce((function(e,t){return e[t.id]=l({node:t}),e}),{}),pageInfoFromResults:t.pageInfoFromResults,totalCount:t.totalCount,clientSidePageInfo:t.clientSidePageInfo}}return"ids"in a?{idsOrIdInCurrentResult:a.ids,proxyCache:t.nodeData.reduce((function(e,t){return e[t.id]=l({node:t}),e}),{}),pageInfoFromResults:t.pageInfoFromResults,totalCount:t.totalCount,clientSidePageInfo:t.clientSidePageInfo}:{idsOrIdInCurrentResult:t.nodeData.map((function(e){return e.id})),proxyCache:t.nodeData.reduce((function(e,t){return e[t.id]=l({node:t}),e}),{}),pageInfoFromResults:t.pageInfoFromResults,totalCount:t.totalCount,clientSidePageInfo:t.clientSidePageInfo}}return{idsOrIdInCurrentResult:t.nodeData.id,proxyCache:(s={},s[n.id]=l({node:n}),s),pageInfoFromResults:t.pageInfoFromResults,totalCount:t.totalCount,clientSidePageInfo:t.clientSidePageInfo}},r.removeUnionSuffix=function(e){return e.includes("__rU__")?e.split("__rU__")[0]:e},r.getApplicableRelationalQueries=function(e){var t=this;return Object.keys(e.relationalQueries).reduce((function(r,n){var o,a;if(!n.includes("__rU__"))return f({},r,((o={})[n]=e.relationalQueries[n],o));var i=e.nodeData[n]?e.nodeData[n][0]:null;return i&&i.type!==e.relationalQueries[n].def.type?r:f({},r,((a={})[t.removeUnionSuffix(n)]=e.relationalQueries[n],a))}),{})},r.getPageInfoFromResponse=function(e){var t,r;return!e.collectionsIncludePagingInfo&&le({queryRecordEntry:e.queryRecordEntry})?{totalPages:Math.ceil(e.dataForThisAlias.length/((null==(r=e.queryRecordEntry.pagination)?void 0:r.itemsPerPage)||2e3)),hasNextPage:!1,hasPreviousPage:!1,startCursor:"mock-cursor-should-not-be-used",endCursor:"mock-cursor-should-not-be-used"}:(null==(t=e.dataForThisAlias)?void 0:t.pageInfo)||null},r.getTotalCountFromResponse=function(e){var t;return null==(t=e.dataForThisAlias)?void 0:t.totalCount},r.getInitialClientSidePageInfo=function(e){var t;return e.queryRecordEntry&&le({queryRecordEntry:e.queryRecordEntry})?{lastQueriedPage:1,pageSize:(null==(t=e.queryRecordEntry.pagination)?void 0:t.itemsPerPage)||2e3}:null},r.onLoadMoreResults=function(){var t=p(Pe.mark((function t(r){var n,o,a;return Pe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.queryRecord){t.next=2;break}throw Error("No query record initialized");case 2:if(this.opts.useServerSidePaginationFilteringSorting){t.next=6;break}return t.next=5,new Promise((function(t){return setTimeout(t,(null==e.getMockDataDelay?void 0:e.getMockDataDelay())||0)}));case 5:return t.abrupt("return");case 6:if(n=this.getMinimalQueryRecordForMoreResults({preExistingQueryRecord:this.queryRecord,previousEndCursor:r.previousEndCursor,aliasPath:r.aliasPath}),o=this.getTokenNameForAliasPath(r.aliasPath),a=se({queryId:this.opts.queryId,queryRecord:n,useServerSidePaginationFilteringSorting:this.opts.useServerSidePaginationFilteringSorting})){t.next=11;break}throw Error("Expected queryGQL to be defined");case 11:return t.next=13,tt({queryRecord:n,queryGQL:a,tokenName:o,batchKey:this.opts.batchKey||null,mmGQLInstance:e,queryId:this.opts.queryId,getMockDataDelay:e.getMockDataDelay||function(){return 0}});case 13:this.handlePagingEventData({aliasPath:r.aliasPath,queryRecord:n,newData:t.sent,event:"LOAD_MORE"});case 15:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.onGoToNextPage=function(){var t=p(Pe.mark((function t(r){var n,o,a;return Pe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.queryRecord){t.next=2;break}throw Error("No query record initialized");case 2:if(this.opts.useServerSidePaginationFilteringSorting){t.next=6;break}return t.next=5,new Promise((function(t){return setTimeout(t,(null==e.getMockDataDelay?void 0:e.getMockDataDelay())||0)}));case 5:return t.abrupt("return");case 6:if(n=this.getMinimalQueryRecordForMoreResults({preExistingQueryRecord:this.queryRecord,previousEndCursor:r.previousEndCursor,aliasPath:r.aliasPath}),o=this.getTokenNameForAliasPath(r.aliasPath),a=se({queryId:this.opts.queryId,queryRecord:n,useServerSidePaginationFilteringSorting:this.opts.useServerSidePaginationFilteringSorting})){t.next=11;break}throw Error("Expected queryGQL to be defined");case 11:return t.next=13,tt({queryRecord:n,queryGQL:a,tokenName:o,batchKey:this.opts.batchKey||null,mmGQLInstance:e,queryId:this.opts.queryId,getMockDataDelay:e.getMockDataDelay||function(){return 0}});case 13:this.handlePagingEventData({aliasPath:r.aliasPath,queryRecord:n,newData:t.sent,event:"GO_TO_NEXT"});case 15:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.onGoToPreviousPage=function(){var t=p(Pe.mark((function t(r){var n,o,a;return Pe.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.queryRecord){t.next=2;break}throw Error("No query record initialized");case 2:if(this.opts.useServerSidePaginationFilteringSorting){t.next=6;break}return t.next=5,new Promise((function(t){return setTimeout(t,(null==e.getMockDataDelay?void 0:e.getMockDataDelay())||0)}));case 5:return t.abrupt("return");case 6:if(n=this.getMinimalQueryRecordForPreviousPage({preExistingQueryRecord:this.queryRecord,previousStartCursor:r.previousStartCursor,aliasPath:r.aliasPath}),o=this.getTokenNameForAliasPath(r.aliasPath),a=se({queryId:this.opts.queryId,queryRecord:n,useServerSidePaginationFilteringSorting:this.opts.useServerSidePaginationFilteringSorting})){t.next=11;break}throw Error("Expected queryGQL to be defined");case 11:return t.next=13,tt({queryRecord:n,queryGQL:a,tokenName:o,batchKey:this.opts.batchKey||null,mmGQLInstance:e,queryId:this.opts.queryId,getMockDataDelay:e.getMockDataDelay||function(){return 0}});case 13:this.handlePagingEventData({aliasPath:r.aliasPath,queryRecord:n,newData:t.sent,event:"GO_TO_PREVIOUS"});case 15:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.getTokenNameForAliasPath=function(e){var t;if(!this.queryRecord)throw Error("No query record initialized");if(0===e.length)throw new Error("Alias path must contain at least 1 entry");var r=this.removeIdFromAlias(e[0]);if(!this.queryRecord[r])throw Error("The key "+r+" was not found in the queryRecord\n"+JSON.stringify(this.queryRecord,null,2));return(null==(t=this.queryRecord[r])?void 0:t.tokenName)||"default"},r.getMinimalQueryRecordWithUpdatedPaginationParams=function(e){var t=e.aliasPath,r=t[0],n=t.slice(1),o={},a=this.removeIdFromAlias(r),i=e.preExistingQueryRecord[a];if(!i)throw new Error("No preexisting query record entry for the alias "+a);return o[a]=f({},i,n.length?{relational:this.getMinimalQueryRecordWithUpdatedPaginationParams({aliasPath:n,preExistingQueryRecord:i.relational,newPaginationParams:e.newPaginationParams})}:{pagination:f({},i.pagination,e.newPaginationParams)}),o},r.getMinimalQueryRecordForMoreResults=function(e){return this.getMinimalQueryRecordWithUpdatedPaginationParams({aliasPath:e.aliasPath,preExistingQueryRecord:e.preExistingQueryRecord,newPaginationParams:{startCursor:e.previousEndCursor,endCursor:void 0}})},r.getMinimalQueryRecordForPreviousPage=function(e){return this.getMinimalQueryRecordWithUpdatedPaginationParams({aliasPath:e.aliasPath,preExistingQueryRecord:e.preExistingQueryRecord,newPaginationParams:{endCursor:e.previousStartCursor,startCursor:void 0}})},r.handlePagingEventData=function(e){this.notifyRepositories({data:e.newData,queryRecord:e.queryRecord,collectionsIncludePagingInfo:!0});var t=this.getQueryManagerStateFromData({data:e.newData,queryRecord:e.queryRecord,collectionsIncludePagingInfo:!0});this.extendStateObject({aliasPath:e.aliasPath,originalAliasPath:e.aliasPath,state:this.state,newState:t,mergeStrategy:"LOAD_MORE"===e.event?"CONCAT":"REPLACE"}),me({object:this.opts.resultsObject,extension:this.getResultsFromState({state:this.state}),extendNestedObjects:!1,deleteKeysNotInExtension:!1}),this.opts.onResultsUpdated()},r.onQueryDefinitionUpdatedResult=function(e){var t=this;this.notifyRepositories({data:e.queryResult,queryRecord:e.minimalQueryRecord,collectionsIncludePagingInfo:!0});var r=this.getQueryManagerStateFromData({data:e.queryResult,queryRecord:e.minimalQueryRecord,collectionsIncludePagingInfo:!0});e.aliasPathsToUpdate?e.aliasPathsToUpdate.forEach((function(e){t.extendStateObject({aliasPath:e,originalAliasPath:e,state:t.state,newState:r,mergeStrategy:"REPLACE"})})):Object.keys(r).forEach((function(e){t.extendStateObject({aliasPath:[e],originalAliasPath:[e],state:t.state,newState:r,mergeStrategy:"REPLACE"})})),me({object:this.opts.resultsObject,extension:this.getResultsFromState({state:this.state,aliasPath:[]}),extendNestedObjects:!1,deleteKeysNotInExtension:!1}),this.opts.onResultsUpdated()},r.extendStateObject=function(e){var t=e.aliasPath,r=t[0],n=t.slice(1),o=this.removeIdFromAlias(r),a=e.state[o],i=e.newState[o];if(!a&&i&&(e.state[o]=i),0===n.length){var u,s;if(a)if(a.pageInfoFromResults=i.pageInfoFromResults,a.clientSidePageInfo=i.clientSidePageInfo,a.proxyCache=f({},a.proxyCache,i.proxyCache),"CONCAT"===e.mergeStrategy){if(!Array.isArray(a.idsOrIdInCurrentResult)||!Array.isArray(i.idsOrIdInCurrentResult))throw Error('Expected both existing and new state "idsOrIdInCurrentResult" to be arrays');a.idsOrIdInCurrentResult=[].concat(a.idsOrIdInCurrentResult,i.idsOrIdInCurrentResult)}else{if("REPLACE"!==e.mergeStrategy)throw new M(e.mergeStrategy);a.idsOrIdInCurrentResult=i.idsOrIdInCurrentResult}null==(u=e.parentProxy)||u.updateRelationalResults(this.getResultsFromState({state:(s={},s[o]=e.state[o],s),aliasPath:e.originalAliasPath}))}else{var l=this.getIdFromAlias(r);if(!l)throw Error("Expected an id for the alias "+r);var c=a.proxyCache[l];if(!c)return;var d=c.relationalState;if(!d)throw Error("Expected existing relational state for the alias "+r+" and the id "+l);var p=i.proxyCache[l].relationalState;if(!p)throw Error("Expected new relational state for the alias "+r+" and the id "+l);this.extendStateObject({aliasPath:n,originalAliasPath:e.originalAliasPath,state:d,newState:p,mergeStrategy:e.mergeStrategy,parentProxy:a.proxyCache[l].proxy})}},r.addIdToLastEntryInAliasPath=function(e){var t=[].concat(e.aliasPath);return t[t.length-1]=ut({aliasPathEntry:t[t.length-1],id:e.id}),t},r.removeIdFromAlias=function(e){return e.replace(/\[.*\]$/,"")},r.getIdFromAlias=function(e){var t=e.match(/\[(.*)\]$/);if(t)return t[1]},t}()}(this),this.QuerySlimmer=new ct(this),this.optimisticUpdatesOrchestrator=new Se,e.generateMockData&&e.paginationFilteringSortingInstance===exports.EPaginationFilteringSortingInstance.SERVER)throw Error('mmGQL was told to generate mock data and use "SERVER" pagination/filtering/sorting. Switch paginationFilteringSortingInstance to "CLIENT"')}var t=e.prototype;return t.def=function(e){if(e.type.includes("-")||e.type.includes("."))throw new Error("Node types cannot include hyphens or dots");var t=Object.keys(e.properties).find((function(e){return Object.keys(J).includes(e)}));if(t)throw new C({propName:t});var r,n=this.addDefaultNodeProperties(e.properties),o=f({},e,{properties:n}),a=this.DOFactory(o);return{_isNodeDef:!0,do:a,repository:(r={def:o,DOClass:a,onDOConstructed:this.optimisticUpdatesOrchestrator.onDOConstructed,onDODeleted:this.optimisticUpdatesOrchestrator.onDODeleted,onDataReceived:this.optimisticUpdatesOrchestrator.onPersistedDataReceived},new(function(){function e(){this.cached={}}var t=e.prototype;return t.onDataReceived=function(e){if(r.def.type!==e.type)throw Error("Attempted to query a node with an id belonging to a different type - Expected: "+r.def.type+" Received: "+e.type);var t=this.cached[e.id],n=this.parseDataFromBackend(e);if(!t){var o=new r.DOClass(n);this.cached[e.id]=o,r.onDOConstructed&&r.onDOConstructed(o)}r.onDataReceived({data:n,applyUpdateToDO:function(){t&&t.onDataReceived(n)}})},t.byId=function(e){var t=this.cached[e];if(!t)throw new k({nodeType:r.def.type,id:e});return t},t.onNodeDeleted=function(e){this.cached[e]&&(r.onDODeleted&&r.onDODeleted(this.cached[e]),delete this.cached[e])},t.parseDataFromBackend=function(e){return Object.keys(e).reduce((function(t,n){var o;return Object.keys(H).includes(n)?f({},t,((o={})[n]=e[n],o)):Object.keys(r.def.properties).includes(n)?(t[n]=e[n],t):t}),{})},e}())),type:e.type,data:n,computed:e.computed,relational:e.relational,generateMockData:e.generateMockData}},t.defTyped=function(e){return this.def(e)},t.getToken=function(e){return this.tokens[e.tokenName]},t.setToken=function(e){this.tokens[e.tokenName]=e.token},t.clearTokens=function(){this.tokens={}},t.addDefaultNodeProperties=function(e){return f({},e,J)},e}();Object.defineProperty(exports,"gql",{enumerable:!0,get:function(){return c.gql}}),exports.DEFAULT_NODE_PROPERTIES=J,exports.DEFAULT_PAGE_SIZE=2e3,exports.DEFAULT_TOKEN_NAME="default",exports.Data=U,exports.LoggingContext=pt,exports.MMGQL=ht,exports.MMGQLContext=dt,exports.MMGQLProvider=function(e){if(a.useContext(dt))throw Error("Another instance of an MMGQLProvider was already detected higher up the render tree.\nHaving multiple instances of MMGQLProviders is not supported and may lead to unexpected results.");var t=a.useRef({}),r=a.useRef({}),n=a.useRef({}),o=a.useCallback((function(e,r){t.current[e]=f({},t.current[e],r)}),[]),i=a.useCallback((function(n){function o(){var e=t.current[n];e&&(e.unsub&&e.unsub(),delete t.current[n])}null!=e.subscriptionTTLMs?r.current[n]=setTimeout(o,e.subscriptionTTLMs):o()}),[e.subscriptionTTLMs]),u=a.useCallback((function(e){clearTimeout(r.current[e]),delete r.current[e]}),[]),s=a.useCallback((function(e,t){if(n.current[e]&&!t.silenceDuplicateSubIdErrors)throw Error(["A useSubscription hook was already mounted using the following subscription id:",e,"To fix this error, please specify a unique subscriptionId in the second argument of useSubscription","useSubscription(queryDefinitions, { subscriptionId })"].join("\n"));n.current[e]=!0}),[]),l=a.useCallback((function(e){delete n.current[e]}),[]);return a.createElement(dt.Provider,{value:{mmGQLInstance:e.mmGQL,ongoingSubscriptionRecord:t.current,updateSubscriptionInfo:o,scheduleCleanup:i,cancelCleanup:u,onHookMount:s,onHookUnmount:l}},e.children)},exports.NODES_PROPERTY_KEY="nodes",exports.NodesCollection=xe,exports.PAGE_INFO_PROPERTY_KEY="pageInfo",exports.PROPERTIES_QUERIED_FOR_ALL_NODES=H,exports.RELATIONAL_UNION_QUERY_SEPARATOR="__rU__",exports.TOTAL_COUNT_PROPERTY_KEY="totalCount",exports.UnsafeNoDuplicateSubIdErrorProvider=function(e){return a.createElement(pt.Provider,{value:{unsafe__silenceDuplicateSubIdErrors:!0}},e.children)},exports.array=function(e){var t="function"==typeof e?e._default:e;function r(e){return new U({type:exports.DATA_TYPES.array,parser:function(e){return e},boxedValue:t,defaultValue:e,isOptional:!1})}return r.optional=new U({type:exports.DATA_TYPES.maybeArray,parser:function(e){return e},boxedValue:t,isOptional:!0}),r._default=r([]),r},exports.boolean=K,exports.chance=Ie,exports.chunkArray=qe,exports.generateRandomBoolean=De,exports.generateRandomId=we,exports.generateRandomNumber=Te,exports.generateRandomString=Oe,exports.getDefaultConfig=function(){var e={querySlimming:!1,gqlQueries:!1,gqlMutations:!1,gqlSubscriptions:!1,gqlSubscriptionErrors:!1};return{gqlClient:yt({httpUrl:"https://dev.bloomgrowth.com/graphql",wsUrl:"wss://dev.bloomgrowth.com/graphql",logging:e,getCookie:function(){return""}}),generateMockData:!1,mockDataType:"random",staticData:void 0,enableQuerySlimming:!1,paginationFilteringSortingInstance:exports.EPaginationFilteringSortingInstance.SERVER,logging:e}},exports.getGQLCLient=yt,exports.getResponseFromStaticData=He,exports.nonPaginatedOneToMany=function(e){return function(t){return{def:e,_relationshipName:t._relationshipName,_relational:exports.RELATIONAL_TYPES.nonPaginatedOneToMany,filter:t.filter,queryBuilderOpts:t}}},exports.number=G,exports.object=W,exports.oneToMany=function(e){return function(t){return{def:e,_relationshipName:t._relationshipName,_relational:exports.RELATIONAL_TYPES.oneToMany,filter:t.filter,queryBuilderOpts:t}}},exports.oneToOne=function(e){return function(t){return{def:e,_relationshipName:t._relationshipName,_relational:exports.RELATIONAL_TYPES.oneToOne,queryBuilderOpts:t}}},exports.queryDefinition=function(e){return e},exports.record=z,exports.staticRelational=function(e){var t;return(t={})[$e]=e,t},exports.string=V,exports.stringEnum=B,exports.stringOrNumber=Y,exports.useSubscription=function e(t,r){var n=a.useContext(dt);if(!n)throw Error("You must wrap your app with an MMGQLProvider before using useSubscription.");var o={stack:""};if(Error.captureStackTrace(o,e),""===o.stack)throw Error("Error.captureStackTrace not supported");var i=(null==r?void 0:r.subscriptionId)||o.stack.split("\n")[1],u=function(e){var t=e.context.ongoingSubscriptionRecord[e.subscriptionId];return{data:(null==t?void 0:t.data)||Object.keys(e.queryDefinitions).reduce((function(e,t){return e[t]=null,e}),{}),error:null==t?void 0:t.error,querying:null==(null==t?void 0:t.querying)||t.querying}}({subscriptionId:i,context:n,queryDefinitions:t}),s=a.useState(0)[1],l=a.useContext(pt),c=null,d=null;try{c=function(e){var t=e.subscriptionId;e.context.ongoingSubscriptionRecord[t]||(e.context.ongoingSubscriptionRecord[t]={}),e.context.updateSubscriptionInfo(t,{onQueryStateChange:e.onQueryStateChange});var r,n=function(e){var t;return Object.entries(e).reduce((function(e,t){var r,n=t[1];return e[n&&"useSubOpts"in n&&null!=(null==(r=n.useSubOpts)?void 0:r.doNotSuspend)&&n.useSubOpts.doNotSuspend?ft.suspendDisabled:ft.suspendEnabled][t[0]]=n,e}),((t={})[ft.suspendEnabled]={},t[ft.suspendDisabled]={},t))}(e.queryDefinitions),o=n.suspendDisabled,a=n.suspendEnabled,i=Object.values(ft).map((function(e){return t+e}));function u(){return i.map((function(t){return e.context.ongoingSubscriptionRecord[t]}))}function s(t){var r,n=t.queryDefinitions,o=t.parentSubscriptionId,a=t.suspend,i=o+t.subscriptionSuffix,s=e.context.ongoingSubscriptionRecord[i],l=null;if(s){if(!s.onQueryDefinitionsUpdated)throw Error("onQueryDefinitionsUpdated is not defined");return s.onQueryDefinitionsUpdated(n),s.suspendPromise}function c(t){var r;e.context.updateSubscriptionInfo(o,{error:t}),null==(r=e.context.ongoingSubscriptionRecord[o])||null==r.onQueryStateChange||r.onQueryStateChange()}e.context.ongoingSubscriptionRecord[i]={onQueryDefinitionsUpdated:function(e){l=e}},e.context.updateSubscriptionInfo(i,{querying:!0}),e.context.updateSubscriptionInfo(o,{querying:!0}),null==(r=e.context.ongoingSubscriptionRecord[o])||null==r.onQueryStateChange||r.onQueryStateChange();var d=e.context.mmGQLInstance.subscribe(n,{queryId:i,onQueryManagerQueryStateChange:function(t){var r,n=null==(r=e.context.ongoingSubscriptionRecord[o])?void 0:r.lastQueryIdx;if(t.queryState===exports.QueryState.LOADING){var a;if(0===t.queryIdx)return;e.context.updateSubscriptionInfo(i,{querying:!0}),e.context.updateSubscriptionInfo(o,{querying:!0,lastQueryIdx:t.queryIdx}),null==(a=e.context.ongoingSubscriptionRecord[o])||null==a.onQueryStateChange||a.onQueryStateChange()}else if(t.queryState===exports.QueryState.IDLE){var u;t.queryIdx===n&&(e.context.updateSubscriptionInfo(o,{querying:!1}),null==(u=e.context.ongoingSubscriptionRecord[o])||null==u.onQueryStateChange||u.onQueryStateChange())}else{if(t.queryState!==exports.QueryState.ERROR)throw new M(t.queryState);c(t.error)}},batchKey:a?"suspended":"non-suspended",onData:function(t){var r=e.context.ongoingSubscriptionRecord[o];e.context.updateSubscriptionInfo(o,{data:f({},r.data,t.results)}),null==r.onQueryStateChange||r.onQueryStateChange()},onError:c,onSubscriptionInitialized:function(t){e.context.updateSubscriptionInfo(i,{unsub:function(){return t()}}),e.context.updateSubscriptionInfo(o,{unsub:function(){u().forEach((function(e){return(null==e?void 0:e.unsub)&&e.unsub()}))}})}}).then((function(t){return l&&t.onQueryDefinitionsUpdated(l).catch(c),e.context.updateSubscriptionInfo(i,{onQueryDefinitionsUpdated:function(e){t.onQueryDefinitionsUpdated(e).catch(c)}}),t})).finally((function(){var t;e.context.updateSubscriptionInfo(i,{suspendPromise:void 0,querying:!1}),u().some((function(e){return e&&e.querying}))||(e.context.updateSubscriptionInfo(o,{querying:!1}),null==(t=e.context.ongoingSubscriptionRecord[o])||null==t.onQueryStateChange||t.onQueryStateChange())}));if(!s&&a)return e.context.updateSubscriptionInfo(i,{suspendPromise:d}),d}if(e.queryState.error)throw e.queryState.error;if(Object.keys(o).length)try{s({queryDefinitions:o,parentSubscriptionId:t,subscriptionSuffix:ft.suspendDisabled,suspend:!1})}catch(r){var l,c;throw e.context.updateSubscriptionInfo(t,{error:r}),null==(l=(c=e.context.ongoingSubscriptionRecord[t]).onQueryStateChange)||l.call(c),r}if(Object.keys(a).length)try{r=s({queryDefinitions:a,parentSubscriptionId:t,subscriptionSuffix:ft.suspendEnabled,suspend:!0})}catch(r){var d,p;throw e.context.updateSubscriptionInfo(t,{error:r}),null==(d=(p=e.context.ongoingSubscriptionRecord[t]).onQueryStateChange)||d.call(p),r}if(r)throw r;return f({},e.queryState,{onHookUnmount:function(){e.context.onHookUnmount(t),e.context.scheduleCleanup(t),i.forEach((function(t){return e.context.scheduleCleanup(t)}))},onHookMount:function(){e.context.onHookMount(t,{silenceDuplicateSubIdErrors:e.silenceDuplicateSubIdErrors}),e.context.cancelCleanup(t),i.forEach((function(t){return e.context.cancelCleanup(t)}))}})}({context:n,subscriptionId:i,queryDefinitions:t,queryState:u,onQueryStateChange:function(){s((function(e){return e+1}))},silenceDuplicateSubIdErrors:l.unsafe__silenceDuplicateSubIdErrors,useServerSidePaginationFilteringSorting:n.mmGQLInstance.paginationFilteringSortingInstance===exports.EPaginationFilteringSortingInstance.SERVER})}catch(e){d=e,c=null}if(a.useEffect((function(){var e;return null==(e=c)||e.onHookMount(),function(){var e;null==(e=c)||e.onHookUnmount()}}),[n,i]),u.error||d)throw u.error||d;return c};
//# sourceMappingURL=sm-js.cjs.production.min.js.map
