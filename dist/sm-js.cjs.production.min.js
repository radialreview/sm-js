"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@apollo/client/core"),r=require("lodash"),n=(e=require("react"))&&"object"==typeof e&&"default"in e?e.default:e,o=require("@apollo/client/link/ws"),a=require("@apollo/client/link/http"),i=require("@apollo/client/link/batch-http"),u=require("@apollo/client/utilities");function s(e,t,r,n,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){s(a,n,o,i,u,"next",e)}function u(e){s(a,n,o,i,u,"throw",e)}i(void 0)}))}}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,f(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function h(e,t,r){return(h=y()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&f(o,r.prototype),o}).apply(null,arguments)}function m(e){var t="function"==typeof Map?new Map:void 0;return(m=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return h(e,arguments,p(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,e)})(e)}function v(e,t){return t||(t=e.slice(0)),e.raw=t,e}var b=function(e){function t(t){var r;return(r=e.call(this,'SMNotUpToDate exception - The property "'+t.propName+'" on the DO for the node type '+t.nodeType+" was read but is not guaranteed to be up to date. Add that property to the query with the id "+t.queryId)||this).propName=t.propName,r}return l(t,e),t}(m(Error)),g=function(e){function t(t){return e.call(this,'SMNotUpToDateInComputed exception - The property "'+t.propName+'" on the DO for the node type "'+t.nodeType+'" was read for the computed property "'+t.computedPropName+'" but is not guaranteed to be up to date. Add that property to the query with the id '+t.queryId)||this}return l(t,e),t}(m(Error)),O=function(e){function t(t){return e.call(this,'SMNotCached exception - Attempted to get the node with the type "'+t.nodeType+'" and id "'+t.id+'" but it was not cached.')||this}return l(t,e),t}(m(Error)),E=function(e){function t(t){return e.call(this,"SMDataType exception - the data type "+t.dataType+' received a bad value. Value: "'+t.value+'"')||this}return l(t,e),t}(m(Error)),w=function(e){function t(t){return e.call(this,"SMDataTypeExplicitDefaultException - the data type "+t.dataType+" requires setting an explicit default value for non-optional properties")||this}return l(t,e),t}(m(Error)),D=function(e){function t(t){return e.call(this,"SMDataParsing exception - "+t.message+"\nData: "+JSON.stringify(t.receivedData,null,2)+".")||this}return l(t,e),t}(m(Error)),x=function(e){function t(t){var r;return(r=e.call(this,"SMUnexpectedSubscriptionMessage exception - unexpected subscription message received")||this).exception=t,r}return l(t,e),t}(m(Error)),R={string:"s",maybeString:"mS",number:"n",maybeNumber:"mN",boolean:"b",maybeBoolean:"mB",object:"o",maybeObject:"mO",record:"r",maybeRecord:"mR",array:"a",maybeArray:"mA"},N=function(e){var t;this.type=e.type,this.parser=e.parser,this.boxedValue=e.boxedValue,this.defaultValue=null!=(t=e.defaultValue)?t:null,this.isOptional=e.isOptional},q=function(e){return new N({type:R.string,parser:function(e){return null!=e?String(e):e},defaultValue:e,isOptional:!1})};q._default=q(""),q.optional=new N({type:R.maybeString,parser:function(e){return null!=e?String(e):e},isOptional:!0});var _=function e(t){return new N({type:R.number,parser:function(t){var r=Number(t);return isNaN(r)?(function(e){var t,r;if("production"!==(null==(t=process)||null==(r=t.env)?void 0:r.NODE_ENV))throw e;console.error(e)}(new E({dataType:R.number,value:t})),e._default.defaultValue):r},defaultValue:t,isOptional:!1})};_._default=_(0),_.optional=new N({type:R.maybeNumber,parser:function(e){return null!=e?Number(e):e},isOptional:!0});var j=function(e){return void 0===e?new w({dataType:R.boolean}):new N({type:R.boolean,parser:function(e){if("true"===e||!0===e)return!0;if("false"===e||!1===e)return!1;throw new E({dataType:R.boolean,value:e})},defaultValue:e,isOptional:!1})};j._default=j(),j.optional=new N({type:R.maybeBoolean,parser:function(e){return null==e?e:"true"===e||!0===e},isOptional:!0});var I=function(e){return new N({type:R.object,parser:function(e){return e},boxedValue:e,isOptional:!1})};I._default=null,I.optional=function(e){return new N({type:R.maybeObject,parser:function(e){return e},boxedValue:e,isOptional:!0})};var k=function(e){return new N({type:R.record,parser:function(e){return e},boxedValue:e,isOptional:!1,defaultValue:{}})};k.optional=function(e){return new N({type:R.maybeRecord,parser:function(e){return e},boxedValue:"function"==typeof e?e._default:e,isOptional:!0,defaultValue:null})},k._default=null;var S={byReference:"bR",children:"bP"},P=["version"];function C(e){if(!e.startsWith("__JSON__"))throw Error("parseJSONFromBE - invalid json received:\n"+e);return e.startsWith("__JSON__[")?JSON.parse(e.replace("__JSON__","")):JSON.parse(e.replace("__JSON__","").replace(/\n/g,"\\n"))}var T=["id","version"];function A(e){var t,r=d({},e.properties,(t=e.relational)?Object.keys(t).reduce((function(e,r){return e[r]=t[r](),e}),{}):{});return Object.keys(e.properties).forEach((function(t){var n=e.properties[t];n.type!==R.object&&n.type!==R.maybeObject||(r[t]=function(e){return e.map})})),e.mapFn(r)}function M(e){var t=A({mapFn:e.mapFn,properties:e.smData,relational:e.smRelational});if(null==t)throw Error("The query with the id '"+e.queryId+"' has an unexpected value in the query result.");return Object.keys(t).reduce((function(r,n){if(!e.smData[n])return r;if(e.isRootLevel&&T.includes(n))return r;var o=e.smData[n];return o.type===R.object||o.type===R.maybeObject?(r.push(n),r.push.apply(r,M({queryId:e.queryId,mapFn:t[n],smData:o.boxedValue}).map((function(e){return n+"__dot__"+e}))),r):[].concat(r,[n])}),e.isRootLevel?[].concat(T):[])}function L(e){return Object.keys(e.nodeProperties).reduce((function(t,r){if(e.isRootLevel&&T.includes(r))return t;var n=e.nodeProperties[r];return n.type===R.object||n.type===R.maybeObject?(t.push(r),t.push.apply(t,L({nodeProperties:e.nodeProperties[r].boxedValue,isRootLevel:!1}).map((function(e){return r+"__dot__"+e}))),t):[].concat(t,[r])}),e.isRootLevel?[].concat(T):[])}function Q(e){return"["+e.map((function(e){return'"'+e+'"'})).join(",")+"]"}function F(e){return"{"+Object.entries(e).reduce((function(e,t){return e+(t[0]+": ")+JSON.stringify(t[1])}),"")+"}"}function V(e){var t=['type: "'+e.def.type+'"'];return e.under&&t.push('underIds: ["'+e.under+'"]'),t.join(", ")}function G(e){return new Array(e).fill(" ").join("")}function J(e){var t="\n"+G(2*(e.nestLevel+2));return t+=e.queryRecordEntry.properties.join(",\n"+G(2*(e.nestLevel+2))),e.queryRecordEntry.relational&&(t+=(""!==t?",":"")+function(e){return Object.keys(e.relationalQueryRecord).reduce((function(t,r){var n,o=e.relationalQueryRecord[r];if("byReference"in o)n='GetReferences(propertyNames: "'+o.idProp+'")';else{if(!("children"in o))throw Error("relationalQueryRecordEntry is invalid\n"+JSON.stringify(o,null,2));n='GetChildren(type: "'+o.def.type+'"'+("depth"in o&&void 0!==o.depth?",depth: "+o.depth:"")+")"}return t+"\n"+G(2*e.nestLevel)+r+": "+n+" {"+J({queryRecordEntry:o,nestLevel:e.nestLevel})+"\n"+G(2*e.nestLevel)+"}"}),"")}({relationalQueryRecord:e.queryRecordEntry.relational,nestLevel:e.nestLevel+2})),t}function U(e){var r=function(e){var t=function(e){var t={};return Object.keys(e.queryDefinitions).forEach((function(r){var n,o,a,i=e.queryDefinitions[r];i._isSMNodeDef?n=L({nodeProperties:(o=i).smData,isRootLevel:!0}):(o=i.def,i.map?(n=M({mapFn:i.map,queryId:e.queryId,smData:i.def.smData,smComputed:i.def.smComputed,smRelational:i.def.smRelational,isRootLevel:!0}),a=function e(t){var r=A({mapFn:t.mapFn,properties:t.smData,relational:t.smRelational}),n=Object.keys(r).reduce((function(n,o){if(t.smData[o]||t.smComputed&&t.smComputed[o])return n;var a=r[o];if(null==a._smRelational)throw Error('getRelationalQueries - the key "'+o+'" is not a data property, not a computed property and does not contain a relational query.');var i=function(e){return a.map(e)},u={def:a.def,properties:M({queryId:t.queryId,mapFn:i,smData:a.def.smData,smComputed:a.def.smComputed,smRelational:a.def.smRelational,isRootLevel:!0})},s=e({queryId:t.queryId,mapFn:i,smData:a.def.smData,smComputed:a.def.smComputed,smRelational:a.def.smRelational});s&&(u.relational=s);var c=a._smRelational;if(c===S.byReference)u.byReference=!0,u.idProp=a.idProp;else{if(c!==S.children)throw Error('relationalType "'+c+'" is not valid.');u.children=!0,"depth"in a&&(u.depth=a.depth)}return n[o]=u,n}),{});if(0!==Object.keys(n).length)return n}({mapFn:i.map,queryId:e.queryId,smData:o.smData,smComputed:o.smComputed,smRelational:o.smRelational})):n=L({nodeProperties:o.smData,isRootLevel:!0}));var u={def:o,properties:n,relational:a};"ids"in i?u.ids=i.ids:"id"in i?u.id=i.id:"underIds"in i&&(u.underIds=i.underIds,"depth"in i&&(u.depth=i.depth)),"filter"in i&&(u.filter=i.filter),t[r]=u})),t}(e),r=("\n    query "+B({queryId:e.queryId})+" {\n        "+Object.keys(t).map((function(e){return function(e){var t;return t="ids"in e?"GetNodesByIdNew(ids: "+Q(e.ids)+")":"id"in e?"GetNodesByIdNew(ids: "+Q([e.id])+")":"GetNodesNew("+function(e){var t=['type: "'+e.def.type+'"'];return e.underIds&&t.push("underIds: ["+e.underIds.map((function(e){return'"'+e+'"'})).join(",")+"]"),null!=e.depth&&t.push("depth: "+e.depth),null!=e.filter&&t.push(Array.isArray(e.filter)?"filter: ["+e.filter.map(F).join(",")+"]":"filter: "+F(e.filter)),t.join(", ")}(e)+")",e.alias+": "+t+" {"+J({queryRecordEntry:e,nestLevel:1})+"\n"+G(4)+"}"}(d({alias:e},t[e]))})).join("\n    ")+"\n    }\n  ").trim();return{subscriptionConfigs:Object.keys(t).reduce((function(r,n){var o=B({queryId:e.queryId+"_"+n}),a=t[n];function i(e){if(!e[n].node)throw new x({subscriptionMessage:e,description:'No "node" found in message'});return e[n].node}function u(e){if(!e[n].operation)throw new x({subscriptionMessage:e,description:'No "operation" found in message'});return e[n].operation}return("ids"in a?["GetNodesById(ids: "+Q(a.ids)+", monitorChildEvents: true)"]:"id"in a?["GetNodesById(ids: "+Q([a.id])+", monitorChildEvents: true)"]:"underIds"in a?a.underIds.map((function(e){return"GetNodesNew("+V(d({},a,{under:e}))+", monitorChildEvents: true)"})):["GetNodesNew("+V(a)+", monitorChildEvents: true)"]).map((function(e){return("\n    subscription "+o+" {\n      "+n+": "+e+" {\n        node {\n          "+J({queryRecordEntry:a,nestLevel:5})+"\n        }\n        operation { action, path }\n      }\n    }\n        ").trim()})).forEach((function(e){r.push({alias:n,gqlString:e,extractNodeFromSubscriptionMessage:i,extractOperationFromSubscriptionMessage:u})})),r}),[]),queryGQLString:r,queryRecord:t}}(e),n=r.subscriptionConfigs,o=r.queryRecord;return{queryGQL:t.gql(r.queryGQLString),subscriptionConfigs:n.map((function(e){return d({},e,{gql:t.gql(e.gqlString)})})),queryRecord:o}}function B(e){return e.queryId.replace(/-/g,"_")}var z,W,Y,K,H,X,$,Z,ee,te=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o=Object.create((t&&t.prototype instanceof l?t:l).prototype),a=new D(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var u=O(i,r);if(u){if(u===d)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=c(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var d={};function l(){}function p(){}function f(){}var y={};u(y,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(x([])));m&&m!==t&&r.call(m,o)&&(y=m);var v=f.prototype=l.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){var n;this._invoke=function(o,a){function i(){return new t((function(n,i){!function n(o,a,i,u){var s=c(e[o],e,a);if("throw"!==s.type){var d=s.arg,l=d.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,i,u)}),(function(e){n("throw",e,i,u)})):t.resolve(l).then((function(e){d.value=e,i(d)}),(function(e){return n("throw",e,i,u)}))}u(s.arg)}(o,a,n,i)}))}return n=n?n.then(i,i):i()}}function O(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,O(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function x(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:R}}function R(){return{value:void 0,done:!0}}return p.prototype=f,u(v,"constructor",f),u(f,"constructor",p),p.displayName=u(f,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(g.prototype),u(g.prototype,a,(function(){return this})),e.AsyncIterator=g,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new g(s(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(v),u(v,i,"Generator"),u(v,o,(function(){return this})),u(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=x,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;w(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(H={exports:{}}),H.exports),re=0;function ne(e){var t=e.smJSInstance,r=e.queryManager;return function(){var e=c(te.mark((function e(n,o){var a,i,u,s,c,d,l,p,f;return te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=function(e){return null!=o&&o.onError||(e.stack=e.stack+"\n"+a.substring(a.indexOf("\n")+1)),e},a=(new Error).stack,i=(null==o?void 0:o.queryId)||"smQuery"+re++,u=U({queryDefinitions:n,queryId:i}),s=u.queryGQL,c=u.queryRecord,l=t.getToken({tokenName:d=(null==o?void 0:o.tokenName)||"default"})){e.next=14;break}if(f=p(new Error('No token registered with the name "'+d+'".\nPlease register this token prior to using it with sm.setToken({ tokenName, token })) ')),null==o||!o.onError){e.next=13;break}return o.onError(f),e.abrupt("return",{data:{},error:f});case 13:throw f;case 14:return e.abrupt("return",t.gqlClient.query({gql:s,token:l,batched:null==o?void 0:o.batched}).then((function(e){var n;try{var a=r||new t.SMQueryManager(c);a.onQueryResult({queryId:i,queryResult:e}),n=a.getResults()}catch(e){var u=p(new Error("Error applying query results\n"+e));if(null!=o&&o.onError)return o.onError(u),{data:{},error:u};throw u}return(null==o?void 0:o.onData)&&o.onData({results:n}),{data:n,error:null}})).catch((function(e){var t=p(new Error("Error querying data\n"+e));if(null!=o&&o.onError)return o.onError(t),{data:{},error:t};throw t})));case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}function oe(e,t){var r=e.filter((function(e){return"name"in e&&!!e.name})).map((function(e){if("name"in e)return e.name;throw Error("Expected an operation name here")}));return r.length?r.join("__"):t}function ae(e){return"\n    view: "+(e.view?"true":"false")+",\n    edit: "+(e.edit?"true":"false")+",\n    manage: "+(e.manage?"true":"false")+",\n    terminate: "+(e.terminate?"true":"false")+",\n    addChild: "+(e.addChild?"true":"false")+"\n  "}function ie(e){var r='{\ntype: "'+(e.type||"access")+'",'+ae(e.permissions)+"}",n=oe([e],"CreateEdge");return t.gql(z||(z=v(["\n    mutation ",' {\n        AttachEdge(\n            newSourceId: "','"\n            targetId: "','"\n            edge: ',"\n        )\n    }"])),n,e.from,e.to,r)}function ue(e){var r=oe([e],"DropEdge");return t.gql(W||(W=v(["\n    mutation ",' {\n        DropEdge(\n            sourceId: "','"\n            targetId: "','"\n            edgeType: "','"\n        )\n    }'])),r,e.from,e.to,e.type||"access")}function se(e){var r=oe([e],"ReplaceEdge"),n='{\ntype: "'+(e.type||"access")+'", '+ae(e.permissions)+"}";return t.gql(Y||(Y=v(["\n    mutation ",' {\n        ReplaceEdge(\n            currentSourceId: "','"\n            newSourceId: "','"\n            targetId: "','"\n            edge: ',"\n        )\n    }"])),r,e.current,e.from,e.to,n)}function ce(e){var r='{\ntype: "'+(e.type||"access")+'", '+ae(e.permissions)+"}",n=oe([e],"UpdateEdge");return t.gql(K||(K=v(["\n    mutation ",' {\n        UpdateEdge(\n            sourceId: "','"\n            targetId: "','"\n            edge: ',"\n        )\n    }"])),n,e.from,e.to,r)}function de(e){var t=Object.entries(e).reduce((function(e,t){var r=t[0],n=t[1];if("childNodes"===r){if(!Array.isArray(n))throw new Error('"childNodes" is supposed to be an array');return d({},e,{childNodes:n.map((function(e){return de(e)}))})}return d({},e,function(e){var t,r,n,o,a,i;if(null===e.value)return(t={})[e.key]=null,t;if(Array.isArray(e.value))return(r={})[e.key]="__JSON__"+le(JSON.stringify(e.value)),r;if("object"==typeof e.value)return function e(t,r){return Object.entries(t).reduce((function(t,n){var o=n[0],a=n[1],i=r?r+"__dot__"+o:o;return"object"==typeof a&&null!=a?(t[i]="__object__",t=d({},t,e(a,i))):t[i]=a,t}),{})}(((n={})[e.key]=e.value,n));if("string"==typeof e.value)return(o={})[e.key]=le(e.value),o;if("boolean"==typeof e.value||"number"==typeof e.value)return"number"==typeof e.value&&isNaN(e.value)?((i={})[e.key]=null,i):((a={})[e.key]=String(e.value),a);throw Error("I don't yet know how to handle feData of type \""+typeof e.value+'"')}({key:r,value:n}))}),{});return Object.entries(t).reduce((function(e,t,r){var n=t[0],o=t[1];return r>0&&(e+="\n"),"childNodes"===n?e+(n+": [\n{\n")+o.join("\n}\n{\n")+"\n}\n]":e+(n+": ")+(null===o?o:'"'+o+'"')}),"")}function le(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")}function pe(e){var t=["node: {\n        "+de(e.data)+"\n      }"];if(e.under){var r="string"==typeof e.under?'["'+e.under+'"]':'["'+e.under.join('", "')+'"]';t.push("underIds: "+r)}return"{\n    "+t.join("\n")+"\n  }"}function fe(e){return"{\n      "+de(e)+"\n    }"}var ye=n.createContext(void 0);function he(e){var r=new o.WebSocketLink({uri:e.wsUrl,options:{reconnect:!0}}),n=new a.HttpLink({uri:e.httpUrl}),s=t.split((function(e){return!1!==e.getContext().batchedQuery}),new i.BatchHttpLink({uri:e.httpUrl,batchMax:30,batchInterval:50}),n),l=t.split((function(e){return e.getContext().batchedMutation}),new i.BatchHttpLink({uri:e.httpUrl,batchMax:Number.MAX_SAFE_INTEGER,batchInterval:0}),s),p=t.split((function(e){var t=u.getMainDefinition(e.query);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),r,l);function f(e){return{headers:{Authorization:"Bearer "+e.token}}}function y(e){var r,n=null==(r=e.gql.loc)?void 0:r.source.body;if(!n)throw new Error("No documentBody found");var o=["GetChildren","GetReferences","GetNodes","GetNodesNew","GetNodesById"];if(o.some((function(e){return null==n?void 0:n.includes(e+"(")}))){var a=n;return o.forEach((function(t){a=a.replace(new RegExp(t+"\\((.*)\\)","g"),t+'($1, authToken: "'+e.token+'")')})),t.gql(a)}return e.gql}var h,m,v=new t.ApolloLink((function(e,r){return new t.Observable((function(t){var n;return Promise.resolve(e).then((function(){n=r(e).subscribe({next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)})})).catch(t.error.bind(t)),function(){n&&n.unsubscribe()}}))})),b=new t.ApolloClient({link:t.ApolloLink.from([v,p]),cache:new t.InMemoryCache,defaultOptions:{watchQuery:{fetchPolicy:"no-cache",errorPolicy:"ignore"},query:{fetchPolicy:"no-cache",errorPolicy:"all"}}});return{query:(m=c(te.mark((function e(t){return te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.query({query:t.gql,context:d({batchedQuery:null==t.batched||t.batched},f({token:t.token}))});case 2:return e.abrupt("return",e.sent.data);case 5:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)}),subscribe:function(e){var t=b.subscribe({query:y(e)}).subscribe({next:function(t){t.data?e.onMessage(t.data):e.onError(new Error("Unexpected message structure.\n"+t))},error:e.onError});return function(){return t.unsubscribe()}},mutate:(h=c(te.mark((function e(t){return te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.mutations.map((function(e){return b.mutate({mutation:e,context:d({batchedMutation:!0},f({token:t.token}))})})));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return h.apply(this,arguments)})}}require("isomorphic-fetch");var me=function(){function e(e){var n;this.tokens={},this.gqlClient=e.gqlClient,this.plugins=e.plugins,this.query=ne({smJSInstance:this}),this.subscribe=(n=this,function(){var e=c(te.mark((function e(t,r){var o,a,i,u,s,c,d,l,p,f,y,h,m,v,b,g,O,E,w,D;return te.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O=function(){m.forEach((function(e){return e()}))},g=function(){try{m=c.map((function(e){return n.gqlClient.subscribe({gql:e.gql,token:p,onMessage:function(t){v?b.push({message:t,subscriptionConfig:e}):(h({message:t,subscriptionConfig:e}),r.onData({results:y.getResults()}))},onError:function(e){var t=d(new Error("Error in a subscription message\n"+e));r.onError?r.onError(t):console.error(t)}})}))}catch(t){var e=d(new Error("Error initializating subscriptions\n"+t));if(null==r||!r.onError)throw e;r.onError(e)}},h=function(e){var t,n;try{t=e.subscriptionConfig.extractNodeFromSubscriptionMessage(e.message),n=e.subscriptionConfig.extractOperationFromSubscriptionMessage(e.message),y.onSubscriptionMessage({node:t,operation:n,queryId:a,subscriptionAlias:e.subscriptionConfig.alias})}catch(e){var o=d(new Error("Error applying subscription message\n"+e));r.onError?r.onError(o):console.error(o)}},d=function(e){return r.onError||(e.stack=e.stack+"\n"+o.substring(o.indexOf("\n")+1)),e},o=(new Error).stack,a=(null==r?void 0:r.queryId)||"smQuery"+re++,i=U({queryDefinitions:t,queryId:a}),u=i.queryGQL,s=i.queryRecord,c=i.subscriptionConfigs,r.onQueryInfoConstructed&&r.onQueryInfoConstructed({queryGQL:u,queryId:a}),p=n.getToken({tokenName:l=(null==r?void 0:r.tokenName)||"default"})){e.next=18;break}if(f=d(new Error('No token registered with the name "'+l+'".\nPlease register this token prior to using it with sm.setToken(tokenName, { token })) ')),!r.onError){e.next=17;break}return r.onError(f),e.abrupt("return",{data:{},unsub:O,error:f});case 17:throw f;case 18:if(y=new n.SMQueryManager(s),m=[],v=!r.skipInitialQuery,b=[],g(),r.onSubscriptionInitialized&&r.onSubscriptionInitialized(O),!r.skipInitialQuery){e.next=28;break}return e.abrupt("return",{unsub:O});case 28:return E=ne({smJSInstance:n,queryManager:y}),e.prev=29,e.next=32,E(t,{queryId:r.queryId,tokenName:r.tokenName,batched:r.batched});case 32:e.next=43;break;case 34:if(e.prev=34,e.t0=e.catch(29),w=d(new Error("Error querying initial data set\n"+e.t0)),null==r||!r.onError){e.next=42;break}return r.onError(w),e.abrupt("return",{data:{},unsub:O,error:w});case 42:throw w;case 43:return v&&(v=!1,b.forEach(h),b.length=0),D=y.getResults(),r.onData({results:D}),e.abrupt("return",{data:D,unsub:O,error:null});case 47:case"end":return e.stop()}}),e,null,[[29,34]])})));return function(t,r){return e.apply(this,arguments)}}()),this.DOProxyGenerator=function(e){return function(t){var r=t.relationalResults,n=t.node.smComputed,o=n?Object.keys(n).reduce((function(t,r){var o,i=function(){return n[r](a)};return null==(o=e.plugins)||o.forEach((function(e){var t;null!=(t=e.DOProxy)&&t.computedDecorator&&(i=e.DOProxy.computedDecorator({ProxyInstance:a,computedFn:i}))})),t[r]=i,t}),{}):{},a=new Proxy(t.do,{getOwnPropertyDescriptor:function(e,r){return t.allPropertiesQueried.includes(r)||t.relationalQueries&&Object.keys(t.relationalQueries).includes(r)?d({},Object.getOwnPropertyDescriptor(e,r),{enumerable:!0,configurable:!0}):d({},Object.getOwnPropertyDescriptor(e,r),{enumerable:!1})},get:function(e,n){if("updateRelationalResults"===n)return function(e){r=d({},r,e)};if(r&&t.relationalQueries&&Object.keys(r).includes(n)){if("byReference"in t.relationalQueries[n]){var a=r[n];if(!Array.isArray(a))throw Error("Expected results to be an array but it wasn't");return a[0]}return r[n]}if(Object.keys(t.node.smData).includes(n)){if(!t.allPropertiesQueried.includes(n))throw new b({propName:n,queryId:t.queryId,nodeType:t.node.type});var i=t.node.smData[n];return i.type===R.object||i.type===R.maybeObject?null==t.do[n]?t.do[n]:function e(t){var r={};return Object.keys(t.smDataForThisObject).forEach((function(n){var o=t.parentObjectKey?t.parentObjectKey+"__dot__"+n:n,a=t.smDataForThisObject[n],i=t.allPropertiesQueried.includes(o)||t.allPropertiesQueried.some((function(e){return e.startsWith(o)}));Object.defineProperty(r,n,{enumerable:i,get:function(){if(a.type===R.object||a.type===R.maybeObject)return null==t.allCachedData[n]?t.allCachedData[n]:e({nodeType:t.nodeType,queryId:t.queryId,allCachedData:t.allCachedData[n],smDataForThisObject:a.boxedValue,allPropertiesQueried:t.allPropertiesQueried,parentObjectKey:o});if(!i)throw new b({propName:o,nodeType:t.nodeType,queryId:t.queryId});return t.allCachedData?t.allCachedData[n]:void 0}})})),r}({nodeType:t.node.type,queryId:t.queryId,allCachedData:t.do[n],smDataForThisObject:i.boxedValue,allPropertiesQueried:t.allPropertiesQueried,parentObjectKey:n}):t.do[n]}if(o[n])try{return o[n]()}catch(e){if(e instanceof b)throw new g({computedPropName:n,propName:e.propName,nodeType:t.node.type,queryId:t.queryId});throw e}return e[n]}});return a}}(this),this.DOFactory=function(e){return function(t){return function(){function r(r){var n,o=this;this.version=-1,this._persistedData={},this.getDefaultData=function(e){if(e instanceof N)return o.isObjectType(e.type)?o.getDefaultData(e.boxedValue):e.defaultValue;var t=function(t,r){var n=r||e[t]._default;if(n instanceof Error)throw n;return o.isArrayType(n.type)?o.isObjectType(n.boxedValue.type)?[o.getDefaultData(n.boxedValue.boxedValue)]:[n.boxedValue.defaultValue]:n.defaultValue};return"function"==typeof e?t(void 0,e._default):Object.keys(e).reduce((function(r,n){var a=e[n];if(o.isObjectType(a.type)||o.isRecordType(a.type))r[n]=o.getDefaultData(a.boxedValue);else if("function"==typeof a){var i=t(n);r[n]=i}else r[n]=e[n].defaultValue;return r}),{})},this.onDataReceived=function(e){if(null==e.version)throw Error("Message received for a node was missing a version");var r=e.version,n=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||(o[r]=e[r]);return o}(e,P),a=Number(r);if(a>=o.version){o.version=a;var i=o.parseReceivedData({initialData:n,nodeProperties:t.properties});o.extendPersistedWithNewlyReceivedData({smData:t.properties,object:o._persistedData,extension:i}),o.parsedData=o.getParsedData({smData:t.properties,persistedData:o._persistedData,defaultData:o._defaults})}},this.setObjectProp=function(e){Object.defineProperty(o,e,{configurable:!0,enumerable:!0,get:function(){return o.parsedData[e]}})},this.setPrimitiveValueProp=function(e){Object.defineProperty(o,e,{configurable:!0,enumerable:!0,get:function(){return o.parsedData[e]}})},this.setArrayProp=function(e){Object.defineProperty(o,e,{configurable:!0,enumerable:!0,get:function(){return o.parsedData[e]}})},this._defaults=this.getDefaultData(t.properties),null!=r&&r.version&&(this.version=Number(r.version)),r&&(this._persistedData=this.parseReceivedData({initialData:r,nodeProperties:t.properties})),this.parsedData=this.getParsedData({smData:t.properties,persistedData:this._persistedData,defaultData:this._defaults}),null==(n=e.plugins)||n.forEach((function(e){var t;null!=(t=e.DO)&&t.onConstruct&&e.DO.onConstruct({DOInstance:o,parsedDataKey:"parsedData"})})),this.initializeNodePropGettersAndSetters(),this.initializeNodeComputedGetters(),this.initializeNodeRelationalGetters(),this.initializeNodeMutations()}var n=r.prototype;return n.parseReceivedData=function(e){var t=this,r=e.initialData;return Object.entries(e.nodeProperties).reduce((function(e,n){var o=n[0],a=t.getSMData(n[1]),i=o in r&&null!=r[o];return t.isObjectType(a.type)&&i?e[o]=t.parseReceivedData({initialData:r[o],nodeProperties:a.boxedValue}):t.isArrayType(a.type)&&i?e[o]=r[o].map(a.boxedValue.parser):o in r&&null===r[o]?e[o]=null:i&&(e[o]=a.parser(r[o])),e}),{})},n.getParsedData=function(e){var t=this;if(e.smData instanceof N&&e.smData.isOptional&&null==e.persistedData)return null;var r=this.getSMData(e.smData);return r instanceof N&&r.boxedValue?this.isArrayType(r.type)?e.persistedData?(e.persistedData||[]).map((function(n){var o;return t.getParsedData({smData:r.boxedValue,persistedData:n,defaultData:r.type===R.array&&(null==(o=e.defaultData)?void 0:o[0])||null})})):e.defaultData:(e.persistedData||(e.persistedData={}),this.getSMData(r.boxedValue)instanceof N?Object.keys(e.persistedData).reduce((function(n,o){return n[o]=t.getParsedData({smData:r.boxedValue,persistedData:e.persistedData[o],defaultData:e.defaultData}),n}),{}):Object.keys(r.boxedValue).reduce((function(n,o){var a;return n[o]=t.getParsedData({smData:r.boxedValue[o],persistedData:e.persistedData[o],defaultData:null==(a=e.defaultData)?void 0:a[o]}),n}),{})):r instanceof N?null!=e.persistedData?r.parser(e.persistedData):e.defaultData:Object.keys(r).reduce((function(n,o){return n[o]=t.getParsedData({smData:r[o],persistedData:e.persistedData[o],defaultData:e.defaultData[o]}),n}),{})},n.extendPersistedWithNewlyReceivedData=function(e){var t=this;Object.entries(e.extension).forEach((function(r){var n=r[0],o=r[1],a=t.getSMData(e.smData[n]);t.isRecordType(a.type)?e.object[n]=o:t.isObjectType(a.type)?null==o?e.object[n]=null:(e.object[n]=e.object[n]||{},t.extendPersistedWithNewlyReceivedData({smData:a.boxedValue,object:e.object[n],extension:o})):e.object[n]=o}))},n.initializeNodePropGettersAndSetters=function(){var e=this;Object.keys(t.properties).forEach((function(r){var n=e.getSMData(t.properties[r]);e.isObjectType(n.type)?e.setObjectProp(r):e.isArrayType(n.type)?e.setArrayProp(r):e.setPrimitiveValueProp(r)}))},n.initializeNodeComputedGetters=function(){var e=this,r=t.computed;r&&Object.keys(r).forEach((function(t){e.setComputedProp({propName:t,computedFn:r[t]})}))},n.initializeNodeRelationalGetters=function(){var e=this,r=t.relational;r&&Object.keys(r).forEach((function(t){e.setRelationalProp({propName:t,relationalQueryGetter:r[t]})}))},n.initializeNodeMutations=function(){var e=this,r=t.mutations;r&&Object.keys(r).forEach((function(t){Object.defineProperty(e,t,{get:function(){return r[t].bind(e)}})}))},n.setComputedProp=function(t){var r,n=this,o=function(){return t.computedFn(n)};null==(r=e.plugins)||r.forEach((function(e){var t;null!=(t=e.DO)&&t.computedDecorator&&(o=e.DO.computedDecorator({computedFn:o,DOInstance:n}))})),Object.defineProperty(this,t.propName,{get:function(){return o()},enumerable:!0})},n.setRelationalProp=function(e){Object.defineProperty(this,e.propName,{configurable:!0,get:function(){return e.relationalQueryGetter()}})},n.getSMData=function(e){return"function"==typeof e?e._default:e},n.isArrayType=function(e){return e===R.array||e===R.maybeArray},n.isObjectType=function(e){return e===R.object||e===R.maybeObject},n.isRecordType=function(e){return e===R.record||e===R.maybeRecord},r}()}}(this),this.SMQueryManager=function(e){return function(){function t(e){this.state={},this.queryRecord=e}var r=t.prototype;return r.onQueryResult=function(e){this.notifyRepositories({data:e.queryResult,queryRecord:this.queryRecord}),this.state=this.getNewStateFromQueryResult(e)},r.onSubscriptionMessage=function(e){var t,r,n=e.node,o=e.operation,a=e.subscriptionAlias,i=this.queryRecord[a];if("DeleteNode"!==o.action||o.path!==n.id)this.notifyRepositories({data:(t={},t[a]=n,t),queryRecord:(r={},r[a]=i,r)}),this.updateProxiesAndStateFromSubscriptionMessage(e);else{var u=this.state[e.subscriptionAlias].idsOrIdInCurrentResult;Array.isArray(u)&&(this.state[e.subscriptionAlias].idsOrIdInCurrentResult=u.filter((function(e){return e!==n.id})))}},r.getResults=function(){return this.getResultsFromState(this.state)},r.getResultsFromState=function(e){return Object.keys(e).reduce((function(t,r){var n=e[r],o=n.idsOrIdInCurrentResult;return t[r]=Array.isArray(o)?o.map((function(e){return n.proxyCache[e].proxy})):n.proxyCache[o].proxy,t}),{})},r.notifyRepositories=function(e){var t=this;Object.keys(e.queryRecord).forEach((function(r){var n=e.data[r];if(!n)throw Error('notifyRepositories could not find resulting data for the alias "'+r+'" in the following queryRecord:\n'+JSON.stringify(e.queryRecord,null,2)+"\nResulting data:\n"+JSON.stringify(e.data,null,2));var o=e.queryRecord[r].def.repository;Array.isArray(n)?n.flatMap((function(e){return o.onDataReceived(e)})):o.onDataReceived(n);var a=e.queryRecord[r].relational;a&&Object.keys(a).forEach((function(e){var r=Array.isArray(n)?n.flatMap((function(t){return t[e]})):n[e];if(r){var o,i,u=a[e];t.notifyRepositories({data:(o={},o[e]=r,o),queryRecord:(i={},i[e]=u,i)})}}))}))},r.getNewStateFromQueryResult=function(e){var t=this;return Object.keys(this.queryRecord).reduce((function(r,n){return r[n]=t.buildCacheEntry({nodeData:e.queryResult[n],queryId:e.queryId,queryAlias:n}),r}),{})},r.buildCacheEntry=function(t){var r,n=this,o=t.nodeData,a=t.queryAlias,i=t.queryRecord||this.queryRecord,u=i[t.queryAlias].relational,s=function(r){var o=function(e){return u?Object.keys(u).reduce((function(r,o){var a,i=e[o];return i?d({},r,((a={})[o]=n.buildCacheEntry({nodeData:i,queryId:t.queryId,queryAlias:o,queryRecord:u}),a)):r}),{}):null}(r),s=i[a].def.repository;return{proxy:e.DOProxyGenerator({node:i[t.queryAlias].def,allPropertiesQueried:i[t.queryAlias].properties,relationalQueries:u||null,queryId:t.queryId,relationalResults:o?n.getResultsFromState(o):null,do:s.byId(r.id)}),relationalState:o}};if(Array.isArray(t.nodeData)){if("id"in i[t.queryAlias]){if(null==t.nodeData[0])throw new D({receivedData:t.nodeData,message:'Queried a node by id for the query with the id "'+t.queryId+'" but received back an empty array'});return{idsOrIdInCurrentResult:t.nodeData[0].id,proxyCache:t.nodeData.reduce((function(e,t){return e[t.id]=s(t),e}),{})}}return{idsOrIdInCurrentResult:t.nodeData.map((function(e){return e.id})),proxyCache:t.nodeData.reduce((function(e,t){return e[t.id]=s(t),e}),{})}}return{idsOrIdInCurrentResult:t.nodeData.id,proxyCache:(r={},r[o.id]=s(o),r)}},r.updateProxiesAndStateFromSubscriptionMessage=function(e){var t=e.node,r=e.queryId,n=e.subscriptionAlias,o=this.queryRecord[n];this.state[n]=this.state[n]||{};var a=this.state[n],i=t.id,u=a.proxyCache[i]||{},s=u.proxy,c=u.relationalState;if(s){var d=this.recursivelyUpdateProxyAndReturnNewCacheEntry({queryId:r,proxy:s,newRelationalData:this.getRelationalData({queryRecord:o,node:e.node}),relationalQueryRecord:o.relational||null,currentState:{proxy:s,relationalState:c}});a.proxyCache[i]=d}else{var l=this.buildCacheEntry({nodeData:t,queryId:r,queryAlias:n,queryRecord:this.queryRecord}).proxyCache;if(!l[t.id])throw Error("Expected a newly generated proxy");a.proxyCache[i]=l[t.id]}if("id"in o){if(a.idsOrIdInCurrentResult===i)return;this.state[e.subscriptionAlias].idsOrIdInCurrentResult=i}else{if((a.idsOrIdInCurrentResult||[]).includes(i))return;this.state[e.subscriptionAlias].idsOrIdInCurrentResult=[i].concat(this.state[e.subscriptionAlias].idsOrIdInCurrentResult)}},r.recursivelyUpdateProxyAndReturnNewCacheEntry=function(e){var t=this,r=e.queryId,n=e.proxy,o=e.newRelationalData,a=e.relationalQueryRecord,i=e.currentState.relationalState,u=a?Object.keys(a).reduce((function(e,n){if(!o||!o[n])return e;var u=o[n],s=a[n],c=i?i[n]:null;if(!c)return e[n]=t.buildCacheEntry({nodeData:u,queryId:r,queryAlias:n,queryRecord:a}),e;if(!Array.isArray(u))throw Error("Not implemented. "+JSON.stringify(u));return e[n]=e[n]||{proxyCache:{},idsOrIdInCurrentResult:[]},u.forEach((function(o){var i,u=null==(i=c.proxyCache[o.id])?void 0:i.proxy;if(u){var l,p=t.recursivelyUpdateProxyAndReturnNewCacheEntry({queryId:r,proxy:u,newRelationalData:t.getRelationalData({queryRecord:s,node:o}),relationalQueryRecord:s.relational||null,currentState:c.proxyCache[o.id]});e[n]={proxyCache:d({},e[n].proxyCache,(l={},l[o.id]=p,l)),idsOrIdInCurrentResult:[].concat(e[n].idsOrIdInCurrentResult,[o.id])}}else{var f,y=t.buildCacheEntry({nodeData:o,queryId:r,queryAlias:n,queryRecord:a});e[n]={proxyCache:d({},e[n].proxyCache,(f={},f[o.id]=y.proxyCache[o.id],f)),idsOrIdInCurrentResult:[].concat(e[n].idsOrIdInCurrentResult,[o.id])}}})),e}),{}):null;return n.updateRelationalResults(u?this.getResultsFromState(u):null),{proxy:n,relationalState:u}},r.getRelationalData=function(e){return e.queryRecord.relational?Object.keys(e.queryRecord.relational).reduce((function(t,r){return t[r]=e.node[r],t}),{}):null},t}()}(this),this.transaction=function(e){return function(n,o){var a={createNode:[],createNodes:[],updateNode:[],updateNodes:[],dropNode:[],createEdge:[],createEdges:[],dropEdge:[],dropEdges:[],replaceEdge:[],replaceEdges:[],updateEdge:[],updateEdges:[]},i=0,u=0;function s(e){if(!a[e.type])throw Error('No operationsByType array initialized for "'+e.type+'"');a[e.type].push("createNodes"===e.type?d({},e,{position:i+=1,nodes:e.nodes.map((function(e,t){return d({},e,{position:0===t?i:i+=1})}))}):"createNode"===e.type?d({},e,{position:i+=1}):"updateNodes"===e.type?d({},e,{position:u+=1,nodes:e.nodes.map((function(e,t){return d({},e,{position:0===t?u:u+=1})}))}):"updateNode"===e.type?d({},e,{position:u+=1}):e)}var l={createNode:function(e){var t=function(e){return d({type:"createNode",smOperationName:"CreateNodes"},e)}(e);return s(t),t},createNodes:function(e){var t=function(e){return d({type:"createNodes",smOperationName:"CreateNodes"},e)}(e);return s(t),t},updateNode:function(e){var t=function(e){return d({type:"updateNode",smOperationName:"UpdateNodes"},e)}(e);return s(t),t},updateNodes:function(e){var t=function(e){return d({type:"updateNodes",smOperationName:"UpdateNodes"},e)}(e);return s(t),t},dropNode:function(e){var t=function(e){return d({type:"dropNode",smOperationName:"DropNode"},e)}(e);return s(t),t},createEdge:function(e){var t=d({type:"createEdge"},e,{smOperationName:"AttachEdge"});return s(t),t},createEdges:function(e){var t={type:"createEdges",smOperationName:"AttachEdge",edges:e};return s(t),t},dropEdge:function(e){var t=d({type:"dropEdge",smOperationName:"DropEdge"},e);return s(t),t},dropEdges:function(e){var t={type:"dropEdges",smOperationName:"DropEdge",edges:e};return s(t),t},updateEdge:function(e){var t=d({type:"updateEdge",smOperationName:"UpdateEdge"},e);return s(t),t},updateEdges:function(e){var t={type:"updateEdges",smOperationName:"UpdateEdge",edges:e};return s(t),t},replaceEdge:function(e){var t=d({type:"replaceEdge",smOperationName:"ReplaceEdge"},e);return s(t),t},replaceEdges:function(e){var t={type:"replaceEdges",smOperationName:"ReplaceEdge",edges:e};return s(t),t}};function p(e){return r.sortBy(e,(function(e){return e.position}))}function f(e){return[].concat(function(e){if(!e.length)return[];var r=e.flatMap((function(e){if("createNode"===e.type)return e;if("createNodes"===e.type)return e.nodes;throw Error('Operation not recognized: "'+e+'"')})),n=oe(e,"CreateNodes");return[t.gql(X||(X=v(["\n      mutation "," {\n        CreateNodes(\n          createOptions: [\n            ","\n          ] \n        ) {\n          id\n        }\n      }\n    "])),n,r.map(pe).join("\n"))]}(p([].concat(e.createNode,e.createNodes))),function(e){if(!e.length)return[];var r=e.flatMap((function(e){if("updateNode"===e.type)return e.data;if("updateNodes"===e.type)return e.nodes.map((function(e){return e.data}));throw Error('Operation not recognized: "'+e+'"')})),n=oe(e,"UpdateNodes"),o=r.reduce((function(e,r){var n=function e(t){return Object.entries(t).reduce((function(t,r){var n=r[0],o=r[1];return null==o?t.push(n):Array.isArray(o)||"object"!=typeof o||t.push.apply(t,e(o).map((function(e){return n+"__dot__"+e}))),t}),[])}(r);return n.length&&e.push(t.gql($||($=v(['\n        mutation {\n          DropProperties(\n            nodeIds: ["','"]\n            propertyNames: [',"]\n  \n          )\n          { \n            id\n          }\n      }\n      "])),r.id,n.map((function(e){return'"'+e+'__dot__*"'})).join(","))),e}),[]);return[t.gql(Z||(Z=v(["\n        mutation "," {\n          UpdateNodes(\n            nodes: [\n              ","\n            ] \n          ) {\n            id\n          }\n        }\n      "])),n,r.map(fe).join("\n"))].concat(o)}(p([].concat(e.updateNode,e.updateNodes))),function(e){return e.length?e.map((function(e){if("dropNode"===e.type)return e;throw Error('Operation not recognized: "'+e+'"')})).map((function(e){var r=oe([e],"DropNode");return t.gql(ee||(ee=v(["\n      mutation ",' {\n        DropNode(nodeId: "','")\n      }    \n    '])),r,e.id)})):[]}([].concat(e.dropNode)),function(e){return e.flatMap((function(e){if("createEdge"===e.type)return ie(d({},e.edge,{name:e.name}));if("createEdges"===e.type)return e.edges.map((function(e){return ie(e.edge)}));throw Error('Operation not recognized: "'+e+'"')}))}([].concat(e.createEdge,e.createEdges)),function(e){return e.flatMap((function(e){if("dropEdge"===e.type)return ue(d({},e.edge,{name:e.name}));if("dropEdges"===e.type)return e.edges.map((function(e){return ue(d({},e.edge,{name:e.name}))}));throw Error('Operation not recognized: "'+e+'"')}))}([].concat(e.dropEdge,e.dropEdges)),function(e){return e.flatMap((function(e){if("replaceEdge"===e.type)return se(d({},e.edge,{name:e.name}));if("replaceEdges"===e.type)return e.edges.map((function(e){return se(e.edge)}));throw Error('Operation not recognized: "'+e+'"')}))}([].concat(e.replaceEdge,e.replaceEdges)),function(e){return e.flatMap((function(e){if("updateEdge"===e.type)return ce(d({},e.edge,{name:e.name}));if("updateEdges"===e.type)return e.edges.map((function(e){return ce(e.edge)}));throw Error('Operation not recognized: "'+e+'"')}))}([].concat(e.updateEdge,e.updateEdges)))}var y=e.getToken({tokenName:(null==o?void 0:o.tokenName)||"default"});if(Array.isArray(n))return function(t){var r=t.filter((function(e){return e.callbackResult instanceof Promise})).map((function(e){return e.callbackResult}));function n(){return(n=c(te.mark((function n(){var o,a;return te.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!r.length){n.next=4;break}return n.next=4,Promise.all(r);case 4:return o=t.map((function(t){return e.gqlClient.mutate({mutations:f(t.operations),token:y})})),n.next=7,Promise.all(o);case 7:return(a=n.sent)&&a.forEach((function(e,r){m({executionResult:e,operationsByType:t[r].operations})})),n.abrupt("return",a.flat());case 12:throw n.prev=12,n.t0=n.catch(0),n.t0;case 15:case"end":return n.stop()}}),n,null,[[0,12]])})))).apply(this,arguments)}return{operations:a,execute:function(){return n.apply(this,arguments)}}}(n);var h=n(l);function m(e){var t=e.executionResult,n=function(e){var t=Object.entries(e).reduce((function(e,t){return t[1].forEach((function(t){e[t.smOperationName]=e.hasOwnProperty(t.smOperationName)?[].concat(e[t.smOperationName],[t]):[t]})),e}),{});return Object.entries(t).forEach((function(e){t[e[0]]=r.sortBy(e[1],(function(e){return e.position}))})),t}(e.operationsByType);!function e(t){t.forEach((function(t){if(Array.isArray(t))e(t);else{var r=t.data;Object.entries(n).forEach((function(e){var t=e[0],n=e[1];r.hasOwnProperty(t)&&n.forEach((function(e){if("CreateNodes"===t||"UpdateNodes"===t){var n=r[t];e.hasOwnProperty("nodes")?e.nodes.forEach((function(e){e.hasOwnProperty("onSuccess")&&e.onSuccess(n[e.position-1])})):e.hasOwnProperty("onSuccess")&&e.onSuccess(n[e.position-1])}}))}))}}))}(t),Object.entries(n).forEach((function(e){var t=e[0];"CreateNodes"!==t&&"UpdateNodes"!==t&&e[1].forEach((function(e){e.hasOwnProperty("onSuccess")?e.onSuccess():e.hasOwnProperty("edges")&&e.edges.forEach((function(e){e.hasOwnProperty("onSuccess")&&e.onSuccess()}))}))}))}function b(){return(b=c(te.mark((function t(){var r,o;return te.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"function"!=typeof n){t.next=5;break}if(!(h instanceof Promise)){t.next=5;break}return t.next=5,h;case 5:return r=f(a),t.next=8,e.gqlClient.mutate({mutations:r,token:y});case 8:return(o=t.sent)&&m({executionResult:o,operationsByType:a}),t.abrupt("return",o);case 13:throw t.prev=13,t.t0=t.catch(0),t.t0;case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))).apply(this,arguments)}return{operations:a,execute:function(){return b.apply(this,arguments)},callbackResult:h}}}(this)}var n=e.prototype;return n.def=function(e){var t,r=this.DOFactory(e);return{_isSMNodeDef:!0,do:r,repository:(t={def:e,DOClass:r},new(function(){function e(){this.cached={}}var r=e.prototype;return r.onDataReceived=function(e){var r=this.cached[e.id],n=this.parseDataFromSM(e);r?r.onDataReceived(n):this.cached[e.id]=new t.DOClass(n)},r.byId=function(e){var r=this.cached[e];if(!r)throw new O({nodeType:t.def.type,id:e});return r},r.onNodeDeleted=function(e){delete this.cached[e]},r.parseDataFromSM=function(e){var r=this,n={};return Object.keys(e).reduce((function(o,a){var i;if(T.includes(a))return d({},o,((i={})[a]=e[a],i));if(!(a.includes("__dot__")?Object.keys(t.def.properties).includes(a.split("__dot__")[0]):Object.keys(t.def.properties).includes(a)))return o;var u=a.includes("__dot__")||t.def.properties[a].type===R.object||t.def.properties[a].type===R.maybeObject,s=function(){if(u)return!1;var r=t.def.properties[a],n="function"==typeof r?r._default.type:e.type;return n===R.array||n===R.maybeArray}();if(u){var c=a.split("__dot__"),l=c[0],p=c.slice(1);if("__NULL__"===e[l]||null===e[l])return o[l]=null,o;if("string"==typeof e[l]&&e[l].startsWith("__JSON__"))try{n[l]=n[l]||C(e[l])}catch(t){throw new D({receivedData:e,message:"Could not parse json stored in old format"})}return n[l]?(o[l]=o[l]||r.getOnlyQueriedData({allDataReceived:e,dataPreviouslyParsedForThisObject:n[l],rootProp:l}),o):(null==o[l]&&(o[l]={}),r.nest({nests:p,root:o[l],val:"__object__"===e[a]?{}:e[a]}),o)}return s?(o[a]=function e(t){return"__NULL__"===t?null:"true"===t||"false"===t?"true"===t:"string"==typeof t&&t.startsWith("__JSON__")?C(t):Array.isArray(t)?t.map((function(t){return"object"==typeof t?e(t):t})):null!=t&&"object"==typeof t?(r=t,Object.keys(r).reduce((function(t,n){var o;return d({},t,((o={})[n]=e(r[n]),o))}),{})):t;var r}(e[a]),o):(o[a]=e[a],o)}),{})},r.getOnlyQueriedData=function(e){var t=this;return Object.keys(e.allDataReceived).filter((function(t){return t.startsWith(e.rootProp+"__dot__")})).reduce((function(r,n){var o,a=n.split("__dot__"),i=a[0],u=a.slice(1);return t.nest({nests:u,root:r,val:t.getDataForProp({prop:n,object:(o={},o[i]=e.dataPreviouslyParsedForThisObject,o)})}),r}),{})},r.getDataForProp=function(e){if(null!=e.object){if(e.prop.includes("__dot__")){var t=e.prop.split("__dot__"),r=t[0],n=t.slice(1);return this.getDataForProp({object:e.object[r],prop:n.join("__dot__")})}return e.object[e.prop]}},r.nest=function(e){if(0===e.nests.length)e.root=e.val;else if(1===e.nests.length)e.root[e.nests[0]]=e.val;else{var t=e.nests,r=t[0],n=t.slice(1);null==e.root[r]?e.root[r]=null:this.nest({nests:n,root:e.root[r],val:e.val})}},e}())),type:e.type,smData:e.properties,smComputed:e.computed,smRelational:e.relational,smMutations:e.mutations}},n.getToken=function(e){return this.tokens[e.tokenName]},n.setToken=function(e){this.tokens[e.tokenName]=e.token},e}();exports.OBJECT_IDENTIFIER="__object__",exports.OBJECT_PROPERTY_SEPARATOR="__dot__",exports.SMContext=ye,exports.SMData=N,exports.SMJS=me,exports.SMProvider=function(e){if(n.useContext(ye))throw Error("Another instance of an SMProvider was already detected higher up the render tree.\nHaving multiple instances of SMProviders is not supported and may lead to unexpected results.");var t=n.useRef({}),r=n.useRef({}),o=n.useCallback((function(e,r){t.current[e]=d({},t.current[e],r)}),[]),a=n.useCallback((function(n){function o(){var e=t.current[n];e&&(e.unsub&&e.unsub(),delete t.current[n])}null!=e.subscriptionTTLMs?r.current[n]=setTimeout(o,e.subscriptionTTLMs):o()}),[e.subscriptionTTLMs]),i=n.useCallback((function(e){clearTimeout(r.current[e])}),[]);return n.createElement(ye.Provider,{value:{smJSInstance:e.smJS,ongoingSubscriptionRecord:t.current,updateSubscriptionInfo:o,scheduleCleanup:a,cancelCleanup:i}},e.children)},exports.SM_DATA_TYPES=R,exports.SM_RELATIONAL_TYPES=S,exports.array=function(e){var t="function"==typeof e?e._default:e;function r(e){return new N({type:R.array,parser:function(e){return e},boxedValue:t,defaultValue:e,isOptional:!1})}return r.optional=new N({type:R.maybeArray,parser:function(e){return e},boxedValue:t,isOptional:!0}),r._default=r([]),r},exports.boolean=j,exports.children=function(e){return function(t){return d({},e,{_smRelational:S.children,map:t.map,depth:e.depth})}},exports.getDefaultConfig=function(){return{gqlClient:he({httpUrl:"https://saasmaster.dev02.tt-devs.com/playground/..",wsUrl:"wss://saasmaster.dev02.tt-devs.com/"})}},exports.number=_,exports.object=I,exports.queryDefinition=function(e){return e},exports.record=k,exports.reference=function(e){return function(t){return d({},e,{_smRelational:S.byReference,map:t.map})}},exports.string=q,exports.useSubscription=function e(t){var r,o=n.useContext(ye);if(!o)throw Error("You must wrap your app with an SMProvider before using useSubscription.");var a={stack:""};if(Error.captureStackTrace(a,e),""===a.stack)throw Error("Error.captureStackTrace not supported");var i=a.stack.split("\n")[1],u=o.ongoingSubscriptionRecord[i],s=n.useState(null==u?void 0:u.results),c=s[0],d=s[1],l=n.useState(null==u?void 0:u.error),p=l[0],f=l[1],y=n.useState(null==(null==u?void 0:u.querying)||(null==u?void 0:u.querying)),h=y[0],m=y[1];n.useEffect((function(){return o.cancelCleanup(i),function(){o.scheduleCleanup(i)}}),[o,i]),o.updateSubscriptionInfo(i,{onResults:d,onError:f,setQuerying:m});var v=null!=(null==u||null==(r=u.queryInfo)?void 0:r.queryGQL)&&u.queryInfo.queryGQL!==U({queryDefinitions:t,queryId:u.queryInfo.queryId}).queryGQL;if(!u||v){v&&u.unsub&&u.unsub();var b=(new Date).valueOf();m(!0),o.updateSubscriptionInfo(i,{querying:!0,lastQueryTimestamp:b});var g=o.smJSInstance.subscribe(t,{onData:function(e){var t=e.results,r=o.ongoingSubscriptionRecord[i];r.lastQueryTimestamp===b&&(r.onResults&&r.onResults(t),o.updateSubscriptionInfo(i,{results:t}))},onError:function(e){var t=o.ongoingSubscriptionRecord[i];t.onError&&t.onError(e),o.updateSubscriptionInfo(i,{error:e})},onSubscriptionInitialized:function(e){o.updateSubscriptionInfo(i,{unsub:e})},onQueryInfoConstructed:function(e){o.updateSubscriptionInfo(i,{queryInfo:e})}}).finally((function(){var e=o.ongoingSubscriptionRecord[i];e.lastQueryTimestamp===b&&(e.setQuerying&&e.setQuerying(!1),o.updateSubscriptionInfo(i,{suspendPromise:void 0,querying:!1}))}));if(u)return{data:c,querying:h};throw o.updateSubscriptionInfo(i,{suspendPromise:g}),g}if(u.suspendPromise)throw u.suspendPromise;if(p)throw p;return{data:c,querying:h}};
//# sourceMappingURL=sm-js.cjs.production.min.js.map
